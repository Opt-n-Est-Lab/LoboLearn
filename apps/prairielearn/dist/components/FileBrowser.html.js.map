{"version":3,"file":"FileBrowser.html.js","sourceRoot":"","sources":["../../src/components/FileBrowser.html.ts"],"names":[],"mappings":"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","sourcesContent":["import * as path from 'node:path';\n\nimport * as async from 'async';\nimport { fileTypeFromFile } from 'file-type';\nimport { filesize } from 'filesize';\nimport fs from 'fs-extra';\nimport hljs from 'highlight.js';\nimport { isBinaryFile } from 'isbinaryfile';\n\nimport { type HtmlValue, escapeHtml, html, joinHtml, unsafeHtml } from '@prairielearn/html';\nimport { contains } from '@prairielearn/path-utils';\nimport { run } from '@prairielearn/run';\n\nimport { compiledScriptTag, nodeModulesAssetPath } from '../lib/assets.js';\nimport { config } from '../lib/config.js';\nimport * as editorUtil from '../lib/editorUtil.js';\nimport type { InstructorFilePaths } from '../lib/instructorFiles.js';\nimport { encodePath } from '../lib/uri-util.js';\n\nimport { PageLayout } from './PageLayout.html.js';\nimport {\n  AssessmentSyncErrorsAndWarnings,\n  CourseInstanceSyncErrorsAndWarnings,\n  CourseSyncErrorsAndWarnings,\n  QuestionSyncErrorsAndWarnings,\n} from './SyncErrorsAndWarnings.html.js';\nimport { SyncProblemButton } from './SyncProblemButton.html.js';\n\ninterface FileInfo {\n  id: number;\n  name: string;\n  path: string;\n  dir: string;\n  canEdit: boolean;\n  canUpload: boolean;\n  canDownload: boolean;\n  canRename: boolean;\n  canDelete: boolean;\n  canView: boolean;\n  isBinary: boolean;\n  isImage: boolean;\n  isPDF: boolean;\n  isText: boolean;\n  contents?: string | null;\n}\n\ninterface DirectoryEntry {\n  id: string | number;\n  name: string;\n  path: string;\n  canView: boolean;\n}\n\ninterface DirectoryEntryDirectory extends DirectoryEntry {\n  isFile: false;\n}\n\ninterface DirectoryEntryFile extends DirectoryEntry {\n  isFile: true;\n  dir: string;\n  canEdit: boolean;\n  canUpload: boolean;\n  canDownload: boolean;\n  canRename: boolean;\n  canDelete: boolean;\n  sync_errors: string | null;\n  sync_warnings: string | null;\n}\n\ninterface DirectoryListings {\n  dirs: DirectoryEntryDirectory[];\n  files: DirectoryEntryFile[];\n}\n\ntype FileUploadInfo = {\n  id: string | number;\n  info?: HtmlValue;\n} & (\n  | {\n      path: string;\n      working_path?: unknown;\n    }\n  | {\n      path?: null | undefined;\n      working_path: string;\n    }\n);\n\ninterface FileDeleteInfo {\n  id: string | number;\n  name: string;\n  path: string;\n}\n\ninterface FileRenameInfo {\n  id: string | number;\n  name: string;\n  dir: string;\n}\n\nexport async function browseDirectory({\n  paths,\n}: {\n  paths: InstructorFilePaths;\n}): Promise<DirectoryListings> {\n  const filenames = await fs.readdir(paths.workingPath);\n  const all_files = await async.mapLimit(\n    filenames.sort().map((name, index) => ({ name, index })),\n    3,\n    async (file: { name: string; index: number }) => {\n      const filepath = path.join(paths.workingPath, file.name);\n      const stats = await fs.lstat(filepath);\n      if (stats.isFile()) {\n        const editable = !(await isBinaryFile(filepath));\n        const movable = !paths.cannotMove.includes(filepath);\n        const relative_path = path.relative(paths.coursePath, filepath);\n        const sync_data = await editorUtil.getErrorsAndWarningsForFilePath(\n          paths.courseId,\n          relative_path,\n        );\n        return {\n          id: file.index,\n          name: file.name,\n          isFile: true,\n          path: relative_path,\n          dir: paths.workingPath,\n          canEdit: editable && paths.hasEditPermission,\n          canUpload: paths.hasEditPermission,\n          canDownload: true, // we already know the user is a course Viewer (checked on GET)\n          canRename: movable && paths.hasEditPermission,\n          canDelete: movable && paths.hasEditPermission,\n          canView: !paths.invalidRootPaths.some((invalidRootPath) =>\n            contains(invalidRootPath, filepath),\n          ),\n          sync_errors: sync_data.errors,\n          sync_warnings: sync_data.warnings,\n        } as DirectoryEntryFile;\n      } else if (stats.isDirectory()) {\n        // The .git directory is hidden in the browser interface.\n        if (file.name === '.git') return null;\n        return {\n          id: file.index,\n          name: file.name,\n          isFile: false,\n          path: path.relative(paths.coursePath, filepath),\n          canView: !paths.invalidRootPaths.some((invalidRootPath) =>\n            contains(invalidRootPath, filepath),\n          ),\n        } as DirectoryEntryDirectory;\n      } else {\n        return null;\n      }\n    },\n  );\n  return {\n    files: all_files.filter((f) => f?.isFile === true),\n    dirs: all_files.filter((f) => f?.isFile === false),\n  };\n}\n\nexport async function browseFile({ paths }: { paths: InstructorFilePaths }): Promise<FileInfo> {\n  const filepath = paths.workingPath;\n  const movable = !paths.cannotMove.includes(filepath);\n  const file: FileInfo = {\n    id: 0,\n    name: path.basename(paths.workingPath),\n    path: path.relative(paths.coursePath, filepath),\n    dir: path.dirname(paths.workingPath),\n    canEdit: false, // will be overridden only if the file is a text file\n    canUpload: paths.hasEditPermission,\n    canDownload: true, // we already know the user is a course Viewer (checked on GET)\n    canRename: movable && paths.hasEditPermission,\n    canDelete: movable && paths.hasEditPermission,\n    canView: !paths.invalidRootPaths.some((invalidRootPath) => contains(invalidRootPath, filepath)),\n    isBinary: await isBinaryFile(paths.workingPath),\n    isImage: false,\n    isPDF: false,\n    isText: false,\n  };\n\n  if (file.isBinary) {\n    const type = await fileTypeFromFile(paths.workingPath);\n    if (type) {\n      if (type?.mime.startsWith('image')) {\n        file.isImage = true;\n      } else if (type?.mime === 'application/pdf') {\n        file.isPDF = true;\n      }\n    }\n  } else {\n    // This is probably a text file. If it's is larger that 1MB, don't\n    // attempt to read it; treat it like an opaque binary file.\n    const { size } = await fs.stat(paths.workingPath);\n    if (size > 1 * 1024 * 1024) {\n      return { ...file, isBinary: true };\n    }\n\n    file.isText = true;\n    file.canEdit = paths.hasEditPermission;\n\n    const fileContents = await fs.readFile(paths.workingPath);\n    const stringifiedContents = fileContents.toString('utf8');\n\n    // Try to guess the language from the file extension. This takes\n    // advantage of the fact that Highlight.js includes common file extensions\n    // as aliases for each supported language, and `getLanguage()` allows\n    // us to look up a language by its alias.\n    //\n    // If we don't get a match, we'll try to guess the language by running\n    // `highlightAuto()` on the first few thousand characters of the file.\n    //\n    // Note that we deliberately exclude `ml` and `ls` from the extensions\n    // that we try to guess from, as they're ambiguous (OCaml/Standard ML\n    // and LiveScript/Lasso, respectively). For more details, see\n    // https://highlightjs.readthedocs.io/en/latest/supported-languages.html\n    let language: string | undefined = undefined;\n    const extension = path.extname(paths.workingPath).substring(1);\n    if (!['ml', 'ls'].includes(extension) && hljs.getLanguage(extension)) {\n      language = extension;\n    } else {\n      const result = hljs.highlightAuto(stringifiedContents.slice(0, 2000));\n      language = result.language;\n    }\n    file.contents = hljs.highlight(stringifiedContents, {\n      language: language ?? 'plaintext',\n    }).value;\n  }\n\n  return file;\n}\n\nexport async function createFileBrowser({\n  resLocals,\n  paths,\n  isReadOnly,\n}: {\n  resLocals: Record<string, any>;\n  paths: InstructorFilePaths;\n  isReadOnly: boolean;\n}) {\n  const stats = await fs.lstat(paths.workingPath);\n  if (stats.isDirectory()) {\n    return FileBrowser({\n      resLocals,\n      paths,\n      isFile: false,\n      directoryListings: await browseDirectory({ paths }),\n      isReadOnly,\n    });\n  } else if (stats.isFile()) {\n    return FileBrowser({\n      resLocals,\n      paths,\n      isFile: true,\n      fileInfo: await browseFile({ paths }),\n      isReadOnly,\n    });\n  } else {\n    throw new Error(\n      `Invalid working path - ${paths.workingPath} is neither a directory nor a file`,\n    );\n  }\n}\n\nexport function FileBrowser({\n  resLocals,\n  paths,\n  isFile,\n  fileInfo,\n  directoryListings,\n  isReadOnly,\n}: { resLocals: Record<string, any>; paths: InstructorFilePaths; isReadOnly: boolean } & (\n  | { isFile: true; fileInfo: FileInfo; directoryListings?: undefined }\n  | { isFile: false; directoryListings: DirectoryListings; fileInfo?: undefined }\n)) {\n  const { navPage, __csrf_token: csrfToken, authz_data, course, urlPrefix } = resLocals;\n  const syncErrorsAndWarnings =\n    navPage === 'course_admin'\n      ? CourseSyncErrorsAndWarnings({ authz_data, course, urlPrefix })\n      : navPage === 'instance_admin'\n        ? CourseInstanceSyncErrorsAndWarnings({\n            authz_data,\n            courseInstance: resLocals.course_instance,\n            course,\n            urlPrefix,\n          })\n        : navPage === 'assessment'\n          ? AssessmentSyncErrorsAndWarnings({\n              authz_data,\n              assessment: resLocals.assessment,\n              courseInstance: resLocals.course_instance,\n              course,\n              urlPrefix,\n            })\n          : navPage === 'question' || navPage === 'public_question'\n            ? QuestionSyncErrorsAndWarnings({\n                authz_data,\n                question: resLocals.question,\n                course,\n                urlPrefix,\n              })\n            : '';\n  const pageTitle =\n    navPage === 'course_admin'\n      ? 'Course Files'\n      : navPage === 'instance_admin'\n        ? 'Course Instance Files'\n        : navPage === 'assessment'\n          ? 'Assessment Files'\n          : navPage === 'question' || navPage === 'public_question'\n            ? `Files (${resLocals.question.qid})`\n            : 'Files';\n\n  const breadcrumbPaths = run(() => {\n    // We only include the root path if it's viewable on the current page.\n    // Otherwise we hide it to keep the breadcrumb more concise.\n    if (paths.branch[0].canView) return paths.branch;\n\n    return paths.branch.slice(1);\n  });\n\n  return PageLayout({\n    resLocals,\n    pageTitle,\n    navContext: {\n      type: resLocals.navbarType,\n      page: navPage,\n      subPage: 'file_view',\n    },\n    options: {\n      fullWidth: true,\n    },\n    preContent: html`\n      <link href=\"${nodeModulesAssetPath('highlight.js/styles/default.css')}\" rel=\"stylesheet\" />\n      ${compiledScriptTag('instructorFileBrowserClient.ts')}\n      <style>\n        .popover {\n          max-width: 50%;\n        }\n      </style>\n    `,\n    content: html`\n      ${syncErrorsAndWarnings}\n      <h1 class=\"visually-hidden\">Files</h1>\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white\">\n          <div class=\"row align-items-center justify-content-between\">\n            <div class=\"col-auto font-monospace d-flex\">\n              ${joinHtml(\n                breadcrumbPaths.map(\n                  (dir) => html`\n                    ${dir.canView\n                      ? html`\n                          <a\n                            class=\"text-white\"\n                            href=\"${paths.urlPrefix}/file_view/${encodePath(dir.path)}\"\n                          >\n                            ${dir.name}\n                          </a>\n                        `\n                      : html`<span>${dir.name}</span>`}\n                  `,\n                ),\n                html`<span class=\"mx-2\">/</span>`,\n              )}\n            </div>\n            <div class=\"col-auto\">\n              ${isFile\n                ? FileBrowserActions({ paths, fileInfo, isReadOnly, csrfToken })\n                : paths.hasEditPermission && !isReadOnly\n                  ? DirectoryBrowserActions({ paths, csrfToken })\n                  : ''}\n            </div>\n          </div>\n        </div>\n\n        ${isFile\n          ? html`<div class=\"card-body\">${FileContentPreview({ paths, fileInfo })}</div>`\n          : DirectoryBrowserBody({ paths, directoryListings, isReadOnly, csrfToken })}\n      </div>\n    `,\n  });\n}\n\nfunction FileBrowserActions({\n  paths,\n  fileInfo,\n  isReadOnly,\n  csrfToken,\n}: {\n  paths: InstructorFilePaths;\n  fileInfo: FileInfo;\n  isReadOnly: boolean;\n  csrfToken: string;\n}) {\n  const encodedPath = encodePath(fileInfo.path);\n  return html`\n    ${isReadOnly\n      ? ''\n      : html`\n          <a\n            tabindex=\"0\"\n            class=\"btn btn-sm btn-light ${fileInfo.canEdit ? '' : 'disabled'}\"\n            href=\"${paths.urlPrefix}/file_edit/${encodedPath}\"\n          >\n            <i class=\"fa fa-edit\"></i>\n            <span>Edit</span>\n          </a>\n          <button\n            type=\"button\"\n            class=\"btn btn-sm btn-light\"\n            data-bs-toggle=\"popover\"\n            data-bs-container=\"body\"\n            data-bs-html=\"true\"\n            data-bs-placement=\"auto\"\n            data-bs-title=\"Upload file\"\n            data-bs-content=\"${escapeHtml(FileUploadForm({ file: fileInfo, csrfToken }))}\"\n            ${fileInfo.canUpload ? '' : 'disabled'}\n          >\n            <i class=\"fa fa-arrow-up\"></i>\n            <span>Upload</span>\n          </button>\n        `}\n    <a\n      class=\"btn btn-sm btn-light ${fileInfo.canDownload ? '' : 'disabled'}\"\n      href=\"${paths.urlPrefix}/file_download/${encodedPath}?attachment=${encodeURIComponent(\n        fileInfo.name,\n      )}\"\n    >\n      <i class=\"fa fa-arrow-down\"></i>\n      <span>Download</span>\n    </a>\n    ${isReadOnly\n      ? ''\n      : html`\n          <button\n            type=\"button\"\n            class=\"btn btn-sm btn-light\"\n            data-bs-toggle=\"popover\"\n            data-bs-container=\"body\"\n            data-bs-html=\"true\"\n            data-bs-placement=\"auto\"\n            data-bs-title=\"Rename file\"\n            data-bs-content=\"${escapeHtml(\n              FileRenameForm({ file: fileInfo, csrfToken, isViewingFile: true }),\n            )}\"\n            ${fileInfo.canRename ? '' : 'disabled'}\n          >\n            <i class=\"fa fa-i-cursor\"></i>\n            <span>Rename</span>\n          </button>\n          <button\n            type=\"button\"\n            class=\"btn btn-sm btn-light\"\n            data-bs-toggle=\"popover\"\n            data-bs-container=\"body\"\n            data-bs-html=\"true\"\n            data-bs-placement=\"auto\"\n            data-bs-title=\"Confirm delete\"\n            data-bs-content=\"${escapeHtml(FileDeleteForm({ file: fileInfo, csrfToken }))}\"\n            ${fileInfo.canDelete ? '' : 'disabled'}\n          >\n            <i class=\"far fa-trash-alt\"></i>\n            <span>Delete</span>\n          </button>\n        `}\n  `;\n}\n\nfunction DirectoryBrowserActions({\n  paths,\n  csrfToken,\n}: {\n  paths: InstructorFilePaths;\n  csrfToken: string;\n}) {\n  return html`\n    ${paths.specialDirs?.map(\n      (d) => html`\n        <button\n          type=\"button\"\n          id=\"instructorFileUploadForm-New${d.label}\"\n          class=\"btn btn-sm btn-light\"\n          data-bs-toggle=\"popover\"\n          data-bs-container=\"body\"\n          data-bs-html=\"true\"\n          data-bs-placement=\"auto\"\n          data-bs-title=\"Upload file\"\n          data-bs-content=\"${escapeHtml(\n            FileUploadForm({\n              file: { id: `New${d.label}`, info: d.info, working_path: d.path },\n              csrfToken,\n            }),\n          )}\n          \"\n        >\n          <i class=\"fa fa-plus\"></i>\n          <span>Add new ${d.label.toLowerCase()} file</span>\n        </button>\n      `,\n    )}\n    <button\n      type=\"button\"\n      id=\"instructorFileUploadForm-New\"\n      class=\"btn btn-sm btn-light\"\n      data-bs-toggle=\"popover\"\n      data-bs-container=\"body\"\n      data-bs-html=\"true\"\n      data-bs-placement=\"auto\"\n      data-bs-title=\"Upload file\"\n      data-bs-content=\"${escapeHtml(\n        FileUploadForm({\n          file: { id: 'New', working_path: paths.workingPath },\n          csrfToken,\n        }),\n      )}\"\n    >\n      <i class=\"fa fa-plus\"></i>\n      <span>Add new file</span>\n    </button>\n  `;\n}\n\nfunction FileContentPreview({\n  paths,\n  fileInfo,\n}: {\n  paths: InstructorFilePaths;\n  fileInfo: FileInfo;\n}) {\n  if (fileInfo.isImage) {\n    return html`\n      <img\n        src=\"${paths.urlPrefix}/file_download/${paths.workingPathRelativeToCourse}\"\n        class=\"img-fluid\"\n      />\n    `;\n  }\n  if (fileInfo.isText) {\n    return html`<pre><code>${unsafeHtml(fileInfo.contents ?? '')}</code></pre>`;\n  }\n  if (fileInfo.isPDF) {\n    return html`\n      <div class=\"embed-responsive embed-responsive-4by3\">\n        <iframe\n          src=\"${paths.urlPrefix}/file_download/${paths.workingPathRelativeToCourse}?type=application/pdf#view=FitH\"\n          class=\"embed-responsive-item\"\n        >\n          This PDF cannot be displayed.\n        </iframe>\n      </div>\n    `;\n  }\n  return html`<div class=\"alert alert-warning\" role=\"alert\">No preview available.</div>`;\n}\n\nfunction DirectoryBrowserBody({\n  paths,\n  directoryListings,\n  isReadOnly,\n  csrfToken,\n}: {\n  paths: InstructorFilePaths;\n  directoryListings: DirectoryListings;\n  isReadOnly: boolean;\n  csrfToken: string;\n}) {\n  return html`\n    <table class=\"table table-sm table-hover\" aria-label=\"Directories and files\">\n      <thead class=\"visually-hidden\">\n        <tr>\n          <th>File</th>\n          <th>Actions</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${directoryListings.files?.map(\n          (f) => html`\n            <tr>\n              <td>\n                ${f.sync_errors\n                  ? SyncProblemButton({\n                      type: 'error',\n                      output: f.sync_errors,\n                    })\n                  : f.sync_warnings\n                    ? SyncProblemButton({\n                        type: 'warning',\n                        output: f.sync_warnings,\n                      })\n                    : ''}\n                <span><i class=\"far fa-file-alt fa-fw\"></i></span>\n                ${f.canView\n                  ? html`<a href=\"${paths.urlPrefix}/file_view/${encodePath(f.path)}\">${f.name}</a>`\n                  : html`<span>${f.name}</span>`}\n              </td>\n              <td>\n                ${isReadOnly\n                  ? ''\n                  : html`\n                      <a\n                        class=\"btn btn-xs btn-secondary ${f.canEdit ? '' : 'disabled'}\"\n                        href=\"${paths.urlPrefix}/file_edit/${encodePath(f.path)}\"\n                      >\n                        <i class=\"fa fa-edit\"></i>\n                        <span>Edit</span>\n                      </a>\n                      <button\n                        type=\"button\"\n                        id=\"instructorFileUploadForm-${f.id}\"\n                        class=\"btn btn-xs btn-secondary\"\n                        data-bs-toggle=\"popover\"\n                        data-bs-container=\"body\"\n                        data-bs-html=\"true\"\n                        data-bs-placement=\"auto\"\n                        data-bs-title=\"Upload file\"\n                        data-bs-content=\"\n                  ${escapeHtml(FileUploadForm({ file: f, csrfToken }))}\"\n                        ${f.canUpload ? '' : 'disabled'}\n                      >\n                        <i class=\"fa fa-arrow-up\"></i>\n                        <span>Upload</span>\n                      </button>\n                    `}\n                <a\n                  class=\"btn btn-xs btn-secondary ${f.canDownload ? '' : 'disabled'}\"\n                  href=\"${paths.urlPrefix}/file_download/${encodePath(\n                    f.path,\n                  )}?attachment=${encodeURIComponent(f.name)}\"\n                >\n                  <i class=\"fa fa-arrow-down\"></i>\n                  <span>Download</span>\n                </a>\n                ${isReadOnly\n                  ? ''\n                  : html`\n                      <button\n                        type=\"button\"\n                        class=\"btn btn-xs btn-secondary\"\n                        data-bs-toggle=\"popover\"\n                        data-bs-container=\"body\"\n                        data-bs-html=\"true\"\n                        data-bs-placement=\"auto\"\n                        data-bs-title=\"Rename file\"\n                        data-bs-content=\"${escapeHtml(\n                          FileRenameForm({ file: f, csrfToken, isViewingFile: false }),\n                        )}\"\n                        data-testid=\"rename-file-button\"\n                        ${f.canRename ? '' : 'disabled'}\n                      >\n                        <i class=\"fa fa-i-cursor\"></i>\n                        <span>Rename</span>\n                      </button>\n                      <button\n                        type=\"button\"\n                        class=\"btn btn-xs btn-secondary\"\n                        data-bs-toggle=\"popover\"\n                        data-bs-container=\"body\"\n                        data-bs-html=\"true\"\n                        data-bs-placement=\"auto\"\n                        data-bs-title=\"Confirm delete\"\n                        data-bs-content=\"${escapeHtml(FileDeleteForm({ file: f, csrfToken }))}\"\n                        data-testid=\"delete-file-button\"\n                        ${f.canDelete ? '' : 'disabled'}\n                      >\n                        <i class=\"far fa-trash-alt\"></i>\n                        <span>Delete</span>\n                      </button>\n                    `}\n              </td>\n            </tr>\n          `,\n        )}\n        ${directoryListings.dirs.map(\n          (d) => html`\n            <tr>\n              <td colspan=\"2\">\n                <i class=\"fa fa-folder fa-fw\"></i>\n                ${d.canView\n                  ? html`<a href=\"${paths.urlPrefix}/file_view/${encodePath(d.path)}\">${d.name}</a>`\n                  : html`<span>${d.name}</span>`}\n              </td>\n            </tr>\n          `,\n        )}\n      </tbody>\n    </table>\n  `;\n}\n\nfunction FileUploadForm({ file, csrfToken }: { file: FileUploadInfo; csrfToken: string }) {\n  return html`\n    <form\n      class=\"needs-validation\"\n      name=\"instructor-file-upload-form-${file.id}\"\n      method=\"POST\"\n      enctype=\"multipart/form-data\"\n      novalidate\n    >\n      ${file.info ? html`<div class=\"mb-3\">${file.info}</div>` : ''}\n\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"attachFileInput-${file.id}\">Choose file</label>\n        <input\n          type=\"file\"\n          name=\"file\"\n          class=\"form-control\"\n          id=\"attachFileInput-${file.id}\"\n          required\n        />\n        <small class=\"form-text text-muted\">\n          Max file size: ${filesize(config.fileUploadMaxBytes, { base: 10, round: 0 })}\n        </small>\n      </div>\n\n      <div class=\"mb-3\">\n        <input type=\"hidden\" name=\"__action\" value=\"upload_file\" />\n        <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n        ${file.path != null\n          ? html`<input type=\"hidden\" name=\"file_path\" value=\"${file.path}\" />`\n          : html`<input type=\"hidden\" name=\"working_path\" value=\"${file.working_path}\" />`}\n        <div class=\"text-right\">\n          <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"popover\">Cancel</button>\n          <button type=\"submit\" class=\"btn btn-primary\">Upload file</button>\n        </div>\n      </div>\n    </form>\n  `;\n}\n\nfunction FileDeleteForm({ file, csrfToken }: { file: FileDeleteInfo; csrfToken: string }) {\n  return html`\n    <form name=\"instructor-file-delete-form-${file.id}\" method=\"POST\">\n      <p>Are you sure you want to delete <strong>${file.name}</strong>?</p>\n      <input type=\"hidden\" name=\"__action\" value=\"delete_file\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <input type=\"hidden\" name=\"file_path\" value=\"${file.path}\" />\n      <div class=\"text-right\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"popover\">Cancel</button>\n        <button type=\"submit\" class=\"btn btn-primary\">Delete</button>\n      </div>\n    </form>\n  `;\n}\n\nfunction FileRenameForm({\n  file,\n  csrfToken,\n  isViewingFile,\n}: {\n  file: FileRenameInfo;\n  csrfToken: string;\n  isViewingFile: boolean;\n}) {\n  return html`\n    <form\n      name=\"instructor-file-rename-form-${file.id}\"\n      method=\"POST\"\n      class=\"needs-validation\"\n      novalidate\n    >\n      <input type=\"hidden\" name=\"__action\" value=\"rename_file\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <input type=\"hidden\" name=\"working_path\" value=\"${file.dir}\" />\n      ${isViewingFile ? html`<input type=\"hidden\" name=\"was_viewing_file\" value=\"true\" />` : ''}\n      <input type=\"hidden\" name=\"old_file_name\" value=\"${file.name}\" />\n      <div class=\"container p-0 mb-4\">\n        Use only letters, numbers, dashes, and underscores, with no spaces. A file extension is\n        recommended, delimited by a period. If you want to move the file to a different directory,\n        you can specify a relative path that is delimited by a forward slash and that includes\n        \"<code>..</code>\".\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"renameFileInput${file.id}\">Path:</label>\n        <input\n          type=\"text\"\n          class=\"form-control js-rename-input\"\n          id=\"renameFileInput${file.id}\"\n          name=\"new_file_name\"\n          value=\"${file.name}\"\n          data-original-value=\"${file.name}\"\n          size=\"${1.5 * file.name.length}\"\n          pattern=\"(?:[\\\\-A-Za-z0-9_]+|\\\\.\\\\.)(?:\\\\/(?:[\\\\-A-Za-z0-9_]+|\\\\.\\\\.))*(?:\\\\.[\\\\-A-Za-z0-9_]+)?\"\n          required\n        />\n      </div>\n      <div class=\"text-right\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"popover\">Cancel</button>\n        <button type=\"submit\" class=\"btn btn-primary\">Change</button>\n      </div>\n    </form>\n  `;\n}\n"]}