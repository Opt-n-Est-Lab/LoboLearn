{"version":3,"file":"QuestionsTable.html.js","sourceRoot":"","sources":["../../src/components/QuestionsTable.html.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,WAAW,EAAE,MAAM,6BAA6B,CAAC;AAC1D,OAAO,EAAuB,IAAI,EAAE,MAAM,oBAAoB,CAAC;AAE/D,OAAO,EAAE,iBAAiB,EAAE,qBAAqB,EAAE,oBAAoB,EAAE,MAAM,kBAAkB,CAAC;AAClG,OAAO,EAAuB,MAAM,oBAAoB,CAAC;AACzD,OAAO,EAAE,QAAQ,EAAE,MAAM,cAAc,CAAC;AACxC,OAAO,EAA0B,MAAM,wBAAwB,CAAC;AAEhE,OAAO,EAAE,KAAK,EAAE,MAAM,iBAAiB,CAAC;AAExC,MAAM,UAAU,kBAAkB;IAChC,yHAAyH;IACzH,yHAAyH;IAEzH,OAAO,IAAI,CAAA;mBACM,oBAAoB,CAAC,6CAA6C,CAAC;mBACnE,oBAAoB,CAC/B,sFAAsF,CACvF;;MAED,iBAAiB,CAAC,8BAA8B,CAAC;MACjD,iBAAiB,CAAC,kCAAkC,CAAC;MACrD,qBAAqB,CAAC,oBAAoB,CAAC;GAC9C,CAAC;AACJ,CAAC;AAED,MAAM,UAAU,cAAc,CAAC,EAC7B,SAAS,EACT,iBAAiB,GAAG,EAAE,EACtB,qBAAqB,GAAG,KAAK,EAC7B,4BAA4B,GAAG,KAAK,EACpC,eAAe,GAAG,KAAK,EACvB,uBAAuB,EACvB,gBAAgB,GAAG,EAAE,EACrB,SAAS,EACT,SAAS,EACT,cAAc,EACd,YAAY,GAgBb;IACC,MAAM,oBAAoB,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,YAAY,KAAK,IAAI,CAAC,CAAC;IAChF,MAAM,mBAAmB,GAAG,CAAC,gBAAgB,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,eAAe,EAAE,EAAE,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;IAClG,OAAO,IAAI,CAAA;MACP,WAAW,CACX;QACE,mBAAmB;QACnB,qBAAqB;QACrB,4BAA4B;QAC5B,SAAS;QACT,SAAS;QACT,cAAc;KACf,EACD,sBAAsB,CACvB;MACC,mBAAmB,CAAC;QACpB,SAAS,EAAE,YAAY;QACvB,iBAAiB;KAClB,CAAC;;;;;;QAME,SAAS,CAAC,MAAM,GAAG,CAAC;QACpB,CAAC,CAAC,IAAI,CAAA;;;;2BAIa,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;oBAmEhC,eAAe;YACf,CAAC,CAAC,IAAI,CAAA;;;;;;;;;;;;;4BAaE;YACR,CAAC,CAAC,EAAE;;;;;;;;;;oCAUY,oBAAoB;;;;;;;;;;;;;;;;;;;;;;;;;;;oBA2BpC,CAAC,gBAAgB,IAAI,EAAE,CAAC,CAAC,GAAG,CAC5B,CAAC,eAAe,EAAE,EAAE,CAClB,IAAI,CAAA;kDACwB,eAAe,CAAC,EAAE;;qDAEf,eAAe,CAAC,EAAE;;;4DAGX,eAAe,CAAC,EAAE;;wCAEtC,uBAAuB;YACvC,QAAQ,CAAC,uBAAuB,CAAC,EAAE,EAAE,eAAe,CAAC,EAAE,CAAC;;;0BAGtD,eAAe,CAAC,UAAU;4BACxB,CACT;;;;WAIR;QACH,CAAC,CAAC,IAAI,CAAA;;;;;;;;;;;;;gBAaE,qBAAqB;YACrB,CAAC,CAAC,IAAI,CAAA;;;;;;;;;;;wBAWE,4BAA4B;gBAC5B,CAAC,CAAC,IAAI,CAAA;;;sCAGQ,SAAS;;;;;2BAKpB;gBACH,CAAC,CAAC,EAAE;;mBAET;YACH,CAAC,CAAC,EAAE;;WAET;;GAER,CAAC;AACJ,CAAC;AAED,SAAS,mBAAmB,CAAC,EAC3B,SAAS,EACT,iBAAiB,GAIlB;IACC,OAAO,KAAK,CAAC;QACX,EAAE,EAAE,qBAAqB;QACzB,KAAK,EAAE,iBAAiB;QACxB,UAAU,EAAE,MAAM;QAClB,IAAI,EAAE,IAAI,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YA0DF,iBAAiB,CAAC,GAAG,CACrB,CAAC,QAAQ,EAAE,EAAE,CAAC,IAAI,CAAA,kBAAkB,QAAQ,CAAC,GAAG,KAAK,QAAQ,CAAC,KAAK,WAAW,CAC/E;;;;;;KAMN;QACD,MAAM,EAAE,IAAI,CAAA;;wDAEwC,SAAS;;;KAG5D;KACF,CAAC,CAAC;AACL,CAAC","sourcesContent":["import { EncodedData } from '@prairielearn/browser-utils';\nimport { type HtmlSafeString, html } from '@prairielearn/html';\n\nimport { compiledScriptTag, compiledStylesheetTag, nodeModulesAssetPath } from '../lib/assets.js';\nimport { type CourseInstance } from '../lib/db-types.js';\nimport { idsEqual } from '../lib/id.js';\nimport { type QuestionsPageData } from '../models/questions.js';\n\nimport { Modal } from './Modal.html.js';\n\nexport function QuestionsTableHead() {\n  // Importing javascript using <script> tags as below is *not* the preferred method, it is better to directly use 'import'\n  // from a javascript file. However, bootstrap-table is doing some hacky stuff that prevents us from importing it that way\n\n  return html`\n    <script src=\"${nodeModulesAssetPath('bootstrap-table/dist/bootstrap-table.min.js')}\"></script>\n    <script src=\"${nodeModulesAssetPath(\n        'bootstrap-table/dist/extensions/filter-control/bootstrap-table-filter-control.min.js',\n      )}\"></script>\n\n    ${compiledScriptTag('instructorQuestionsClient.ts')}\n    ${compiledScriptTag('bootstrap-table-sticky-header.js')}\n    ${compiledStylesheetTag('questionsTable.css')}\n  `;\n}\n\nexport function QuestionsTable({\n  questions,\n  templateQuestions = [],\n  showAddQuestionButton = false,\n  showAiGenerateQuestionButton = false,\n  showSharingSets = false,\n  current_course_instance,\n  course_instances = [],\n  qidPrefix,\n  urlPrefix,\n  plainUrlPrefix,\n  __csrf_token,\n}: {\n  questions: QuestionsPageData[];\n  /**\n   * The template questions the user can select as a starting point when creating a new question.\n   */\n  templateQuestions?: { qid: string; title: string }[];\n  showAddQuestionButton?: boolean;\n  showAiGenerateQuestionButton?: boolean;\n  showSharingSets?: boolean;\n  current_course_instance?: CourseInstance;\n  course_instances?: CourseInstance[];\n  qidPrefix?: string;\n  urlPrefix: string;\n  plainUrlPrefix: string;\n  __csrf_token: string;\n}): HtmlSafeString {\n  const has_legacy_questions = questions.some((row) => row.display_type !== 'v3');\n  const course_instance_ids = (course_instances || []).map((course_instance) => course_instance.id);\n  return html`\n    ${EncodedData(\n      {\n        course_instance_ids,\n        showAddQuestionButton,\n        showAiGenerateQuestionButton,\n        qidPrefix,\n        urlPrefix,\n        plainUrlPrefix,\n      },\n      'questions-table-data',\n    )}\n    ${CreateQuestionModal({\n      csrfToken: __csrf_token,\n      templateQuestions,\n    })}\n    <div class=\"card mb-4\">\n      <div class=\"card-header bg-primary text-white\">\n        <h1>Questions</h1>\n      </div>\n\n      ${questions.length > 0\n        ? html`\n            <table\n              id=\"questionsTable\"\n              aria-label=\"Questions\"\n              data-data=\"${JSON.stringify(questions)}\"\n              data-classes=\"table table-sm table-hover table-bordered\"\n              data-thead-classes=\"table-light\"\n              data-filter-control=\"true\"\n              data-show-columns=\"true\"\n              data-show-columns-toggle-all=\"true\"\n              data-show-button-text=\"true\"\n              data-pagination=\"true\"\n              data-pagination-v-align=\"both\"\n              data-pagination-h-align=\"left\"\n              data-pagination-detail-h-align=\"right\"\n              data-page-list=\"[10,20,50,100,200,500,unlimited]\"\n              data-page-size=\"50\"\n              data-smart-display=\"false\"\n              data-show-extended-pagination=\"true\"\n              data-toolbar=\".fixed-table-pagination:nth(0)\"\n              data-sticky-header=\"true\"\n            >\n              <thead>\n                <tr>\n                  <th\n                    data-field=\"qid\"\n                    data-sortable=\"true\"\n                    data-class=\"align-middle sticky-column\"\n                    data-formatter=\"qidFormatter\"\n                    data-filter-control=\"input\"\n                    data-filter-custom-search=\"genericFilterSearch\"\n                    data-switchable=\"true\"\n                  >\n                    QID\n                  </th>\n                  <th\n                    data-field=\"title\"\n                    data-sortable=\"true\"\n                    data-class=\"align-middle text-nowrap\"\n                    data-filter-control=\"input\"\n                    data-switchable=\"true\"\n                  >\n                    Title\n                  </th>\n                  <th\n                    data-field=\"topic\"\n                    data-sortable=\"true\"\n                    data-class=\"align-middle text-nowrap\"\n                    data-formatter=\"topicFormatter\"\n                    data-sorter=\"topicSorter\"\n                    data-filter-control=\"select\"\n                    data-filter-control-placeholder=\"(All Topics)\"\n                    data-filter-data=\"func:topicList\"\n                    data-filter-custom-search=\"badgeFilterSearch\"\n                    data-switchable=\"true\"\n                  >\n                    Topic\n                  </th>\n                  <th\n                    data-field=\"tags\"\n                    data-sortable=\"false\"\n                    data-class=\"align-middle text-nowrap\"\n                    data-formatter=\"tagsFormatter\"\n                    data-filter-control=\"select\"\n                    data-filter-control-placeholder=\"(All Tags)\"\n                    data-filter-data=\"func:tagsList\"\n                    data-filter-custom-search=\"badgeFilterSearch\"\n                    data-switchable=\"true\"\n                  >\n                    Tags\n                  </th>\n                  ${showSharingSets\n                    ? html` <th\n                        data-field=\"sharing_sets\"\n                        data-sortable=\"false\"\n                        data-class=\"align-middle text-nowrap\"\n                        data-formatter=\"sharingSetFormatter\"\n                        data-filter-control=\"select\"\n                        data-filter-control-placeholder=\"(All)\"\n                        data-filter-data=\"func:sharingSetsList\"\n                        data-filter-custom-search=\"badgeFilterSearch\"\n                        data-switchable=\"true\"\n                        data-visible=\"false\"\n                      >\n                        Sharing\n                      </th>`\n                    : ''}\n                  <th\n                    data-field=\"display_type\"\n                    data-sortable=\"true\"\n                    data-class=\"align-middle text-nowrap\"\n                    data-formatter=\"versionFormatter\"\n                    data-filter-control=\"select\"\n                    data-filter-control-placeholder=\"(All Versions)\"\n                    data-filter-data=\"func:versionList\"\n                    data-filter-custom-search=\"badgeFilterSearch\"\n                    data-visible=\"${has_legacy_questions}\"\n                    data-switchable=\"true\"\n                  >\n                    Version\n                  </th>\n                  <th\n                    data-field=\"grading_method\"\n                    data-sortable=\"true\"\n                    data-class=\"align-middle text-nowrap\"\n                    data-filter-control=\"select\"\n                    data-filter-control-placeholder=\"(All Methods)\"\n                    data-visible=\"false\"\n                    data-switchable=\"true\"\n                  >\n                    Grading Method\n                  </th>\n                  <th\n                    data-field=\"external_grading_image\"\n                    data-sortable=\"true\"\n                    data-class=\"align-middle text-nowrap\"\n                    data-filter-control=\"select\"\n                    data-filter-control-placeholder=\"(All Images)\"\n                    data-visible=\"false\"\n                    data-switchable=\"true\"\n                  >\n                    External Grading Image\n                  </th>\n                  ${(course_instances || []).map(\n                    (course_instance) =>\n                      html` <th\n                        data-field=\"assessments_${course_instance.id}\"\n                        data-class=\"align-middle text-nowrap\"\n                        data-formatter=\"assessments${course_instance.id}Formatter\"\n                        data-filter-control=\"select\"\n                        data-filter-control-placeholder=\"(All Assessments)\"\n                        data-filter-data=\"func:assessments${course_instance.id}List\"\n                        data-filter-custom-search=\"badgeFilterSearch\"\n                        data-visible=\"${current_course_instance &&\n                        idsEqual(current_course_instance.id, course_instance.id)}\"\n                        data-switchable=\"true\"\n                      >\n                        ${course_instance.short_name} Assessments\n                      </th>`,\n                  )}\n                </tr>\n              </thead>\n            </table>\n          `\n        : html`\n            <div class=\"my-4 card-body text-center\" style=\"text-wrap: balance;\">\n              <p class=\"fw-bold\">No questions found.</p>\n              <p class=\"mb-0\">\n                A question is a problem or task that tests a student's understanding of a specific\n                concept.\n              </p>\n              <p>\n                Learn more in the\n                <a href=\"https://prairielearn.readthedocs.io/en/latest/question/\" target=\"_blank\"\n                  >question documentation</a\n                >.\n              </p>\n              ${showAddQuestionButton\n                ? html`\n                    <div class=\"d-flex flex-row flex-wrap justify-content-center gap-3\">\n                      <button\n                        type=\"button\"\n                        class=\"btn btn-sm btn-primary\"\n                        data-bs-toggle=\"modal\"\n                        data-bs-target=\"#createQuestionModal\"\n                      >\n                        <i class=\"fa fa-plus\" aria-hidden=\"true\"></i>\n                        Add question\n                      </button>\n                      ${showAiGenerateQuestionButton\n                        ? html`\n                            <a\n                              class=\"btn btn-sm btn-primary\"\n                              href=\"${urlPrefix}/ai_generate_question_drafts\"\n                            >\n                              <i class=\"fa fa-wand-magic-sparkles\" aria-hidden=\"true\"></i>\n                              Generate question with AI\n                            </a>\n                          `\n                        : ''}\n                    </div>\n                  `\n                : ''}\n            </div>\n          `}\n    </div>\n  `;\n}\n\nfunction CreateQuestionModal({\n  csrfToken,\n  templateQuestions,\n}: {\n  csrfToken: string;\n  templateQuestions: { qid: string; title: string }[];\n}) {\n  return Modal({\n    id: 'createQuestionModal',\n    title: 'Create question',\n    formMethod: 'POST',\n    body: html`\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"title\">Title</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"title\"\n          name=\"title\"\n          required\n          aria-describedby=\"title_help\"\n        />\n        <small id=\"title_help\" class=\"form-text text-muted\">\n          The full name of the question, visible to users.\n        </small>\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"qid\">Question identifier (QID)</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"qid\"\n          name=\"qid\"\n          required\n          pattern=\"[\\\\-A-Za-z0-9_\\\\/]+\"\n          aria-describedby=\"qid_help\"\n        />\n        <small id=\"qid_help\" class=\"form-text text-muted\">\n          A short unique identifier for this question, such as \"add-vectors\" or \"find-derivative\".\n          Use only letters, numbers, dashes, and underscores, with no spaces.\n        </small>\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"start_from\">Start from</label>\n        <select\n          class=\"form-select\"\n          id=\"start_from\"\n          name=\"start_from\"\n          required\n          aria-describedby=\"start_from_help\"\n        >\n          <option value=\"Empty question\">Empty question</option>\n          <option value=\"Template\">Template</option>\n        </select>\n        <small id=\"start_from_help\" class=\"form-text text-muted\">\n          Begin with an empty question or a pre-made question template.\n        </small>\n      </div>\n\n      <div id=\"templateContainer\" class=\"mb-3\" hidden>\n        <label class=\"form-label\" for=\"template_qid\">Template</label>\n        <select\n          class=\"form-select\"\n          id=\"template_qid\"\n          name=\"template_qid\"\n          required\n          aria-describedby=\"template_help\"\n          disabled\n        >\n          ${templateQuestions.map(\n            (question) => html`<option value=\"${question.qid}\">${question.title}</option>`,\n          )}\n        </select>\n        <small id=\"template_help\" class=\"form-text text-muted\">\n          The question will be created from this template.\n        </small>\n      </div>\n    `,\n    footer: html`\n      <input type=\"hidden\" name=\"__action\" value=\"add_question\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n      <button type=\"submit\" class=\"btn btn-primary\">Create</button>\n    `,\n  });\n}\n"]}