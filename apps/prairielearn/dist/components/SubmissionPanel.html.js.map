{"version":3,"file":"SubmissionPanel.html.js","sourceRoot":"","sources":["../../src/components/SubmissionPanel.html.ts"],"names":[],"mappings":"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","sourcesContent":["import * as url from 'node:url';\n\nimport { differenceInMilliseconds } from 'date-fns';\nimport { z } from 'zod';\n\nimport { type HtmlValue, html, unsafeHtml } from '@prairielearn/html';\n\nimport { config } from '../lib/config.js';\nimport {\n  type AssessmentQuestion,\n  type GradingJob,\n  GradingJobSchema,\n  type InstanceQuestion,\n  type Question,\n  type RubricGradingItem,\n  SubmissionSchema,\n} from '../lib/db-types.js';\nimport type { RubricData, RubricGradingData } from '../lib/manualGrading.js';\nimport { gradingJobStatus } from '../models/grading-job.js';\n\nimport { AiGradingHtmlPreview } from './AiGradingHtmlPreview.html.js';\nimport { Modal } from './Modal.html.js';\nimport type { QuestionContext, QuestionRenderContext } from './QuestionContainer.types.js';\n\nconst detailedSubmissionColumns = {\n  feedback: true,\n  format_errors: true,\n  params: true,\n  partial_scores: true,\n  raw_submitted_answer: true,\n  submitted_answer: true,\n  true_answer: true,\n} as const;\n\nexport const SubmissionBasicSchema = SubmissionSchema.omit(detailedSubmissionColumns).extend({\n  grading_job: GradingJobSchema.nullable(),\n  formatted_date: z.string().nullable(),\n  user_uid: z.string().nullable(),\n});\n\nexport const SubmissionDetailedSchema = SubmissionSchema.pick(detailedSubmissionColumns);\n\nexport type SubmissionForRender = z.infer<typeof SubmissionBasicSchema> &\n  Partial<z.infer<typeof SubmissionDetailedSchema>> & {\n    feedback_manual_html?: string;\n    submission_number: number;\n    rubric_grading?: RubricGradingData | null;\n  };\n\nexport function SubmissionPanel({\n  questionContext,\n  questionRenderContext,\n  question,\n  assessment_question,\n  instance_question,\n  variant_id,\n  course_instance_id,\n  submission,\n  submissionHtml,\n  submissionCount,\n  rubric_data,\n  urlPrefix,\n  expanded,\n  renderSubmissionSearchParams,\n}: {\n  questionContext: QuestionContext;\n  questionRenderContext?: QuestionRenderContext;\n  question: Question;\n  assessment_question?: AssessmentQuestion | null;\n  instance_question?: InstanceQuestion | null;\n  variant_id: string;\n  course_instance_id?: string | null;\n  submission: SubmissionForRender;\n  submissionHtml?: string | null;\n  submissionCount: number;\n  rubric_data?: RubricData | null;\n  urlPrefix: string;\n  expanded?: boolean;\n  renderSubmissionSearchParams?: URLSearchParams;\n}) {\n  const isLatestSubmission = submission.submission_number === submissionCount;\n  expanded = expanded || isLatestSubmission;\n\n  const renderUrlPrefix =\n    questionContext === 'instructor' || questionContext === 'public'\n      ? `${urlPrefix}/question/${question.id}/preview`\n      : questionContext === 'manual_grading'\n        ? `${urlPrefix}/assessment/${assessment_question?.assessment_id}/manual_grading/instance_question/${instance_question?.id}`\n        : `${urlPrefix}/instance_question/${instance_question?.id}`;\n  const renderUrl = url.format({\n    pathname: `${renderUrlPrefix}/variant/${variant_id}/submission/${submission.id}`,\n    search: renderSubmissionSearchParams?.toString(),\n  });\n\n  return html`\n    <div\n      data-testid=\"submission-with-feedback\"\n      data-grading-job-status=\"${gradingJobStatus(submission.grading_job)}\"\n      data-grading-job-id=\"${submission.grading_job?.id}\"\n      id=\"submission-${submission.id}\"\n    >\n      ${submission.feedback?.manual || submission.rubric_grading\n        ? html`\n            <div class=\"card mb-4 grading-block border-info\">\n              <div\n                class=\"card-header bg-info text-white d-flex align-items-center submission-header ${!expanded\n                  ? ' collapsed'\n                  : ''}\"\n              >\n                <div class=\"me-auto\">\n                  Feedback from the Course Staff\n                  ${submissionCount > 1\n                    ? `(for submitted answer ${submission.submission_number})`\n                    : ''}\n                </div>\n                <button\n                  type=\"button\"\n                  class=\"expand-icon-container btn btn-outline-light btn-sm ${!expanded\n                    ? 'collapsed'\n                    : ''}\"\n                  data-bs-toggle=\"collapse\"\n                  data-bs-target=\"#submission-feedback-${submission.id}-body\"\n                  aria-expanded=\"${expanded ? 'true' : 'false'}\"\n                  aria-controls=\"submission-feedback-${submission.id}-body\"\n                >\n                  <i class=\"fa fa-angle-up fa-fw ms-1 expand-icon\"></i>\n                </button>\n              </div>\n              <div\n                class=\"collapse ${expanded ? 'show' : ''}\"\n                id=\"submission-feedback-${submission.id}-body\"\n              >\n                <div class=\"card-body\">\n                  ${submission.rubric_grading\n                    ? html`\n                        ${(rubric_data?.rubric_items || [])\n                          .filter(\n                            (item) =>\n                              item.always_show_to_students ||\n                              submission.rubric_grading?.rubric_items?.[item.id]?.score,\n                          )\n                          .map((item) =>\n                            RubricItem({\n                              item,\n                              item_grading:\n                                submission.rubric_grading?.rubric_items?.[item.id] ?? null,\n                            }),\n                          )}\n                        ${submission.rubric_grading?.adjust_points\n                          ? html`\n                              <div class=\"mb-2\">\n                                <span class=\"text-muted\"> Manual grading adjustment: </span>\n                                <span\n                                  class=\"text-${submission.rubric_grading?.adjust_points >= 0\n                                    ? 'success'\n                                    : 'danger'}\"\n                                >\n                                  <strong data-testid=\"rubric-adjust-points\">\n                                    [${(submission.rubric_grading?.adjust_points >= 0 ? '+' : '') +\n                                    submission.rubric_grading?.adjust_points}]\n                                  </strong>\n                                </span>\n                              </div>\n                            `\n                          : ''}\n                      `\n                    : ''}\n                  ${submission.feedback?.manual\n                    ? html`\n                        <div data-testid=\"feedback-body\">\n                          ${unsafeHtml(submission.feedback_manual_html ?? '')}\n                        </div>\n                      `\n                    : ''}\n                </div>\n              </div>\n            </div>\n          `\n        : ''}\n\n      <div class=\"card mb-4\" data-testid=\"submission-block\">\n        <div class=\"card-header bg-light text-dark d-flex align-items-center submission-header\">\n          <div class=\"me-2\">\n            <div>\n              <span class=\"me-2 d-flex align-items-center\">\n                <h2 class=\"h6 fw-normal mb-0\">\n                  Submitted answer ${submissionCount > 1 ? submission.submission_number : ''}\n                </h2>\n              </span>\n            </div>\n            <span class=\"small\">\n              ${!submission.user_uid\n                ? `Submitted at ${submission.formatted_date} `\n                : `${submission.user_uid} submitted at ${submission.formatted_date}`}\n            </span>\n          </div>\n          <div class=\"me-auto\" data-testid=\"submission-status\">\n            ${SubmissionStatusBadge({\n              submission,\n              question,\n              isLatestSubmission,\n              assessment_question,\n              instance_question,\n            })}\n          </div>\n          <div class=\"btn-group\">\n            <button\n              type=\"button\"\n              class=\"btn btn-outline-dark btn-sm ms-2\"\n              data-submission-id=\"${submission.id}\"\n              data-bs-toggle=\"modal\"\n              data-bs-target=\"#submissionInfoModal-${submission.id}\"\n              aria-label=\"Submission info\"\n            >\n              <i class=\"fa fa-info-circle fa-fw\"></i>\n            </button>\n            <button\n              type=\"button\"\n              class=\"expand-icon-container btn btn-outline-dark btn-sm text-nowrap ${!expanded\n                ? 'collapsed'\n                : ''}\"\n              data-bs-toggle=\"collapse\"\n              data-bs-target=\"#submission-${submission.id}-body\"\n              aria-expanded=\"${expanded ? 'true' : 'false'}\"\n              aria-controls=\"submission-${submission.id}-body\"\n            >\n              <i class=\"fa fa-angle-up fa-fw ms-1 expand-icon\"></i>\n            </button>\n          </div>\n        </div>\n\n        <div\n          class=\"collapse js-submission-body ${expanded ? 'show' : ''} ${submissionHtml == null &&\n          question.type === 'Freeform'\n            ? 'render-pending'\n            : ''}\"\n          data-submission-id=\"${submission.id}\"\n          id=\"submission-${submission.id}-body\"\n          ${question.type === 'Freeform' ? html`data-dynamic-render-url=\"${renderUrl}\" ` : ''}\n        >\n          <div class=\"card-body submission-body\">\n            ${submissionHtml == null\n              ? html`\n                  <div class=\"spinner-border\" role=\"status\">\n                    <span class=\"visually-hidden\">Loading...</span>\n                  </div>\n                `\n              : questionRenderContext === 'ai_grading'\n                ? AiGradingHtmlPreview(submissionHtml)\n                : unsafeHtml(submissionHtml)}\n          </div>\n        </div>\n\n        ${SubmissionInfoModal({\n          urlPrefix,\n          submission,\n          question,\n          course_instance_id,\n        })}\n      </div>\n    </div>\n  `;\n}\n\nfunction SubmissionStatusBadge({\n  submission,\n  question,\n  isLatestSubmission,\n  assessment_question,\n  instance_question,\n}: {\n  submission: SubmissionForRender;\n  question: Question;\n  isLatestSubmission: boolean;\n  assessment_question?: AssessmentQuestion | null;\n  instance_question?: InstanceQuestion | null;\n}) {\n  let manualGradingBadge: HtmlValue = null;\n  let autoGradingBadge: HtmlValue = null;\n\n  if (\n    assessment_question && instance_question\n      ? assessment_question.max_manual_points ||\n        instance_question.manual_points ||\n        instance_question.requires_manual_grading\n      : question.grading_method === 'Manual'\n  ) {\n    // The manual grading status only applies to the latest submission\n    if (isLatestSubmission) {\n      if (!instance_question || instance_question.requires_manual_grading) {\n        if (!submission.gradable && !assessment_question?.max_auto_points) {\n          manualGradingBadge = html`\n            <span class=\"badge text-bg-danger\">invalid, not gradable</span><br />\n          `;\n        } else {\n          manualGradingBadge = html`\n            <span class=\"badge text-bg-secondary\">manual grading: waiting for grading</span><br />\n          `;\n        }\n      } else {\n        const manualPoints = instance_question.manual_points ?? 0;\n        const manual_percentage = assessment_question?.max_points\n          ? Math.floor(\n              (manualPoints * 100) /\n                (assessment_question.max_manual_points || assessment_question.max_points),\n            ) + '%'\n          : (manualPoints > 0 ? '+' : '') +\n            manualPoints +\n            (Math.abs(manualPoints) > 1 ? ' pts' : ' pt');\n        const badgeType =\n          manualPoints <= 0\n            ? 'badge-danger'\n            : manualPoints >= (assessment_question?.max_manual_points ?? 0)\n              ? 'badge-success'\n              : 'badge-warning';\n        manualGradingBadge = html`\n          <span class=\"badge ${badgeType}\">manual grading: ${manual_percentage}</span><br />\n        `;\n      }\n    }\n  }\n\n  const autoStatusPrefix = manualGradingBadge ? 'auto-grading: ' : '';\n\n  if (\n    assessment_question\n      ? assessment_question.max_auto_points || !assessment_question.max_manual_points\n      : question.grading_method !== 'Manual'\n  ) {\n    if (submission.graded_at == null) {\n      if (submission.grading_requested_at == null) {\n        if (submission.gradable) {\n          autoGradingBadge = html`\n            <span class=\"badge text-bg-info\">${autoStatusPrefix} saved, not graded</span>\n          `;\n        } else {\n          autoGradingBadge = html`\n            <span class=\"badge text-bg-danger\">${autoStatusPrefix} invalid, not gradable</span>\n          `;\n        }\n      } else if (question.grading_method === 'External') {\n        if (submission.gradable) {\n          autoGradingBadge = html`\n            <span class=\"badge text-bg-secondary\">\n              ${autoStatusPrefix}\n              <span id=\"grading-status-${submission.id}\"></span>\n            </span>\n          `;\n        } else {\n          autoGradingBadge = html`\n            <span class=\"badge text-bg-danger\">${autoStatusPrefix} invalid, not gradable</span>\n          `;\n        }\n      } else {\n        autoGradingBadge = html`\n          <span class=\"badge text-bg-secondary\">${autoStatusPrefix} waiting for grading</span>\n        `;\n      }\n    } else if (!submission.gradable) {\n      // If an error ocurred during grading, there will be a `graded_at` timestamp but the submission will be marked ungradable.\n      autoGradingBadge = html`\n        <span class=\"badge text-bg-danger\">${autoStatusPrefix} invalid, not gradable</span>\n      `;\n    } else if (submission.score === 1) {\n      if (submission.v2_score != null && submission.v2_score < 1) {\n        autoGradingBadge = html`\n          <span class=\"badge text-bg-success\">\n            ${autoStatusPrefix} 100% (rounded up from ${Math.floor(submission.v2_score * 100)}%)\n          </span>\n        `;\n      } else {\n        autoGradingBadge = html`\n          <span class=\"badge text-bg-success\">${autoStatusPrefix} 100%</span>\n        `;\n      }\n    } else if (submission.score != null && submission.score > 0) {\n      autoGradingBadge = html`\n        <span class=\"badge text-bg-warning\">\n          ${autoStatusPrefix} ${Math.floor(submission.score * 100)}%\n        </span>\n      `;\n    } else if (submission.v2_score != null && submission.v2_score >= 0.01) {\n      autoGradingBadge = html`\n        <span class=\"badge text-bg-danger\">\n          ${autoStatusPrefix} 0% (rounded down from ${Math.floor(submission.v2_score * 100)}%)\n        </span>\n      `;\n    } else {\n      autoGradingBadge = html`<span class=\"badge text-bg-danger\">${autoStatusPrefix} 0%</span>`;\n    }\n  }\n\n  return html`${manualGradingBadge} ${autoGradingBadge}`;\n}\n\nfunction SubmissionInfoModal({\n  urlPrefix,\n  submission,\n  question,\n  course_instance_id,\n}: {\n  urlPrefix: string;\n  submission: SubmissionForRender;\n  question: Question;\n  course_instance_id?: string | null;\n}) {\n  const gradingJobStats = buildGradingJobStats(submission.grading_job);\n  return Modal({\n    id: `submissionInfoModal-${submission.id}`,\n    title: 'Submission info',\n    body: !gradingJobStats\n      ? html`<p>This submission has not been graded.</p>`\n      : html`\n          <table\n            class=\"table table-sm table-borderless two-column-description mb-0\"\n            aria-label=\"Submission info\"\n          >\n            <tbody>\n              <tr>\n                <th>Submission time</th>\n                <td>${submission.formatted_date}</td>\n              </tr>\n              ${question.grading_method === 'External'\n                ? html`\n                    <tr>\n                      <th><span class=\"text-dark me-2\">&bull;</span>Submit duration</th>\n                      <td>${gradingJobStats.submitDuration}</td>\n                    </tr>\n                    <tr>\n                      <th><span class=\"text-warning me-2\">&bull;</span>Queue duration</th>\n                      <td>${gradingJobStats.queueDuration}</td>\n                    </tr>\n                    <tr>\n                      <th><span class=\"text-primary me-2\">&bull;</span>Prepare duration</th>\n                      <td>${gradingJobStats.prepareDuration}</td>\n                    </tr>\n                    <tr>\n                      <th><span class=\"text-success me-2\">&bull;</span>Run duration</th>\n                      <td>${gradingJobStats.runDuration}</td>\n                    </tr>\n                    <tr>\n                      <th><span class=\"text-danger me-2\">&bull;</span>Report duration</th>\n                      <td>${gradingJobStats.reportDuration}</td>\n                    </tr>\n                    <tr>\n                      <th>Total duration</th>\n                      <td>${gradingJobStats.totalDuration}</td>\n                    </tr>\n                  `\n                : ''}\n            </tbody>\n          </table>\n          ${question.grading_method === 'External'\n            ? html`\n                <div class=\"d-flex mt-2 mb-2\">\n                  <span\n                    style=\"display: inline-block; width: ${gradingJobStats\n                      .phases[0]}%; height: 10px;\"\n                    class=\"bg-dark m-0\"\n                  ></span>\n                  <span\n                    style=\"display: inline-block; width: ${gradingJobStats\n                      .phases[1]}%; height: 10px;\"\n                    class=\"bg-warning m-0\"\n                  ></span>\n                  <span\n                    style=\"display: inline-block; width: ${gradingJobStats\n                      .phases[2]}%; height: 10px;\"\n                    class=\"bg-primary m-0\"\n                  ></span>\n                  <span\n                    style=\"display: inline-block; width: ${gradingJobStats\n                      .phases[3]}%; height: 10px;\"\n                    class=\"bg-success m-0\"\n                  ></span>\n                  <span\n                    style=\"display: inline-block; width: ${gradingJobStats\n                      .phases[4]}%; height: 10px;\"\n                    class=\"bg-danger m-0\"\n                  ></span>\n                </div>\n                ${course_instance_id != null\n                  ? html`\n                      <a\n                        class=\"btn btn-primary mt-2\"\n                        href=\"${config.urlPrefix}/course_instance/${course_instance_id}/instructor/grading_job/${submission\n                          .grading_job?.id}\"\n                        >View grading job ${submission.grading_job?.id}</a\n                      >\n                    `\n                  : html`\n                      <a\n                        class=\"btn btn-primary mt-2\"\n                        href=\"${urlPrefix}/grading_job/${submission.grading_job?.id}\"\n                        >View grading job ${submission.grading_job?.id}</a\n                      >\n                    `}\n              `\n            : ''}\n        `,\n    footer: html`\n      <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Close</button>\n    `,\n  });\n}\n\nfunction RubricItem({\n  item,\n  item_grading,\n}: {\n  item: RubricData['rubric_items'][0];\n  item_grading: RubricGradingItem | undefined | null;\n}) {\n  return html`\n    <div>\n      <label class=\"w-100\" data-testid=\"rubric-item-container-${item.id}\">\n        <input type=\"checkbox\" disabled ${item_grading?.score ? 'checked' : ''} />\n        <span class=\"text-${item.points >= 0 ? 'success' : 'danger'}\">\n          <strong data-testid=\"rubric-item-points\">\n            [${(item.points >= 0 ? '+' : '') + item.points}]\n          </strong>\n        </span>\n        <span class=\"d-inline-block\" data-testid=\"rubric-item-description\">\n          ${unsafeHtml(item.description_rendered ?? '')}\n        </span>\n        ${item.explanation\n          ? html`\n              <button\n                type=\"button\"\n                class=\"btn btn-xs btn-ghost\"\n                data-bs-toggle=\"popover\"\n                data-bs-content=\"${item.explanation_rendered}\"\n                data-bs-html=\"true\"\n                data-testid=\"rubric-item-explanation\"\n              >\n                <i class=\"fas fa-circle-info\"></i>\n                <span class=\"visually-hidden\">Details</span>\n              </button>\n            `\n          : ''}\n      </label>\n    </div>\n  `;\n}\n\nfunction buildGradingJobStats(job: GradingJob | null) {\n  if (!job) return null;\n\n  const durations: (number | null)[] = [];\n  const formatDiff = (start: Date | null, end: Date | null, addToPhases = true) => {\n    const duration = end == null || start == null ? null : differenceInMilliseconds(end, start);\n    if (addToPhases) durations.push(duration);\n    return duration == null ? '\\u2212' : (duration / 1000).toFixed(3).replace(/\\.?0+$/, '') + 's';\n  };\n\n  const stats = {\n    submitDuration: formatDiff(job.grading_requested_at, job.grading_submitted_at),\n    queueDuration: formatDiff(job.grading_submitted_at, job.grading_received_at),\n    prepareDuration: formatDiff(job.grading_received_at, job.grading_started_at),\n    runDuration: formatDiff(job.grading_started_at, job.grading_finished_at),\n    reportDuration: formatDiff(job.grading_finished_at, job.graded_at),\n    totalDuration: formatDiff(job.grading_requested_at, job.graded_at, false),\n  };\n  const totalDuration = durations.reduce((a, b) => (a ?? 0) + (b ?? 0), 0) || 1;\n\n  return {\n    ...stats,\n    phases: durations.map(\n      // Round down to avoid width being greater than 100% with floating point errors\n      (duration) => Math.floor(((duration ?? 0) * 1000) / totalDuration) / 10,\n    ),\n  };\n}\n"]}