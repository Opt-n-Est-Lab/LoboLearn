{"version":3,"file":"SyncErrorsAndWarnings.html.js","sourceRoot":"","sources":["../../src/components/SyncErrorsAndWarnings.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, unsafeHtml } from '@prairielearn/html';\n\nimport { ansiToHtml } from '../lib/chalk.js';\nimport {\n  type Assessment,\n  type Course,\n  type CourseInstance,\n  type Question,\n} from '../lib/db-types.js';\n\nexport function CourseSyncErrorsAndWarnings({\n  authz_data,\n  course,\n  urlPrefix,\n}: {\n  authz_data: { has_course_instance_permission_edit: boolean };\n  course: Course;\n  urlPrefix: string;\n}) {\n  return SyncErrorsAndWarnings({\n    authz_data,\n    exampleCourse: course.example_course,\n    syncErrors: course.sync_errors,\n    syncWarnings: course.sync_warnings,\n    fileEditUrl: `${urlPrefix}/course_admin/file_edit/infoCourse.json`,\n    context: 'course',\n  });\n}\n\nexport function QuestionSyncErrorsAndWarnings({\n  authz_data,\n  question,\n  course,\n  urlPrefix,\n}: {\n  authz_data: { has_course_instance_permission_edit: boolean };\n  question: Question;\n  course: Course;\n  urlPrefix: string;\n}) {\n  return SyncErrorsAndWarnings({\n    authz_data,\n    exampleCourse: course.example_course,\n    syncErrors: question.sync_errors,\n    syncWarnings: question.sync_warnings,\n    fileEditUrl: `${urlPrefix}/question/${question.id}/file_edit/questions/${question.qid}/info.json`,\n    context: 'question',\n  });\n}\n\nexport function CourseInstanceSyncErrorsAndWarnings({\n  authz_data,\n  courseInstance,\n  course,\n  urlPrefix,\n}: {\n  authz_data: { has_course_instance_permission_edit: boolean };\n  courseInstance: CourseInstance;\n  course: Course;\n  urlPrefix: string;\n}) {\n  return SyncErrorsAndWarnings({\n    authz_data,\n    exampleCourse: course.example_course,\n    syncErrors: courseInstance.sync_errors,\n    syncWarnings: courseInstance.sync_warnings,\n    fileEditUrl: `${urlPrefix}/instance_admin/file_edit/courseInstances/${courseInstance.short_name}/infoCourseInstance.json`,\n    context: 'course instance',\n  });\n}\n\nexport function AssessmentSyncErrorsAndWarnings({\n  authz_data,\n  assessment,\n  courseInstance,\n  course,\n  urlPrefix,\n}: {\n  authz_data: { has_course_instance_permission_edit: boolean };\n  assessment: Assessment;\n  courseInstance: CourseInstance;\n  course: Course;\n  urlPrefix: string;\n}) {\n  return SyncErrorsAndWarnings({\n    authz_data,\n    exampleCourse: course.example_course,\n    syncErrors: assessment.sync_errors,\n    syncWarnings: assessment.sync_warnings,\n    fileEditUrl: `${urlPrefix}/assessment/${assessment.id}/file_edit/courseInstances/${courseInstance.short_name}/assessments/${assessment.tid}/infoAssessment.json`,\n    context: 'assessment',\n  });\n}\n\nfunction SyncErrorsAndWarnings({\n  authz_data,\n  exampleCourse,\n  syncErrors,\n  syncWarnings,\n  fileEditUrl,\n  context,\n}: {\n  authz_data: { has_course_instance_permission_edit: boolean };\n  exampleCourse: boolean;\n  syncErrors: string | null;\n  syncWarnings: string | null;\n  fileEditUrl: string;\n  context: 'course' | 'question' | 'course instance' | 'assessment';\n}) {\n  if (!authz_data.has_course_instance_permission_edit) {\n    return '';\n  }\n  if (!syncErrors && !syncWarnings) {\n    return '';\n  }\n\n  const syncErrorsAnsified = syncErrors ? unsafeHtml(ansiToHtml(syncErrors)) : null;\n  const syncWarningsAnsified = syncWarnings ? unsafeHtml(ansiToHtml(syncWarnings)) : null;\n  const infoFileName = fileEditUrl.split('/').pop();\n\n  return html`\n    ${syncErrors\n      ? html`\n          <div class=\"alert alert-danger\" role=\"alert\">\n            <h2 class=\"h5 alert-heading\">Sync error</h2>\n            <p>\n              There was an error syncing this ${context}; the information you see below may be\n              inconsistent with this ${context}'s <code>${infoFileName}</code> file. Please correct\n              the error and sync again.\n            </p>\n            <pre\n              class=\"text-white rounded p-3 ${exampleCourse ? 'mb-0' : ''}\"\n              style=\"background-color: black;\"\n            ><code>${syncErrorsAnsified}</code></pre>\n            ${exampleCourse\n              ? ''\n              : html`\n                  <a class=\"btn btn-primary\" href=\"${fileEditUrl}\">\n                    <i class=\"fa fa-edit\"></i>\n                    <span class=\"d-none d-sm-inline\">Edit ${infoFileName} to fix this error</span>\n                  </a>\n                `}\n          </div>\n        `\n      : ''}\n    ${syncWarnings\n      ? html`\n          <div class=\"alert alert-warning\" role=\"alert\">\n            <h2 class=\"h5 alert-heading\">Sync warning</h2>\n            <p>\n              These warnings do not impact the ability to sync this ${context}, but they should\n              still be reviewed and corrected.\n            </p>\n            <pre\n              class=\"text-white rounded p-3 ${exampleCourse ? 'mb-0' : ''}\"\n              style=\"background-color: black;\"\n            ><code>${syncWarningsAnsified}</code></pre>\n            ${exampleCourse\n              ? ''\n              : html`\n                  <a class=\"btn btn-primary\" href=\"${fileEditUrl}\">\n                    <i class=\"fa fa-edit\"></i>\n                    <span class=\"d-none d-sm-inline\">Edit ${infoFileName} to fix this warning</span>\n                  </a>\n                `}\n          </div>\n        `\n      : ''}\n  `;\n}\n"]}