{"version":3,"file":"workspaceTimeoutWarn.js","sourceRoot":"","sources":["../../src/cron/workspaceTimeoutWarn.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,MAAM,sBAAsB,CAAC;AAC9C,OAAO,KAAK,KAAK,MAAM,wBAAwB,CAAC;AAChD,OAAO,KAAK,cAAc,MAAM,+BAA+B,CAAC;AAEhE,OAAO,EAAE,MAAM,EAAE,MAAM,kBAAkB,CAAC;AAE1C,MAAM,GAAG,GAAG,KAAK,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAEhD,MAAM,CAAC,KAAK,UAAU,GAAG;IACvB,MAAM,MAAM,GAAG,MAAM,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,yCAAyC,EAAE;QACnF,oBAAoB,EAAE,MAAM,CAAC,2BAA2B;QACxD,yBAAyB,EAAE,MAAM,CAAC,+BAA+B;KAClE,CAAC,CAAC;IACH,MAAM,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC;IAC/B,KAAK,MAAM,SAAS,IAAI,UAAU,EAAE,CAAC;QACnC,MAAM,CAAC,OAAO,CAAC,4DAA4D,SAAS,CAAC,EAAE,EAAE,CAAC,CAAC;QAC3F,MAAM,mBAAmB,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,mBAAmB,GAAG,EAAE,CAAC,CAAC;QAC1E,MAAM,cAAc,CAAC,sBAAsB,CACzC,SAAS,CAAC,EAAE,EACZ,0CAA0C,mBAAmB,uCAAuC,CACrG,CAAC;IACJ,CAAC;AACH,CAAC","sourcesContent":["import { logger } from '@prairielearn/logger';\nimport * as sqldb from '@prairielearn/postgres';\nimport * as workspaceUtils from '@prairielearn/workspace-utils';\n\nimport { config } from '../lib/config.js';\n\nconst sql = sqldb.loadSqlEquiv(import.meta.url);\n\nexport async function run() {\n  const result = await sqldb.queryAsync(sql.select_almost_launched_timeout_workspaces, {\n    launched_timeout_sec: config.workspaceLaunchedTimeoutSec,\n    launched_timeout_warn_sec: config.workspaceLaunchedTimeoutWarnSec,\n  });\n  const workspaces = result.rows;\n  for (const workspace of workspaces) {\n    logger.verbose(`workspaceTimeoutWarn: timeout warning for workspace_id = ${workspace.id}`);\n    const time_to_timeout_min = Math.ceil(workspace.time_to_timeout_sec / 60);\n    await workspaceUtils.updateWorkspaceMessage(\n      workspace.id,\n      `WARNING: This workspace will stop in < ${time_to_timeout_min} min. Click \"Reboot\" to keep working.`,\n    );\n  }\n}\n"]}