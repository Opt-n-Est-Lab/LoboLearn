{"version":3,"file":"UserSettingsPurchasesCard.html.js","sourceRoot":"","sources":["../../../../../src/ee/lib/billing/components/UserSettingsPurchasesCard.html.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,IAAI,EAAE,MAAM,oBAAoB,CAAC;AAE1C,OAAO,EAA8B,MAAM,6BAA6B,CAAC;AACzE,OAAO,EAAiB,MAAM,iBAAiB,CAAC;AAChD,OAAO,EAAE,iBAAiB,EAAE,MAAM,cAAc,CAAC;AAEjD,MAAM,UAAU,yBAAyB,CAAC,EAAE,SAAS,EAA6B;IAChF,OAAO,IAAI,CAAA;;;;;;QAML,SAAS,CAAC,MAAM,KAAK,CAAC;QACtB,CAAC,CAAC,IAAI,CAAA,mFAAmF;QACzF,CAAC,CAAC,aAAa,CAAC,EAAE,SAAS,EAAE,CAAC;;GAEnC,CAAC;AACJ,CAAC;AAED,SAAS,aAAa,CAAC,EAAE,SAAS,EAA6B;IAC7D,OAAO,IAAI,CAAA;;;;;;;;;;;;;YAaD,SAAS,CAAC,GAAG,CAAC,CAAC,QAAQ,EAAE,EAAE;QAC3B,MAAM,UAAU,GAAG,QAAQ,CAAC,MAAM;YAChC,CAAC,CAAC,GAAG,QAAQ,CAAC,MAAM,CAAC,UAAU,KAAK,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAE;YAC3D,CAAC,CAAC,gBAAgB,CAAC;QAErB,MAAM,kBAAkB,GACtB,QAAQ,CAAC,eAAe,EAAE,SAAS,IAAI,yBAAyB,CAAC;QAEnE,OAAO,IAAI,CAAA;oBACH,QAAQ,CAAC,uBAAuB,CAAC,EAAE;;;oBAGnC,QAAQ,CAAC,eAAe,IAAI,IAAI;YAChC,CAAC,CAAC,EAAE;YACJ,CAAC,CAAC,IAAI,CAAA,6BAA6B,QAAQ,CAAC,eAAe,EAAE,EAAE,GAAG;;oBAElE,UAAU,KAAK,kBAAkB;;;oBAGjC,QAAQ,CAAC,uBAAuB,CAAC,UAAU,EAAE,WAAW,EAAE;oBAC1D,iBAAiB,CAAC,QAAQ,CAAC,uBAAuB,CAAC,IAAI,CAAC,YAAY,CAAC;;kBAEvE,kCAAkC,CAAC;YACnC,OAAO,EAAE,QAAQ,CAAC,uBAAuB;SAC1C,CAAC;;kBAEA,CAAC;IACT,CAAC,CAAC;;;;;;;;GAQT,CAAC;AACJ,CAAC;AAED,SAAS,kCAAkC,CAAC,EAAE,OAAO,EAAsC;IACzF,IAAI,OAAO,CAAC,IAAI,CAAC,cAAc,KAAK,MAAM,EAAE,CAAC;QAC3C,OAAO,IAAI,CAAA,6DAA6D,CAAC;IAC3E,CAAC;SAAM,IAAI,OAAO,CAAC,IAAI,CAAC,cAAc,KAAK,QAAQ,EAAE,CAAC;QACpD,OAAO,IAAI,CAAA,sDAAsD,CAAC;IACpE,CAAC;SAAM,CAAC;QACN,OAAO,IAAI,CAAA,oDAAoD,CAAC;IAClE,CAAC;AACH,CAAC","sourcesContent":["import { html } from '@prairielearn/html';\n\nimport { type StripeCheckoutSession } from '../../../../lib/db-types.js';\nimport { type Purchase } from '../purchases.js';\nimport { formatStripePrice } from '../stripe.js';\n\nexport function UserSettingsPurchasesCard({ purchases }: { purchases: Purchase[] }) {\n  return html`\n    <div class=\"card mb-4\">\n      <div class=\"card-header bg-primary text-white d-flex\">\n        <h2>Purchases</h2>\n      </div>\n\n      ${purchases.length === 0\n        ? html` <div class=\"card-body text-muted\">You don't currently have any purchases.</div> `\n        : PurchaseTable({ purchases })}\n    </div>\n  `;\n}\n\nfunction PurchaseTable({ purchases }: { purchases: Purchase[] }) {\n  return html`\n    <div class=\"table-responsive\">\n      <table class=\"table\" aria-label=\"Purchases\">\n        <thead>\n          <tr>\n            <th>ID</th>\n            <th>Course</th>\n            <th>Date</th>\n            <th>Amount</th>\n            <th>Status</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${purchases.map((purchase) => {\n            const courseName = purchase.course\n              ? `${purchase.course.short_name}: ${purchase.course.title}`\n              : 'Unknown course';\n\n            const courseInstanceName =\n              purchase.course_instance?.long_name ?? 'Unknown course instance';\n\n            return html`<tr>\n              <td>${purchase.stripe_checkout_session.id}</td>\n              <td>\n                <a\n                  ${purchase.course_instance == null\n                    ? ''\n                    : html`href=\"/pl/course_instance/${purchase.course_instance?.id}\"`}\n                >\n                  ${courseName} (${courseInstanceName})\n                </a>\n              </td>\n              <td>${purchase.stripe_checkout_session.created_at?.toUTCString()}</td>\n              <td>${formatStripePrice(purchase.stripe_checkout_session.data.amount_total)} USD</td>\n              <td>\n                ${StripeCheckoutSessionPaymentStatus({\n                  session: purchase.stripe_checkout_session,\n                })}\n              </td>\n            </tr>`;\n          })}\n        </tbody>\n      </table>\n      <div class=\"card-footer\">\n        Contact <a href=\"mailto:support@prairielearn.com\">support@prairielearn.com</a>\n        to request a refund or if you have any questions about your purchases.\n      </div>\n    </div>\n  `;\n}\n\nfunction StripeCheckoutSessionPaymentStatus({ session }: { session: StripeCheckoutSession }) {\n  if (session.data.payment_status === 'paid') {\n    return html`<span class=\"badge text-bg-success\">Payment received</span>`;\n  } else if (session.data.payment_status === 'unpaid') {\n    return html`<span class=\"badge text-bg-secondary\">Pending</span>`;\n  } else {\n    return html`<span class=\"badge text-bg-warning\">Unknown</span>`;\n  }\n}\n"]}