{"version":3,"file":"administratorInstitutionGeneral.html.js","sourceRoot":"","sources":["../../../../src/ee/pages/administratorInstitutionGeneral/administratorInstitutionGeneral.html.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,CAAC,EAAE,MAAM,KAAK,CAAC;AAExB,OAAO,EAAE,iBAAiB,EAAE,MAAM,+BAA+B,CAAC;AAClE,OAAO,EAAkB,IAAI,EAAE,MAAM,oBAAoB,CAAC;AAE1D,OAAO,EAAE,UAAU,EAAE,MAAM,wCAAwC,CAAC;AACpE,OAAO,EAAoC,MAAM,0BAA0B,CAAC;AAC5E,OAAO,EAAiB,cAAc,EAAE,MAAM,2BAA2B,CAAC;AAC1E,OAAO,EAAE,gBAAgB,EAAE,MAAM,uDAAuD,CAAC;AAEzF,MAAM,CAAC,MAAM,2BAA2B,GAAG,CAAC,CAAC,MAAM,CAAC;IAClD,YAAY,EAAE,CAAC,CAAC,MAAM,EAAE;IACxB,qBAAqB,EAAE,CAAC,CAAC,MAAM,EAAE;IACjC,gBAAgB,EAAE,CAAC,CAAC,MAAM,EAAE;CAC7B,CAAC,CAAC;AAGH,MAAM,UAAU,+BAA+B,CAAC,EAC9C,WAAW,EACX,kBAAkB,EAClB,UAAU,EACV,UAAU,EACV,SAAS,GAOV;IACC,OAAO,UAAU,CAAC;QAChB,SAAS,EAAE,4BAA4B;QACvC,SAAS,EAAE;YACT,GAAG,SAAS;YACZ,WAAW;SACZ;QACD,WAAW,EAAE,IAAI,CAAA;QACb,iBAAiB,CAAC,0CAA0C,CAAC;;;;;;;;;;;;;;KAchE;QACD,UAAU,EAAE;YACV,IAAI,EAAE,2BAA2B;YACjC,IAAI,EAAE,2BAA2B;YACjC,OAAO,EAAE,SAAS;SACnB;QACD,OAAO,EAAE,IAAI,CAAA;;;UAGP,cAAc,CAAC,EAAE,KAAK,EAAE,SAAS,EAAE,KAAK,EAAE,UAAU,CAAC,YAAY,EAAE,CAAC;UACpE,cAAc,CAAC;YACf,KAAK,EAAE,kBAAkB;YACzB,KAAK,EAAE,UAAU,CAAC,qBAAqB;SACxC,CAAC;UACA,cAAc,CAAC,EAAE,KAAK,EAAE,aAAa,EAAE,KAAK,EAAE,UAAU,CAAC,gBAAgB,EAAE,CAAC;;;;;;;;;;;qBAWjE,WAAW,CAAC,UAAU;;;;;;;;;;;;;qBAatB,WAAW,CAAC,SAAS;;;;;;;;;;;;qBAYrB,WAAW,CAAC,gBAAgB;;cAEnC,kBAAkB,CAAC,GAAG,CACtB,CAAC,EAAE,EAAE,EAAE,CAAC,IAAI,CAAA;;2BAEC,EAAE,CAAC,IAAI;oBACd,WAAW,CAAC,gBAAgB,KAAK,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE;;oBAE1D,cAAc,CAAC,EAAE,CAAC;;eAEvB,CACF;;;;;;;;;;;;;;;;;qBAiBQ,WAAW,CAAC,UAAU;;;;;;;;;;;;;;;;qBAgBtB,WAAW,CAAC,gCAAgC;;;;;;;;;;;;;;;;qBAgB5C,WAAW,CAAC,uBAAuB;;;;;;;;;;0DAUE,SAAS,CAAC,YAAY;;;;;;;;;;;;QAYxE,gBAAgB,CAAC;YACjB,UAAU;YACV,wEAAwE;YACxE,4CAA4C;YAC5C,iBAAiB,EAAE,CAAC,OAAO,CAAC;YAC5B,SAAS,EAAE,SAAS,CAAC,YAAY;SAClC,CAAC;KACH;KACF,CAAC,CAAC;AACL,CAAC;AAED,SAAS,cAAc,CAAC,EAAE,KAAK,EAAE,KAAK,EAAuC;IAC3E,OAAO,IAAI,CAAA;;yBAEY,KAAK;iCACG,KAAK;;GAEnC,CAAC;AACJ,CAAC","sourcesContent":["import { z } from 'zod';\n\nimport { compiledScriptTag } from '@prairielearn/compiled-assets';\nimport { type HtmlValue, html } from '@prairielearn/html';\n\nimport { PageLayout } from '../../../components/PageLayout.html.js';\nimport { type Institution, type PlanGrant } from '../../../lib/db-types.js';\nimport { type Timezone, formatTimezone } from '../../../lib/timezones.js';\nimport { PlanGrantsEditor } from '../../lib/billing/components/PlanGrantsEditor.html.js';\n\nexport const InstitutionStatisticsSchema = z.object({\n  course_count: z.number(),\n  course_instance_count: z.number(),\n  enrollment_count: z.number(),\n});\ntype InstitutionStatistics = z.infer<typeof InstitutionStatisticsSchema>;\n\nexport function AdministratorInstitutionGeneral({\n  institution,\n  availableTimezones,\n  statistics,\n  planGrants,\n  resLocals,\n}: {\n  institution: Institution;\n  availableTimezones: Timezone[];\n  statistics: InstitutionStatistics;\n  planGrants: PlanGrant[];\n  resLocals: Record<string, any>;\n}) {\n  return PageLayout({\n    pageTitle: 'Institution Administration',\n    resLocals: {\n      ...resLocals,\n      institution,\n    },\n    headContent: html`\n      ${compiledScriptTag('administratorInstitutionGeneralClient.ts')}\n      <style>\n        .card-grid {\n          display: grid;\n          grid-template-columns: repeat(1, 1fr);\n          gap: 1rem;\n        }\n\n        @media (min-width: 768px) {\n          .card-grid {\n            grid-template-columns: repeat(3, 1fr);\n          }\n        }\n      </style>\n    `,\n    navContext: {\n      type: 'administrator_institution',\n      page: 'administrator_institution',\n      subPage: 'general',\n    },\n    content: html`\n      <h2 class=\"h4\">Statistics</h2>\n      <div class=\"card-grid mb-3\">\n        ${StatisticsCard({ title: 'Courses', value: statistics.course_count })}\n        ${StatisticsCard({\n          title: 'Course instances',\n          value: statistics.course_instance_count,\n        })}\n        ${StatisticsCard({ title: 'Enrollments', value: statistics.enrollment_count })}\n      </div>\n      <h2 class=\"h4\">General Information</h2>\n      <form method=\"POST\" class=\"mb-3\">\n        <div class=\"mb-3\">\n          <label class=\"form-label\" for=\"short_name\">Short name</label>\n          <input\n            type=\"text\"\n            class=\"form-control\"\n            id=\"short_name\"\n            name=\"short_name\"\n            value=\"${institution.short_name}\"\n          />\n          <small id=\"short_name_help\" class=\"form-text text-muted\">\n            Use an abbreviation or short name. E.g., \"UIUC\" or \"Berkeley\".\n          </small>\n        </div>\n        <div class=\"mb-3\">\n          <label class=\"form-label\" for=\"long_name\">Long name</label>\n          <input\n            type=\"text\"\n            class=\"form-control\"\n            id=\"long_name\"\n            name=\"long_name\"\n            value=\"${institution.long_name}\"\n          />\n          <small id=\"long_name_help\" class=\"form-text text-muted\">\n            Use the full name of the university. E.g., \"University of Illinois Urbana-Champaign\".\n          </small>\n        </div>\n        <div class=\"mb-3\">\n          <label class=\"form-label\" for=\"display_timezone\">Timezone</label>\n          <select\n            class=\"form-select\"\n            id=\"display_timezone\"\n            name=\"display_timezone\"\n            value=\"${institution.display_timezone}\"\n          >\n            ${availableTimezones.map(\n              (tz) => html`\n                <option\n                  value=\"${tz.name}\"\n                  ${institution.display_timezone === tz.name ? 'selected' : ''}\n                >\n                  ${formatTimezone(tz)}\n                </option>\n              `,\n            )}\n          </select>\n          <small id=\"display_timezone_help\" class=\"form-text text-muted\">\n            The allowable timezones are from the\n            <a href=\"https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\" target=\"_blank\"\n              >tz database</a\n            >. It's best to use a city-based timezone that has the same times as you. E.g.,\n            \"America/Chicago\".\n          </small>\n        </div>\n        <div class=\"mb-3\">\n          <label class=\"form-label\" for=\"uid_regexp\">UID regexp</label>\n          <input\n            type=\"text\"\n            class=\"form-control\"\n            id=\"uid_regexp\"\n            name=\"uid_regexp\"\n            value=\"${institution.uid_regexp}\"\n          />\n          <small id=\"uid_regexp_help\" class=\"form-text text-muted\">\n            Should match the non-username part of students' UIDs. E.g., @example\\\\.com$.\n          </small>\n        </div>\n        <h2 class=\"h4\">Limits</h2>\n        <div class=\"mb-3\">\n          <label class=\"form-label\" for=\"course_instance_enrollment_limit\">\n            Course instance enrollment limit\n          </label>\n          <input\n            type=\"number\"\n            class=\"form-control\"\n            id=\"course_instance_enrollment_limit\"\n            name=\"course_instance_enrollment_limit\"\n            value=\"${institution.course_instance_enrollment_limit}\"\n            required\n            aria-describedby=\"course_instance_enrollment_limit_help\"\n          />\n          <small id=\"course_instance_enrollment_limit_help\" class=\"form-text text-muted\">\n            The maximum number of enrollments allowed for a single course instance. This value can\n            be overridden on individual courses and course instances.\n          </small>\n        </div>\n        <div class=\"mb-3\">\n          <label class=\"form-label\" for=\"yearly_enrollment_limit\">Yearly enrollment limit</label>\n          <input\n            type=\"number\"\n            class=\"form-control\"\n            id=\"yearly_enrollment_limit\"\n            name=\"yearly_enrollment_limit\"\n            value=\"${institution.yearly_enrollment_limit}\"\n            required\n            aria-describedby=\"yearly_enrollment_limit_help\"\n          />\n          <small id=\"yearly_enrollment_limit_help\" class=\"form-text text-muted\">\n            The maximum number of enrollments allowed per year. The limit is applied on a rolling\n            basis; that is, it applies to the previous 365 days from the instant a student attempts\n            to enroll.\n          </small>\n        </div>\n        <input type=\"hidden\" name=\"__csrf_token\" value=\"${resLocals.__csrf_token}\" />\n        <button\n          type=\"submit\"\n          name=\"__action\"\n          value=\"update_enrollment_limits\"\n          class=\"btn btn-primary\"\n        >\n          Save\n        </button>\n      </form>\n\n      <h2 class=\"h4\">Plans</h2>\n      ${PlanGrantsEditor({\n        planGrants,\n        // The basic plan is never available at the institution level; it's only\n        // used for student billing for enrollments.\n        excludedPlanNames: ['basic'],\n        csrfToken: resLocals.__csrf_token,\n      })}\n    `,\n  });\n}\n\nfunction StatisticsCard({ title, value }: { title: string; value: HtmlValue }) {\n  return html`\n    <div class=\"card d-flex flex-column p-3 align-items-center\">\n      <span class=\"h4\">${value}</span>\n      <span class=\"text-muted\">${title}</span>\n    </div>\n  `;\n}\n"]}