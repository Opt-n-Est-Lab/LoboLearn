{"version":3,"file":"content-security-policy.js","sourceRoot":"","sources":["../../src/middlewares/content-security-policy.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,MAAM,SAAS,CAAC;AACjC,OAAO,SAAS,MAAM,YAAY,CAAC;AAEnC,MAAM,MAAM,GAAG,MAAM,EAAE,CAAC;AAExB,MAAM,CAAC,GAAG,CAAC,IAAI,EAAE,UAAU,GAAG,EAAE,GAAG,EAAE,IAAI;IACvC,wDAAwD;IACxD,EAAE;IACF,4EAA4E;IAC5E,aAAa;IACb,GAAG,CAAC,MAAM,CAAC,yBAAyB,EAAE,yBAAyB,CAAC,CAAC;IAEjE,yDAAyD;IACzD,GAAG,CAAC,MAAM,CAAC,iBAAiB,EAAE,MAAM,CAAC,CAAC;IAEtC,SAAS,CAAC,GAAG,EAAE,GAAG,EAAE;QAClB,IAAI,GAAG,CAAC,SAAS,CAAC,cAAc,CAAC,KAAK,iBAAiB,EAAE,CAAC;YACxD,8EAA8E;YAC9E,8DAA8D;YAC9D,GAAG,CAAC,MAAM,CAAC,yBAAyB,EAAE,yBAAyB,CAAC,CAAC;YACjE,GAAG,CAAC,MAAM,CAAC,iBAAiB,EAAE,YAAY,CAAC,CAAC;QAC9C,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,IAAI,EAAE,CAAC;AACT,CAAC,CAAC,CAAC;AAEH,eAAe,MAAM,CAAC","sourcesContent":["import { Router } from 'express';\nimport onHeaders from 'on-headers';\n\nconst router = Router();\n\nrouter.all('/*', function (req, res, next) {\n  // https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP\n  //\n  // Currently, we only use CSP to prevent PrairieLearn from being rendered in\n  // an iframe.\n  res.header('Content-Security-Policy', \"frame-ancestors 'none';\");\n\n  // Added for backwards compatibility with older browsers.\n  res.header('X-Frame-Options', 'DENY');\n\n  onHeaders(res, () => {\n    if (res.getHeader('Content-Type') === 'application/pdf') {\n      // Loosen CSP restrictions for PDF files, as they can cause issues if the file\n      // is embedded, and are not expected to cause issues with XSS.\n      res.header('Content-Security-Policy', \"frame-ancestors 'self';\");\n      res.header('X-Frame-Options', 'SAMEORIGIN');\n    }\n  });\n\n  next();\n});\n\nexport default router;\n"]}