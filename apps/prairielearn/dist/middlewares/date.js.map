{"version":3,"file":"date.js","sourceRoot":"","sources":["../../src/middlewares/date.ts"],"names":[],"mappings":"AAAA,OAAO,EAAkD,MAAM,SAAS,CAAC;AAEzE,OAAO,EAAE,MAAM,EAAE,MAAM,kBAAkB,CAAC;AAE1C,MAAM,CAAC,OAAO,WAAW,GAAY,EAAE,GAAa,EAAE,IAAkB;IACtE,GAAG,CAAC,MAAM,CAAC,QAAQ,GAAG,IAAI,IAAI,EAAE,CAAC;IACjC,GAAG,CAAC,MAAM,CAAC,aAAa,GAAG,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC;IAE/C,sFAAsF;IACtF,kFAAkF;IAClF,IAAI,MAAM,CAAC,OAAO,IAAI,GAAG,CAAC,OAAO,CAAC,YAAY,EAAE,CAAC;QAC/C,GAAG,CAAC,MAAM,CAAC,QAAQ,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC;IACvE,CAAC;IAED,IAAI,EAAE,CAAC;AACT,CAAC","sourcesContent":["import { type NextFunction, type Request, type Response } from 'express';\n\nimport { config } from '../lib/config.js';\n\nexport default function (req: Request, res: Response, next: NextFunction) {\n  res.locals.req_date = new Date();\n  res.locals.true_req_date = res.locals.req_date;\n\n  // We allow unit tests to override the req_date. Unit tests may also override the user\n  // (middlewares/authn.js) and the req_mode (middlewares/authzCourseOrInstance.js).\n  if (config.devMode && req.cookies.pl_test_date) {\n    res.locals.req_date = new Date(Date.parse(req.cookies.pl_test_date));\n  }\n\n  next();\n}\n"]}