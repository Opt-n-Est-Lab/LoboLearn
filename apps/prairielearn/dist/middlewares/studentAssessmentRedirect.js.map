{"version":3,"file":"studentAssessmentRedirect.js","sourceRoot":"","sources":["../../src/middlewares/studentAssessmentRedirect.ts"],"names":[],"mappings":"AAAA,OAAO,YAAY,MAAM,uBAAuB,CAAC;AAEjD,OAAO,EAAE,YAAY,EAAE,gBAAgB,EAAE,MAAM,wBAAwB,CAAC;AAExE,OAAO,EAAE,QAAQ,EAAE,MAAM,oBAAoB,CAAC;AAE9C,MAAM,GAAG,GAAG,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAE1C,eAAe,YAAY,CAAC,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE;IACnD,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,iBAAiB,EAAE,CAAC;QAC7C,yEAAyE;QACzE,mCAAmC;QACnC,MAAM,sBAAsB,GAAG,MAAM,gBAAgB,CACnD,GAAG,CAAC,iCAAiC,EACrC;YACE,aAAa,EAAE,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE;YACvC,OAAO,EAAE,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO;SACjC,EACD,QAAQ,CACT,CAAC;QACF,IAAI,sBAAsB,IAAI,IAAI,EAAE,CAAC;YACnC,GAAG,CAAC,QAAQ,CAAC,GAAG,GAAG,CAAC,MAAM,CAAC,SAAS,wBAAwB,sBAAsB,EAAE,CAAC,CAAC;YACtF,OAAO;QACT,CAAC;IACH,CAAC;IACD,IAAI,EAAE,CAAC;AACT,CAAC,CAAC,CAAC","sourcesContent":["import asyncHandler from 'express-async-handler';\n\nimport { loadSqlEquiv, queryOptionalRow } from '@prairielearn/postgres';\n\nimport { IdSchema } from '../lib/db-types.js';\n\nconst sql = loadSqlEquiv(import.meta.url);\n\nexport default asyncHandler(async (req, res, next) => {\n  if (!res.locals.assessment.multiple_instance) {\n    // If the assessment is single-instance, check if the user already has an\n    // instance. If so, redirect to it.\n    const assessment_instance_id = await queryOptionalRow(\n      sql.select_single_assessment_instance,\n      {\n        assessment_id: res.locals.assessment.id,\n        user_id: res.locals.user.user_id,\n      },\n      IdSchema,\n    );\n    if (assessment_instance_id != null) {\n      res.redirect(`${res.locals.urlPrefix}/assessment_instance/${assessment_instance_id}`);\n      return;\n    }\n  }\n  next();\n});\n"]}