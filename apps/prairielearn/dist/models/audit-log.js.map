{"version":3,"file":"audit-log.js","sourceRoot":"","sources":["../../src/models/audit-log.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,YAAY,EAAE,QAAQ,EAAE,MAAM,wBAAwB,CAAC;AAEhE,OAAO,EAAiB,cAAc,EAAE,MAAM,oBAAoB,CAAC;AAEnE,MAAM,GAAG,GAAG,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAM1C,MAAM,CAAC,KAAK,UAAU,cAAc,CAAC,QAAqB;IACxD,OAAO,MAAM,QAAQ,CACnB,GAAG,CAAC,gBAAgB,EACpB;QACE,MAAM,EAAE,QAAQ,CAAC,MAAM;QACvB,aAAa,EAAE,QAAQ,CAAC,aAAa,IAAI,IAAI;QAC7C,WAAW,EAAE,QAAQ,CAAC,WAAW,IAAI,IAAI;QACzC,SAAS,EAAE,QAAQ,CAAC,SAAS,IAAI,IAAI;QACrC,kBAAkB,EAAE,QAAQ,CAAC,kBAAkB,IAAI,IAAI;QACvD,QAAQ,EAAE,QAAQ,CAAC,QAAQ,IAAI,IAAI;QACnC,cAAc,EAAE,QAAQ,CAAC,cAAc,IAAI,IAAI;QAC/C,SAAS,EAAE,QAAQ,CAAC,SAAS,IAAI,IAAI;QACrC,SAAS,EAAE,QAAQ,CAAC,SAAS,IAAI,IAAI;QACrC,UAAU,EAAE,QAAQ,CAAC,UAAU,IAAI,IAAI;QACvC,MAAM,EAAE,QAAQ,CAAC,MAAM,IAAI,IAAI;QAC/B,UAAU,EAAE,QAAQ,CAAC,UAAU;QAC/B,OAAO,EAAE,QAAQ,CAAC,OAAO,IAAI,IAAI;KAClC,EACD,cAAc,CACf,CAAC;AACJ,CAAC","sourcesContent":["import { loadSqlEquiv, queryRow } from '@prairielearn/postgres';\n\nimport { type AuditLog, AuditLogSchema } from '../lib/db-types.js';\n\nconst sql = loadSqlEquiv(import.meta.url);\n\ntype BaseNewAuditLog = Omit<AuditLog, 'id' | 'date'>;\ntype RequiredNewAuditLog = Required<Pick<BaseNewAuditLog, 'action' | 'table_name'>>;\ntype NewAuditLog = RequiredNewAuditLog & Partial<Omit<BaseNewAuditLog, keyof RequiredNewAuditLog>>;\n\nexport async function insertAuditLog(auditLog: NewAuditLog): Promise<AuditLog> {\n  return await queryRow(\n    sql.insert_audit_log,\n    {\n      action: auditLog.action,\n      authn_user_id: auditLog.authn_user_id ?? null,\n      column_name: auditLog.column_name ?? null,\n      course_id: auditLog.course_id ?? null,\n      course_instance_id: auditLog.course_instance_id ?? null,\n      group_id: auditLog.group_id ?? null,\n      institution_id: auditLog.institution_id ?? null,\n      new_state: auditLog.new_state ?? null,\n      old_state: auditLog.old_state ?? null,\n      parameters: auditLog.parameters ?? null,\n      row_id: auditLog.row_id ?? null,\n      table_name: auditLog.table_name,\n      user_id: auditLog.user_id ?? null,\n    },\n    AuditLogSchema,\n  );\n}\n"]}