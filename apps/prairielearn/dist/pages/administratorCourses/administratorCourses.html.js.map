{"version":3,"file":"administratorCourses.html.js","sourceRoot":"","sources":["../../../src/pages/administratorCourses/administratorCourses.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { type z } from 'zod';\n\nimport { escapeHtml, html } from '@prairielearn/html';\n\nimport { CourseRequestsTable } from '../../components/CourseRequestsTable.html.js';\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { config } from '../../lib/config.js';\nimport { type CourseRequestRow } from '../../lib/course-request.js';\nimport { CourseSchema, type Institution, InstitutionSchema } from '../../lib/db-types.js';\n\nexport const CourseWithInstitutionSchema = CourseSchema.extend({\n  institution: InstitutionSchema,\n});\ntype CourseWithInstitution = z.infer<typeof CourseWithInstitutionSchema>;\n\nexport function AdministratorCourses({\n  course_requests,\n  institutions,\n  courses,\n  coursesRoot,\n  resLocals,\n}: {\n  course_requests: CourseRequestRow[];\n  institutions: Institution[];\n  courses: CourseWithInstitution[];\n  coursesRoot: string;\n  resLocals: Record<string, any>;\n}) {\n  return PageLayout({\n    resLocals,\n    pageTitle: 'Courses',\n    navContext: {\n      type: 'plain',\n      page: 'admin',\n      subPage: 'courses',\n    },\n    options: {\n      fullWidth: true,\n    },\n    content: html`\n      <h1 class=\"visually-hidden\">Courses</h1>\n      ${CourseRequestsTable({\n        rows: course_requests,\n        institutions,\n        coursesRoot,\n        csrfToken: resLocals.__csrf_token,\n        urlPrefix: resLocals.urlPrefix,\n        showAll: false,\n      })}\n\n      <div id=\"courses\" class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white d-flex align-items-center\">\n          <h2>Courses</h2>\n          <button\n            type=\"button\"\n            class=\"btn btn-sm btn-light ms-auto\"\n            data-bs-toggle=\"popover\"\n            data-bs-container=\"body\"\n            data-bs-html=\"true\"\n            data-bs-placement=\"auto\"\n            data-bs-title=\"Add new course\"\n            data-bs-content=\"${escapeHtml(\n              CourseInsertForm({\n                institutions,\n                csrfToken: resLocals.__csrf_token,\n              }),\n            )}\"\n          >\n            <i class=\"fa fa-plus\" aria-hidden=\"true\"></i>\n            <span class=\"d-none d-sm-inline\">Add course</span>\n          </button>\n        </div>\n        <div class=\"table-responsive\">\n          <table class=\"table table-sm table-hover table-striped\" aria-label=\"Courses\">\n            <thead>\n              <tr>\n                <th>Institution</th>\n                <th>Short name</th>\n                <th>Title</th>\n                <th>Timezone</th>\n                <th>Path</th>\n                <th>Repository</th>\n                <th>Branch</th>\n                <th>Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${courses.map((course) => {\n                return html`\n                  <tr>\n                    <td>\n                      <a href=\"/pl/administrator/institution/${course.institution.id}\">\n                        ${course.institution.short_name}\n                      </a>\n                    </td>\n                    ${CourseUpdateColumn({\n                      course,\n                      column_name: 'short_name',\n                      label: 'short name',\n                      href: `/pl/course/${course.id}`,\n                      csrfToken: resLocals.__csrf_token,\n                    })}\n                    ${CourseUpdateColumn({\n                      course,\n                      column_name: 'title',\n                      label: 'title',\n                      csrfToken: resLocals.__csrf_token,\n                    })}\n                    ${CourseUpdateColumn({\n                      course,\n                      column_name: 'display_timezone',\n                      label: 'timezone',\n                      csrfToken: resLocals.__csrf_token,\n                    })}\n                    ${CourseUpdateColumn({\n                      course,\n                      column_name: 'path',\n                      label: 'path',\n                      csrfToken: resLocals.__csrf_token,\n                    })}\n                    ${CourseUpdateColumn({\n                      course,\n                      column_name: 'repository',\n                      label: 'repository',\n                      csrfToken: resLocals.__csrf_token,\n                    })}\n                    ${CourseUpdateColumn({\n                      course,\n                      column_name: 'branch',\n                      label: 'branch',\n                      csrfToken: resLocals.__csrf_token,\n                    })}\n                    <td class=\"align-middle\">\n                      <button\n                        type=\"button\"\n                        class=\"btn btn-sm btn-danger text-nowrap\"\n                        id=\"courseDeleteButton${course.id}\"\n                        data-bs-toggle=\"popover\"\n                        data-bs-container=\"body\"\n                        data-bs-html=\"true\"\n                        data-bs-placement=\"auto\"\n                        data-bs-title=\"Confirm deletion of ${course.short_name}\"\n                        data-bs-content=\"${escapeHtml(\n                          CourseDeleteForm({\n                            id: `courseDeleteButton${course.id}`,\n                            course,\n                            csrfToken: resLocals.__csrf_token,\n                          }),\n                        )}\"\n                      >\n                        <i class=\"fa fa-times\" aria-hidden=\"true\"></i> Delete course\n                      </button>\n                    </td>\n                  </tr>\n                `;\n              })}\n            </tbody>\n          </table>\n        </div>\n        <div class=\"card-footer\">\n          <small>\n            When a course is synced, if the <strong>path</strong> does not exist on disk then a\n            <code>git clone</code> is performed from the <strong>repository</strong>, otherwise a\n            <code>git pull</code> is run in the <strong>path</strong> directory. The\n            <strong>short name</strong> and <strong>title</strong> are updated from the JSON\n            configuration file in the repository during the sync.\n          </small>\n        </div>\n      </div>\n    `,\n  });\n}\n\nfunction CourseDeleteForm({\n  id,\n  course,\n  csrfToken,\n}: {\n  id: string;\n  course: CourseWithInstitution;\n  csrfToken: string;\n}) {\n  return html`\n    <form name=\"add-user-form\" method=\"POST\">\n      <input type=\"hidden\" name=\"__action\" value=\"courses_delete\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <input type=\"hidden\" name=\"course_id\" value=\"${course.id}\" />\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"inputConfirm${id}\">\n          Type \"${course.short_name}\" to confirm:\n        </label>\n        <input type=\"text\" class=\"form-control\" id=\"inputConfirm${id}\" name=\"confirm_short_name\" />\n      </div>\n      <div class=\"text-right\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"popover\">Cancel</button>\n        <button type=\"submit\" class=\"btn btn-danger\">Delete course</button>\n      </div>\n    </form>\n  `;\n}\n\nfunction CourseInsertForm({\n  institutions,\n  csrfToken,\n}: {\n  institutions: Institution[];\n  csrfToken: string;\n}) {\n  return html`\n    <form name=\"add-course-form\" method=\"POST\">\n      <input type=\"hidden\" name=\"__action\" value=\"courses_insert\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <div class=\"mb-3\">\n        <label class=\"form-label\">Institution:</label>\n        <select\n          name=\"institution_id\"\n          class=\"form-select\"\n          onchange=\"this.closest('form').querySelector('[name=display_timezone]').value = this.querySelector('option:checked').dataset.timezone;\"\n        >\n          ${institutions.map((i) => {\n            return html`\n              <option value=\"${i.id}\" data-timezone=\"${i.display_timezone}\">${i.short_name}</option>\n            `;\n          })}\n        </select>\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"courseAddInputShortName\">Short name:</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"courseAddInputShortName\"\n          name=\"short_name\"\n          placeholder=\"XC 101\"\n        />\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"courseAddInputTitle\">Title:</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"courseAddInputTitle\"\n          name=\"title\"\n          placeholder=\"Template course title\"\n        />\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"courseAddInputTimezone\">Timezone:</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"courseAddInputTimezone\"\n          name=\"display_timezone\"\n          value=\"${institutions[0]?.display_timezone}\"\n        />\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"courseAddInputPath\">Path:</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"courseAddInputPath\"\n          name=\"path\"\n          value=\"/data1/courses/pl-XXX\"\n        />\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"courseAddInputRepository\">Repository:</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"courseAddInputRepository\"\n          name=\"repository\"\n          value=\"git@github.com:PrairieLearn/pl-XXX.git\"\n        />\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"courseAddInputBranch\">Branch:</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"courseAddInputBranch\"\n          name=\"branch\"\n          value=\"${config.courseRepoDefaultBranch}\"\n        />\n      </div>\n      <div class=\"text-right\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"popover\">Cancel</button>\n        <button type=\"submit\" class=\"btn btn-primary\">Add course</button>\n      </div>\n    </form>\n  `;\n}\n\nfunction CourseUpdateColumn({\n  course,\n  column_name,\n  label,\n  href,\n  csrfToken,\n}: {\n  course: CourseWithInstitution;\n  column_name: keyof CourseWithInstitution;\n  label: string;\n  href?: string;\n  csrfToken: string;\n}) {\n  return html`\n    <td class=\"align-middle\">\n      ${typeof href !== 'undefined'\n        ? html`<a href=\"${href}\">${course[column_name]}</a>`\n        : course[column_name]}\n      <button\n        type=\"button\"\n        class=\"btn btn-xs btn-secondary\"\n        data-bs-toggle=\"popover\"\n        data-bs-container=\"body\"\n        data-bs-html=\"true\"\n        data-bs-placement=\"auto\"\n        data-bs-title=\"Change ${label}\"\n        data-bs-content=\"${escapeHtml(\n          CourseUpdateColumnForm({\n            course,\n            column_name,\n            csrfToken,\n            label,\n          }),\n        )}\"\n      >\n        <i class=\"fa fa-edit\" aria-hidden=\"true\"></i>\n      </button>\n    </td>\n  `;\n}\n\nfunction CourseUpdateColumnForm({\n  course,\n  column_name,\n  csrfToken,\n  label,\n}: {\n  course: CourseWithInstitution;\n  column_name: keyof CourseWithInstitution;\n  csrfToken: string;\n  label: string;\n}) {\n  return html`\n    <form name=\"edit-course-column-form\" method=\"POST\">\n      <input type=\"hidden\" name=\"__action\" value=\"courses_update_column\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <input type=\"hidden\" name=\"course_id\" value=\"${course.id}\" />\n      <input type=\"hidden\" name=\"column_name\" value=\"${column_name}\" />\n      <div class=\"mb-3\">\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          name=\"value\"\n          value=\"${course[column_name]}\"\n          aria-label=\"${label}\"\n        />\n      </div>\n      <div class=\"text-right\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"popover\">Cancel</button>\n        <button type=\"submit\" class=\"btn btn-primary\">Change</button>\n      </div>\n    </form>\n  `;\n}\n"]}