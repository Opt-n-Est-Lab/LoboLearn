{"version":3,"file":"authLogin.html.js","sourceRoot":"","sources":["../../../src/pages/authLogin/authLogin.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { type HtmlValue, html } from '@prairielearn/html';\n\nimport { HeadContents } from '../../components/HeadContents.html.js';\nimport { assetPath } from '../../lib/assets.js';\nimport { config } from '../../lib/config.js';\nimport { isEnterprise } from '../../lib/license.js';\n\nexport interface InstitutionAuthnProvider {\n  name: string;\n  url: string;\n}\n\nexport interface InstitutionSupportedProviders {\n  name: string;\n  is_default: boolean;\n}\n\nfunction LoginPageContainer({\n  children,\n  service,\n  resLocals,\n}: {\n  children: HtmlValue;\n  service: string | null;\n  resLocals: Record<string, any>;\n}) {\n  return html`\n    <!doctype html>\n    <html lang=\"en\">\n      <head>\n        ${HeadContents({ resLocals })}\n        <style>\n          html,\n          body {\n            min-height: 100vh;\n          }\n\n          .login-container-wrapper {\n            width: 100%;\n            height: 100%;\n          }\n\n          .login-container {\n            background-color: white;\n            padding: 20px;\n            height: 100%;\n          }\n\n          .login-methods > :not(:last-child) {\n            margin-bottom: 0.5rem;\n          }\n\n          @media (min-width: 576px) {\n            html,\n            body {\n              background-color: var(--bs-dark);\n            }\n\n            .login-container-wrapper {\n              max-width: 500px;\n              margin: auto;\n              height: auto;\n            }\n\n            .login-container {\n              border-radius: 5px;\n              box-shadow:\n                0 19px 38px rgba(0, 0, 0, 0.3),\n                0 15px 12px rgba(0, 0, 0, 0.22);\n              height: auto;\n              margin: 20px;\n            }\n          }\n\n          .subheader {\n            font-weight: 300;\n            font-size: 1.2rem;\n          }\n\n          .btn .social-icon {\n            position: absolute;\n            left: 7px;\n            height: 24px;\n            top: 0;\n            bottom: 0;\n            margin: auto;\n          }\n\n          .btn-shib {\n            background-color: ${config.shibLinkColors.normal.background};\n            border-color: ${config.shibLinkColors.normal.border};\n            color: ${config.shibLinkColors.normal.text};\n          }\n\n          .btn-shib:hover {\n            background-color: ${config.shibLinkColors.hover.background};\n            border-color: ${config.shibLinkColors.hover.border};\n            color: ${config.shibLinkColors.hover.text};\n          }\n\n          .btn-shib:focus {\n            box-shadow: 0 0 0 0.2rem ${config.shibLinkColors.focus.shadow};\n          }\n\n          .btn-shib:active {\n            background-color: ${config.shibLinkColors.active.background};\n            border-color: ${config.shibLinkColors.active.border};\n            color: ${config.shibLinkColors.active.text};\n          }\n\n          .institution-header {\n            overflow: hidden;\n            text-align: center;\n          }\n\n          .institution-header:before,\n          .institution-header:after {\n            background-color: #000;\n            content: '';\n            display: inline-block;\n            height: 1px;\n            position: relative;\n            vertical-align: middle;\n            width: 50%;\n          }\n\n          .institution-header:before {\n            right: 0.5em;\n            margin-left: -50%;\n          }\n\n          .institution-header:after {\n            left: 0.5em;\n            margin-right: -50%;\n          }\n        </style>\n      </head>\n      <body class=\"d-flex flex-column\">\n        <main class=\"login-container-wrapper\">\n          <div class=\"login-container\">\n            <div>\n              <h1 class=\"text-center\">\n                <a href=\"https://www.prairielearn.com/\" target=\"_blank\" class=\"text-body\">\n                  PrairieLearn\n                </a>\n              </h1>\n              <h2 class=\"text-center subheader mb-5\">\n                Sign in ${service ? `to continue to ${service}` : ''}\n              </h2>\n              ${children}\n            </div>\n          </div>\n        </main>\n        ${config.homepageFooterText && config.homepageFooterTextHref\n          ? html`\n              <footer class=\"footer small fw-light text-light text-center\">\n                <div class=\"bg-secondary p-1\">\n                  <a class=\"text-light\" href=\"${config.homepageFooterTextHref}\">\n                    ${config.homepageFooterText}\n                  </a>\n                </div>\n              </footer>\n            `\n          : ''}\n      </body>\n    </html>\n  `;\n}\n\nfunction ShibLoginButton() {\n  return html`\n    <a class=\"btn btn-shib d-block position-relative\" href=\"/pl/shibcallback\">\n      ${config.shibLinkLogo != null\n        ? html`<img src=\"${config.shibLinkLogo}\" class=\"social-icon\" />`\n        : html`<span class=\"social-icon\"></span>`}\n      <span class=\"fw-bold\">${config.shibLinkText}</span>\n    </a>\n  `;\n}\n\nfunction GoogleLoginButton() {\n  return html`\n    <a class=\"btn btn-primary d-block position-relative\" href=\"/pl/oauth2login\">\n      <img src=\"${assetPath('/images/google_logo.svg')}\" class=\"social-icon\" />\n      <span class=\"fw-bold\">Sign in with Google</span>\n    </a>\n  `;\n}\n\nfunction MicrosoftLoginButton() {\n  return html`\n    <a class=\"btn btn-dark d-block position-relative\" href=\"/pl/azure_login\">\n      <img src=\"${assetPath('/images/ms_logo.svg')}\" class=\"social-icon\" />\n      <span class=\"fw-bold\">Sign in with Microsoft</span>\n    </a>\n  `;\n}\n\nfunction SamlLoginButton({ institutionId }) {\n  return html`\n    <a class=\"btn btn-primary d-block\" href=\"${`/pl/auth/institution/${institutionId}/saml/login`}\">\n      <span class=\"fw-bold\">Sign in with institution single sign-on</span>\n    </a>\n  `;\n}\n\nexport function AuthLogin({\n  institutionAuthnProviders,\n  service,\n  resLocals,\n}: {\n  institutionAuthnProviders: InstitutionAuthnProvider[] | null;\n  service: string | null;\n  resLocals: Record<string, any>;\n}) {\n  return LoginPageContainer({\n    service,\n    resLocals,\n    children: html`\n      ${config.devMode\n        ? html`\n            ${DevModeBypass()}\n            <hr />\n            ${DevModeLogin({ csrfToken: resLocals.__csrf_token })}\n            <hr />\n          `\n        : ''}\n      <div class=\"login-methods mt-4\">\n        ${config.hasShib && !config.hideShibLogin ? ShibLoginButton() : ''}\n        ${config.hasOauth ? GoogleLoginButton() : ''}\n        ${config.hasAzure && isEnterprise() ? MicrosoftLoginButton() : ''}\n      </div>\n      ${institutionAuthnProviders?.length\n        ? html`\n            <div class=\"institution-header text-muted my-3\">Institution sign-on</div>\n            <div class=\"login-methods\">\n              ${institutionAuthnProviders.map(\n                (provider) => html`\n                  <a href=\"${provider.url}\" class=\"btn btn-outline-dark d-block w-100\">\n                    <span class=\"fw-bold\">${provider.name}</span>\n                  </a>\n                `,\n              )}\n            </div>\n          `\n        : ''}\n    `,\n  }).toString();\n}\n\nexport function AuthLoginUnsupportedProvider({\n  supportedProviders,\n  institutionId,\n  service,\n  resLocals,\n}: {\n  supportedProviders: InstitutionSupportedProviders[];\n  institutionId: string;\n  service: string | null;\n  resLocals: Record<string, any>;\n}) {\n  const supportsLti = supportedProviders.some((p) => p.name === 'LTI');\n  const supportsNonLti = supportedProviders.some((p) => p.name !== 'LTI');\n\n  const supportsSaml = supportedProviders.some((p) => p.name === 'SAML');\n  const supportsShib = supportedProviders.some((p) => p.name === 'Shibboleth');\n  const supportsGoogle = supportedProviders.some((p) => p.name === 'Google');\n  const supportsAzure = supportedProviders.some((p) => p.name === 'Azure');\n\n  const defaultProvider = supportedProviders.find((p) => p.is_default === true);\n  const hasNonDefaultProviders = supportedProviders.find(\n    (p) => p.name !== 'LTI' && p.is_default === false,\n  );\n\n  const showSaml = supportsSaml && defaultProvider?.name !== 'SAML';\n  const showShib =\n    config.hasShib &&\n    !config.hideShibLogin &&\n    supportsShib &&\n    defaultProvider?.name !== 'Shibboleth';\n  const showGoogle = config.hasOauth && supportsGoogle && defaultProvider?.name !== 'Google';\n  const showAzure = config.hasAzure && supportsAzure && defaultProvider?.name !== 'Azure';\n\n  let defaultProviderButton: HtmlValue = null;\n  switch (defaultProvider?.name) {\n    case 'SAML':\n      defaultProviderButton = SamlLoginButton({ institutionId });\n      break;\n    case 'Shibboleth':\n      defaultProviderButton = ShibLoginButton();\n      break;\n    case 'Google':\n      defaultProviderButton = GoogleLoginButton();\n      break;\n    case 'Azure':\n      defaultProviderButton = MicrosoftLoginButton();\n  }\n\n  return LoginPageContainer({\n    service,\n    resLocals,\n    children: html`\n      <div class=\"alert alert-danger text-center my-4\" role=\"alert\">\n        The authentication provider you tried to use is not supported by your institution.\n        ${supportsNonLti ? 'Please use a supported provider.' : ''}\n        ${!supportsNonLti && supportsLti\n          ? \"You must start a session from your course's Learning Management System (LMS).\"\n          : ''}\n        ${supportedProviders.length === 0 ? 'Contact your institution for more information.' : ''}\n      </div>\n      ${defaultProviderButton\n        ? html`\n            <small class=\"text-muted text-center d-block mb-2\">Preferred provider</small>\n            ${defaultProviderButton}\n            ${hasNonDefaultProviders\n              ? html`\n                  <small class=\"text-muted text-center d-block mt-4 mb-2\">Other providers</small>\n                `\n              : ''}\n          `\n        : ''}\n      <div class=\"login-methods\">\n        ${[\n          showSaml ? SamlLoginButton({ institutionId }) : '',\n          showShib ? ShibLoginButton() : '',\n          showGoogle ? GoogleLoginButton() : '',\n          showAzure ? MicrosoftLoginButton() : '',\n        ]}\n      </div>\n    `,\n  }).toString();\n}\n\nfunction DevModeBypass() {\n  return html`\n    <a class=\"btn btn-success w-100\" href=\"/pl/dev_login\">\n      <span class=\"fw-bold\">Dev Mode Bypass</span>\n    </a>\n    <small class=\"text-muted\">You will be authenticated as <tt>${config.authUid}</tt>.</small>\n  `;\n}\n\nfunction DevModeLogin({ csrfToken }: { csrfToken: string }) {\n  return html`\n    <form method=\"POST\">\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"dev_uid\">UID</label>\n        <input type=\"email\" class=\"form-control\" id=\"dev_uid\" name=\"uid\" required />\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"dev_name\">Name</label>\n        <input type=\"text\" class=\"form-control\" id=\"dev_name\" name=\"name\" required />\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"dev_uin\">UIN</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"dev_uin\"\n          name=\"uin\"\n          aria-describedby=\"dev_uin_help\"\n        />\n        <small id=\"dev_uin_help\" class=\"form-text text-muted\">\n          Optional; will be set to <tt>null</tt> if not specified.\n        </small>\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"dev_email\">Email</label>\n        <input\n          type=\"email\"\n          class=\"form-control\"\n          id=\"dev_email\"\n          name=\"email\"\n          aria-describedby=\"dev_email_help\"\n        />\n        <small id=\"dev_email_help\" class=\"form-text text-muted\">\n          Optional; will be set to <tt>null</tt> if not specified.\n        </small>\n      </div>\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <button type=\"submit\" class=\"btn btn-primary d-block w-100\" name=\"__action\" value=\"dev_login\">\n        <span class=\"fw-bold\">Dev Mode Login</span>\n      </button>\n    </form>\n  `;\n}\n"]}