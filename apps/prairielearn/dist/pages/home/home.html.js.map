{"version":3,"file":"home.html.js","sourceRoot":"","sources":["../../../src/pages/home/home.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\n\nimport { html } from '@prairielearn/html';\n\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { config } from '../../lib/config.js';\nimport { CourseInstanceSchema, CourseSchema, type Institution } from '../../lib/db-types.js';\n\nexport const InstructorCourseSchema = z.object({\n  id: CourseSchema.shape.id,\n  short_name: CourseSchema.shape.short_name,\n  title: CourseSchema.shape.title,\n  can_open_course: z.boolean(),\n  course_instances: z.array(\n    z.object({\n      id: CourseInstanceSchema.shape.id,\n      long_name: CourseInstanceSchema.shape.long_name,\n      expired: z.boolean(),\n    }),\n  ),\n});\nexport type InstructorCourse = z.infer<typeof InstructorCourseSchema>;\n\nexport const StudentCourseSchema = z.object({\n  id: CourseInstanceSchema.shape.id,\n  course_short_name: CourseSchema.shape.short_name,\n  course_title: CourseSchema.shape.title,\n  long_name: CourseInstanceSchema.shape.long_name,\n});\nexport type StudentCourse = z.infer<typeof StudentCourseSchema>;\n\nexport function Home({\n  resLocals,\n  instructorCourses,\n  studentCourses,\n  adminInstitutions,\n}: {\n  resLocals: Record<string, any>;\n  instructorCourses: InstructorCourse[];\n  studentCourses: StudentCourse[];\n  adminInstitutions: Institution[];\n}) {\n  const { authn_provider_name } = resLocals;\n\n  return PageLayout({\n    resLocals,\n    pageTitle: 'Home',\n    navContext: {\n      type: 'plain',\n      page: 'home',\n    },\n    options: {\n      fullHeight: true,\n    },\n    content: html`\n      <h1 class=\"visually-hidden\">PrairieLearn Homepage</h1>\n      ${ActionsHeader()}\n\n      <div class=\"container py-5\">\n        ${DevModeCard()} ${AdminInstitutionsCard({ adminInstitutions })}\n        ${InstructorCoursesCard({ instructorCourses })}\n        ${StudentCoursesCard({\n          studentCourses,\n          hasInstructorCourses: instructorCourses.length > 0,\n          canAddCourses: authn_provider_name !== 'LTI',\n        })}\n      </div>\n    `,\n    postContent: html`\n      ${config.homepageFooterText && config.homepageFooterTextHref\n        ? html`\n            <footer class=\"footer fw-light text-light text-center small\">\n              <div class=\"bg-secondary p-1\">\n                <a class=\"text-light\" href=\"${config.homepageFooterTextHref}\">\n                  ${config.homepageFooterText}\n                </a>\n              </div>\n            </footer>\n          `\n        : ''}\n    `,\n  });\n}\n\nfunction ActionsHeader() {\n  return html`\n    <div class=\"container\">\n      <div class=\"row\">\n        <div class=\"col-md-6\">\n          <div class=\"card rounded-pill my-1\">\n            <div class=\"card-body d-flex align-items-center p-2\">\n              <span class=\"fa-stack fa-1x me-1\" aria-hidden=\"true\">\n                <i class=\"fas fa-circle fa-stack-2x text-secondary\"></i>\n                <i class=\"fas fa-user-graduate fa-stack-1x text-light\"></i>\n              </span>\n              <h2 class=\"small p-2 fw-bold text-uppercase text-secondary mb-0\">Students</h2>\n              <a href=\"${config.urlPrefix}/enroll\" class=\"btn btn-xs btn-outline-primary\">\n                Add or remove courses\n              </a>\n            </div>\n          </div>\n        </div>\n        <div class=\"col-md-6\">\n          <div class=\"card rounded-pill my-1\">\n            <div class=\"card-body d-flex align-items-center p-2\">\n              <span class=\"fa-stack fa-1x me-1\" aria-hidden=\"true\">\n                <i class=\"fas fa-circle fa-stack-2x text-secondary\"></i>\n                <i class=\"fas fa-user-tie fa-stack-1x text-light\"></i>\n              </span>\n              <h2 class=\"small p-2 fw-bold text-uppercase text-secondary mb-0\">Instructors</h2>\n              <a href=\"${config.urlPrefix}/request_course\" class=\"btn btn-xs btn-outline-primary\">\n                Request course\n              </a>\n              <a\n                href=\"https://prairielearn.readthedocs.io/en/latest\"\n                class=\"btn btn-xs btn-outline-primary ms-2\"\n              >\n                View docs\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n\nfunction DevModeCard() {\n  if (!config.devMode) return '';\n  return html`\n    <div class=\"card mb-4\">\n      <div class=\"card-header bg-primary text-white\">\n        <h2>Development Mode</h2>\n      </div>\n      <div class=\"card-body\">\n        <p>\n          PrairieLearn is running in Development Mode. Click the\n          <strong>\"Load from disk\"</strong> button above to load question and assessment definitions\n          from JSON files on disk.\n        </p>\n        <p>\n          You need to click \"Load from disk\" every time that a JSON file is changed on disk. Changes\n          to other files (JS, HTML, etc) will be automatically loaded every time you navigate to a\n          different page or if you reload the current page in your web browser.\n        </p>\n        <p class=\"mb-0\">\n          See the\n          <a href=\"https://prairielearn.readthedocs.io\">PrairieLearn documentation</a>\n          for information on creating questions and assessments.\n        </p>\n      </div>\n    </div>\n  `;\n}\n\nfunction AdminInstitutionsCard({ adminInstitutions }: { adminInstitutions: Institution[] }) {\n  if (adminInstitutions.length === 0) return '';\n\n  return html`\n    <div class=\"card mb-4\">\n      <div class=\"card-header bg-primary text-white\">\n        <h2>Institutions with admin access</h2>\n      </div>\n      <ul class=\"list-group list-group-flush\">\n        ${adminInstitutions.map(\n          (institution) => html`\n            <li class=\"list-group-item\">\n              <a href=\"/pl/institution/${institution.id}/admin/courses\">\n                ${institution.short_name}: ${institution.long_name}\n              </a>\n            </li>\n          `,\n        )}\n      </ul>\n    </div>\n  `;\n}\n\nfunction InstructorCoursesCard({ instructorCourses }: { instructorCourses: InstructorCourse[] }) {\n  if (instructorCourses.length === 0) return '';\n\n  return html`\n    <div class=\"card mb-4\">\n      <div class=\"card-header bg-primary text-white\">\n        <h2>Courses with instructor access</h2>\n      </div>\n\n      <table\n        class=\"table table-sm table-hover table-striped\"\n        aria-label=\"Courses with instructor access\"\n      >\n        <tbody>\n          ${instructorCourses.map(\n            (course) => html`\n              <tr>\n                <td class=\"w-50 align-middle\">\n                  ${course.can_open_course\n                    ? html`<a href=\"${config.urlPrefix}/course/${course.id}\">\n                        ${course.short_name}: ${course.title}\n                      </a>`\n                    : `${course.short_name}: ${course.title}`}\n                </td>\n                <td class=\"js-course-instance-list\">\n                  ${CourseInstanceList({\n                    course_instances: course.course_instances.filter((ci) => !ci.expired),\n                  })}\n                  ${course.course_instances.some((ci) => ci.expired)\n                    ? html`\n                        <details>\n                          <summary class=\"text-muted small\">Older instances</summary>\n                          ${CourseInstanceList({\n                            course_instances: course.course_instances.filter((ci) => ci.expired),\n                          })}\n                        </details>\n                      `\n                    : ''}\n                </td>\n              </tr>\n            `,\n          )}\n        </tbody>\n      </table>\n    </div>\n  `;\n}\n\nfunction CourseInstanceList({\n  course_instances,\n}: {\n  course_instances: InstructorCourse['course_instances'];\n}) {\n  return course_instances.map(\n    (course_instance) => html`\n      <a\n        class=\"btn btn-outline-primary btn-sm my-1\"\n        href=\"${config.urlPrefix}/course_instance/${course_instance.id}/instructor\"\n      >\n        ${course_instance.long_name}\n      </a>\n    `,\n  );\n}\n\nfunction StudentCoursesCard({\n  studentCourses,\n  hasInstructorCourses,\n  canAddCourses,\n}: {\n  studentCourses: StudentCourse[];\n  hasInstructorCourses: boolean;\n  canAddCourses: boolean;\n}) {\n  const heading = hasInstructorCourses ? 'Courses with student access' : 'Courses';\n  return html`\n    <div class=\"card mb-4\">\n      <div class=\"card-header bg-primary text-white d-flex align-items-center\">\n        <h2>${heading}</h2>\n        ${canAddCourses\n          ? html`\n              <a href=\"${config.urlPrefix}/enroll\" class=\"btn btn-light btn-sm ms-auto\">\n                <i class=\"fa fa-edit\" aria-hidden=\"true\"></i>\n                <span class=\"d-none d-sm-inline\">Add or remove courses</span>\n              </a>\n            `\n          : ''}\n      </div>\n\n      ${studentCourses.length === 0\n        ? hasInstructorCourses\n          ? html`\n              <div class=\"card-body\">\n                No courses found with student access. Courses with instructor access are found in\n                the list above.\n                ${canAddCourses\n                  ? 'Use the \"Add or remove courses\" button to add a course as a student.'\n                  : ''}\n              </div>\n            `\n          : config.devMode\n            ? html`\n                <div class=\"card-body\">\n                  No courses loaded. Click <strong>\"Load from disk\"</strong> above and then click\n                  <strong>\"PrairieLearn\"</strong> in the top left corner to come back to this page.\n                </div>\n              `\n            : html`\n                <div class=\"card-body\">\n                  No courses found.\n                  ${canAddCourses ? 'Use the \"Add or remove courses\" button to add one.' : ''}\n                </div>\n              `\n        : html`\n            <table class=\"table table-sm table-hover table-striped\" aria-label=\"${heading}\">\n              <tbody>\n                ${studentCourses.map(\n                  (courseInstance) => html`\n                    <tr>\n                      <td>\n                        <a href=\"${config.urlPrefix}/course_instance/${courseInstance.id}\">\n                          ${courseInstance.course_short_name}: ${courseInstance.course_title},\n                          ${courseInstance.long_name}\n                        </a>\n                      </td>\n                    </tr>\n                  `,\n                )}\n              </tbody>\n            </table>\n          `}\n    </div>\n  `;\n}\n"]}