{"version":3,"file":"instructorAssessmentAccess.html.js","sourceRoot":"","sources":["../../../src/pages/instructorAssessmentAccess/instructorAssessmentAccess.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\n\nimport { html } from '@prairielearn/html';\n\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { AssessmentSyncErrorsAndWarnings } from '../../components/SyncErrorsAndWarnings.html.js';\nimport { config } from '../../lib/config.js';\n\nexport const AssessmentAccessRulesSchema = z.object({\n  mode: z.string(),\n  uids: z.string(),\n  start_date: z.string(),\n  end_date: z.string(),\n  credit: z.string(),\n  time_limit: z.string(),\n  password: z.string(),\n  exam_uuid: z.string().nullable(),\n  pt_course_id: z.string().nullable(),\n  pt_course_name: z.string().nullable(),\n  pt_exam_id: z.string().nullable(),\n  pt_exam_name: z.string().nullable(),\n  active: z.string(),\n});\ntype AssessmentAccessRules = z.infer<typeof AssessmentAccessRulesSchema>;\n\nexport function InstructorAssessmentAccess({\n  resLocals,\n  accessRules,\n}: {\n  resLocals: Record<string, any>;\n  accessRules: AssessmentAccessRules[];\n}) {\n  return PageLayout({\n    resLocals,\n    pageTitle: 'Access',\n    navContext: {\n      type: 'instructor',\n      page: 'assessment',\n      subPage: 'access',\n    },\n    options: {\n      fullWidth: true,\n    },\n    content: html`\n      ${AssessmentSyncErrorsAndWarnings({\n        authz_data: resLocals.authz_data,\n        assessment: resLocals.assessment,\n        courseInstance: resLocals.course_instance,\n        course: resLocals.course,\n        urlPrefix: resLocals.urlPrefix,\n      })}\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white d-flex align-items-center\">\n          <h1>${resLocals.assessment_set.name} ${resLocals.assessment.number}: Access</h1>\n        </div>\n\n        <div class=\"table-responsive\">\n          <table class=\"table table-sm table-hover\" aria-label=\"Access rules\">\n            <thead>\n              <tr>\n                <th>Mode</th>\n                <th>UIDs</th>\n                <th>Start date</th>\n                <th>End date</th>\n                <th>Active</th>\n                <th>Credit</th>\n                <th>Time limit</th>\n                <th>Password</th>\n                <th>PrairieTest</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${accessRules.map((access_rule) => {\n                // Only users with permission to view student data are allowed\n                // to see the list of uids associated with an access rule. Note,\n                // however, that any user with permission to view course code\n                // (or with access to the course git repository) will be able to\n                // see the list of uids, because these access rules are defined\n                // in course code. This should be changed in future, to protect\n                // student data. See https://github.com/PrairieLearn/PrairieLearn/issues/3342\n                return html`\n                  <tr>\n                    <td>${access_rule.mode}</td>\n                    <td>\n                      ${access_rule.uids === 'â€”' ||\n                      resLocals.authz_data.has_course_instance_permission_view\n                        ? access_rule.uids\n                        : html`\n                            <button\n                              type=\"button\"\n                              class=\"btn btn-xs btn-warning\"\n                              data-bs-toggle=\"popover\"\n                              data-bs-container=\"body\"\n                              data-bs-placement=\"auto\"\n                              data-bs-title=\"Hidden UIDs\"\n                              data-bs-content=\"This access rule is specific to individual students. You need permission to view student data in order to see which ones.\"\n                            >\n                              Hidden\n                            </button>\n                          `}\n                    </td>\n                    <td>${access_rule.start_date}</td>\n                    <td>${access_rule.end_date}</td>\n                    <td>${access_rule.active}</td>\n                    <td>${access_rule.credit}</td>\n                    <td>${access_rule.time_limit}</td>\n                    <td>${access_rule.password}</td>\n                    <td>\n                      ${access_rule.pt_exam_name\n                        ? html`\n                            <a\n                              href=\"${config.ptHost}/pt/course/${access_rule.pt_course_id}/staff/exam/${access_rule.pt_exam_id}\"\n                            >\n                              ${access_rule.pt_course_name}: ${access_rule.pt_exam_name}\n                            </a>\n                          `\n                        : access_rule.exam_uuid\n                          ? config.devMode\n                            ? access_rule.exam_uuid\n                            : html`\n                                <span class=\"text-danger\">\n                                  Exam not found: ${access_rule.exam_uuid}\n                                </span>\n                              `\n                          : html`&mdash;`}\n                    </td>\n                  </tr>\n                `;\n              })}\n            </tbody>\n          </table>\n        </div>\n        <div class=\"card-footer\">\n          <small>\n            Instructions on how to change the access rules can be found in the\n            <a href=\"https://prairielearn.readthedocs.io/en/latest/accessControl/\" target=\"_blank\"\n              >PrairieLearn documentation</a\n            >. Note that changing time limit rules does not affect assessments in progress; to\n            change the time limit for these exams please visit the\n            <a href=\"${resLocals.urlPrefix}/assessment/${resLocals.assessment.id}/instances\"\n              >Students tab</a\n            >.</small\n          >\n        </div>\n      </div>\n    `,\n  });\n}\n"]}