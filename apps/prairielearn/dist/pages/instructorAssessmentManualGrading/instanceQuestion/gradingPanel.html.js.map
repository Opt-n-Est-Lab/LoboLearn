{"version":3,"file":"gradingPanel.html.js","sourceRoot":"","sources":["../../../../src/pages/instructorAssessmentManualGrading/instanceQuestion/gradingPanel.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { html } from '@prairielearn/html';\n\nimport { type Issue, type User } from '../../../lib/db-types.js';\n\nimport {\n  AutoPointsSection,\n  ManualPointsSection,\n  TotalPointsSection,\n} from './gradingPointsSection.html.js';\nimport { RubricInputSection } from './rubricInputSection.html.js';\n\ninterface SubmissionOrGradingJob {\n  feedback: Record<string, any> | null;\n}\n\nexport function GradingPanel({\n  resLocals,\n  context,\n  graders,\n  disable,\n  hide_back_to_question,\n  skip_text,\n  custom_points,\n  custom_auto_points,\n  custom_manual_points,\n  grading_job,\n}: {\n  resLocals: Record<string, any>;\n  context: 'main' | 'existing' | 'conflicting';\n  graders?: User[] | null;\n  disable?: boolean;\n  hide_back_to_question?: boolean;\n  skip_text?: string;\n  custom_points?: number;\n  custom_auto_points?: number;\n  custom_manual_points?: number;\n  grading_job?: SubmissionOrGradingJob;\n}) {\n  const auto_points = custom_auto_points ?? resLocals.instance_question.auto_points ?? 0;\n  const manual_points = custom_manual_points ?? resLocals.instance_question.manual_points ?? 0;\n  const points = custom_points ?? resLocals.instance_question.points ?? 0;\n  const submission = grading_job ?? resLocals.submission;\n  const assessment_question_url = `${resLocals.urlPrefix}/assessment/${resLocals.assessment_instance.assessment_id}/manual_grading/assessment_question/${resLocals.instance_question.assessment_question_id}`;\n  const open_issues: Issue[] = resLocals.issues.filter((issue) => issue.open);\n  disable = disable || !resLocals.authz_data.has_course_instance_permission_edit;\n  skip_text = skip_text || (disable ? 'Next' : 'Skip');\n\n  return html`\n    <form\n      name=\"manual-grading-form\"\n      method=\"POST\"\n      data-max-auto-points=\"${resLocals.assessment_question.max_auto_points}\"\n      data-max-manual-points=\"${resLocals.assessment_question.max_manual_points}\"\n      data-max-points=\"${resLocals.assessment_question.max_points}\"\n      data-rubric-active=\"${!!resLocals.rubric_data}\"\n      data-rubric-replace-auto-points=\"${resLocals.rubric_data?.replace_auto_points}\"\n      data-rubric-starting-points=\"${resLocals.rubric_data?.starting_points}\"\n      data-rubric-max-extra-points=\"${resLocals.rubric_data?.max_extra_points}\"\n      data-rubric-min-points=\"${resLocals.rubric_data?.min_points}\"\n    >\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${resLocals.__csrf_token}\" />\n      <input type=\"hidden\" name=\"modified_at\" value=\"${resLocals.instance_question.modified_at}\" />\n      <input type=\"hidden\" name=\"submission_id\" value=\"${resLocals.submission.id}\" />\n      <ul class=\"list-group list-group-flush\">\n        ${resLocals.assessment_question.max_points\n          ? // Percentage-based grading is only suitable if the question has points\n            html`\n              <li class=\"list-group-item d-flex justify-content-center\">\n                <span>Points</span>\n                <div class=\"custom-control custom-switch mx-2\">\n                  <input\n                    class=\"custom-control-input js-manual-grading-pts-perc-select\"\n                    name=\"use_score_perc\"\n                    id=\"use-score-perc\"\n                    type=\"checkbox\"\n                  />\n                  <label class=\"custom-control-label\" for=\"use-score-perc\">Percentage</label>\n                </div>\n              </li>\n            `\n          : ''}\n        <li class=\"list-group-item\">\n          ${ManualPointsSection({ context, disable, manual_points, resLocals })}\n          ${!resLocals.rubric_data?.replace_auto_points ||\n          (!resLocals.assessment_question.max_auto_points && !auto_points)\n            ? RubricInputSection({ resLocals, disable })\n            : ''}\n        </li>\n        ${resLocals.assessment_question.max_auto_points || auto_points\n          ? html`\n              <li class=\"list-group-item\">\n                ${AutoPointsSection({ context, disable, auto_points, resLocals })}\n              </li>\n              <li class=\"list-group-item\">\n                ${TotalPointsSection({ context, disable, points, resLocals })}\n                ${resLocals.rubric_data?.replace_auto_points\n                  ? RubricInputSection({ resLocals, disable })\n                  : ''}\n              </li>\n            `\n          : ''}\n        <li class=\"list-group-item\">\n          <label>\n            Feedback:\n            <textarea\n              name=\"submission_note\"\n              class=\"form-control js-submission-feedback\"\n              style=\"min-height: 1em;\"\n              ${disable ? 'readonly' : ''}\n              aria-describedby=\"submission-feedback-help-${context}\"\n            >\n${submission.feedback?.manual}</textarea\n            >\n            <small id=\"submission-feedback-help-${context}\" class=\"form-text text-muted\">\n              Markdown formatting, such as *<em>emphasis</em>* or &#96;<code>code</code>&#96;, is\n              permitted and will be used to format the feedback when presented to the student.\n            </small>\n          </label>\n        </li>\n        ${open_issues.length > 0 && context !== 'existing'\n          ? html`\n              <li class=\"list-group-item\">\n                ${open_issues.map(\n                  (issue) => html`\n                    <div class=\"form-check\">\n                      <input\n                        type=\"checkbox\"\n                        id=\"close-issue-checkbox-${issue.id}\"\n                        class=\"form-check-input\"\n                        name=\"unsafe_issue_ids_close\"\n                        value=\"${issue.id}\"\n                      />\n                      <label class=\"w-100 form-check-label\" for=\"close-issue-checkbox-${issue.id}\">\n                        Close issue #${issue.id}\n                      </label>\n                    </div>\n                  `,\n                )}\n              </li>\n            `\n          : ''}\n        <li class=\"list-group-item d-flex align-items-center\">\n          ${!hide_back_to_question\n            ? html`\n                <a class=\"btn btn-primary\" href=\"${assessment_question_url}\">\n                  <i class=\"fas fa-arrow-left\"></i>\n                  Back to Question\n                </a>\n              `\n            : ''}\n          <span class=\"ms-auto\">\n            ${!disable\n              ? html`\n                  <button\n                    type=\"submit\"\n                    class=\"btn btn-primary\"\n                    name=\"__action\"\n                    value=\"add_manual_grade\"\n                  >\n                    Submit\n                  </button>\n                `\n              : ''}\n            <div class=\"btn-group\">\n              <a\n                class=\"btn btn-secondary\"\n                href=\"${assessment_question_url}/next_ungraded?prior_instance_question_id=${resLocals\n                  .instance_question.id}\"\n              >\n                ${skip_text}\n              </a>\n              ${!disable\n                ? html`\n                    <button\n                      type=\"button\"\n                      class=\"btn btn-secondary dropdown-toggle dropdown-toggle-split\"\n                      data-bs-toggle=\"dropdown\"\n                      aria-haspopup=\"true\"\n                      aria-expanded=\"false\"\n                    >\n                      <span class=\"visually-hidden\">Change assigned grader</span>\n                    </button>\n                    <div class=\"dropdown-menu dropdown-menu-end\">\n                      ${(graders || []).map(\n                        (grader) => html`\n                          <button\n                            type=\"submit\"\n                            class=\"dropdown-item\"\n                            name=\"__action\"\n                            value=\"reassign_${grader.user_id}\"\n                          >\n                            Assign to: ${grader.name} (${grader.uid})\n                          </button>\n                        `,\n                      )}\n                      <button\n                        type=\"submit\"\n                        class=\"dropdown-item\"\n                        name=\"__action\"\n                        value=\"reassign_nobody\"\n                      >\n                        Tag for grading without assigned grader\n                      </button>\n                      <button\n                        type=\"submit\"\n                        class=\"dropdown-item\"\n                        name=\"__action\"\n                        value=\"reassign_graded\"\n                      >\n                        Tag as graded (keep current grade)\n                      </button>\n                    </div>\n                  `\n                : ''}\n            </div>\n          </span>\n        </li>\n      </ul>\n    </form>\n  `;\n}\n"]}