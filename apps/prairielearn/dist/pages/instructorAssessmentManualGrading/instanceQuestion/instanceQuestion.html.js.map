{"version":3,"file":"instanceQuestion.html.js","sourceRoot":"","sources":["../../../../src/pages/instructorAssessmentManualGrading/instanceQuestion/instanceQuestion.html.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,CAAC,EAAE,MAAM,KAAK,CAAC;AAExB,OAAO,EAAE,eAAe,EAAE,MAAM,yBAAyB,CAAC;AAC1D,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE,MAAM,oBAAoB,CAAC;AAEtD,OAAO,EAAE,mBAAmB,EAAE,MAAM,iDAAiD,CAAC;AACtF,OAAO,EAAE,UAAU,EAAE,MAAM,wCAAwC,CAAC;AACpE,OAAO,EAAE,kBAAkB,EAAE,MAAM,gDAAgD,CAAC;AACpF,OAAO,EAAE,iBAAiB,EAAE,MAAM,+CAA+C,CAAC;AAClF,OAAO,EAAE,6BAA6B,EAAE,MAAM,mDAAmD,CAAC;AAClG,OAAO,EAAE,SAAS,EAAE,iBAAiB,EAAE,oBAAoB,EAAE,MAAM,wBAAwB,CAAC;AAC5F,OAAO,EAAE,iBAAiB,EAAE,gBAAgB,EAAa,MAAM,0BAA0B,CAAC;AAE1F,OAAO,EAAE,YAAY,EAAE,MAAM,wBAAwB,CAAC;AACtD,OAAO,EAAE,mBAAmB,EAAE,MAAM,+BAA+B,CAAC;AAEpE,MAAM,CAAC,MAAM,oBAAoB,GAAG,gBAAgB,CAAC,MAAM,CAAC;IAC1D,UAAU,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;IACjC,WAAW,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;CACnC,CAAC,CAAC;AAGH,MAAM,UAAU,gBAAgB,CAAC,EAC/B,SAAS,EACT,oBAAoB,EACpB,OAAO,EACP,cAAc,EACd,UAAU,GAOX;IACC,OAAO,UAAU,CAAC;QAChB,SAAS,EAAE;YACT,GAAG,SAAS;YACZ,qGAAqG;YACrG,sBAAsB,EAAE,SAAS;SAClC;QACD,SAAS,EAAE,gBAAgB;QAC3B,UAAU,EAAE;YACV,IAAI,EAAE,YAAY;YAClB,IAAI,EAAE,YAAY;YAClB,OAAO,EAAE,gBAAgB;SAC1B;QACD,OAAO,EAAE;YACP,SAAS,EAAE,IAAI;YACf,QAAQ,EAAE,uBAAuB,SAAS,CAAC,sBAAsB,CAAC,0BAA0B,EAAE;SAC/F;QACD,WAAW,EAAE,IAAI,CAAA;QACb,iBAAiB,CAAC,aAAa,CAAC;2BACb,oBAAoB,CAAC,wBAAwB,CAAC;;gCAEzC,SAAS,CAAC,SAAS;;QAE3C,SAAS,CAAC,QAAQ,CAAC,IAAI,KAAK,UAAU;YACtC,CAAC,CAAC,IAAI,CAAA;2BACa,SAAS,CAAC,2BAA2B,CAAC;2BACtC,SAAS,CAAC,wBAAwB,CAAC;2BACnC,SAAS,CAAC,0BAA0B,CAAC;2BACrC,SAAS,CACpB,wBAAwB,SAAS,CAAC,qBAAqB,KAAK,CAC7D;WACJ;YACH,CAAC,CAAC,EAAE;QACJ,UAAU,CAAC,SAAS,CAAC,gBAAgB,CAAC;QACtC,iBAAiB,CAAC,sDAAsD,CAAC;KAC5E;QACD,UAAU,EAAE,IAAI,CAAA;;UAEV,6BAA6B,CAAC;YAC9B,UAAU,EAAE,SAAS,CAAC,UAAU;YAChC,QAAQ,EAAE,SAAS,CAAC,QAAQ;YAC5B,MAAM,EAAE,SAAS,CAAC,MAAM;YACxB,SAAS,EAAE,SAAS,CAAC,SAAS;SAC/B,CAAC;;KAEL;QACD,OAAO,EAAE,IAAI,CAAA;;QAET,SAAS,CAAC,mBAAmB,CAAC,IAAI;YAClC,CAAC,CAAC,IAAI,CAAA;;;;;WAKH;YACH,CAAC,CAAC,EAAE;QACJ,oBAAoB;YACpB,CAAC,CAAC,uBAAuB,CAAC,EAAE,SAAS,EAAE,oBAAoB,EAAE,OAAO,EAAE,UAAU,EAAE,CAAC;YACnF,CAAC,CAAC,EAAE;;;YAGA,iBAAiB,CAAC,EAAE,SAAS,EAAE,eAAe,EAAE,gBAAgB,EAAE,UAAU,EAAE,KAAK,EAAE,CAAC;;;;;;;gBAOlF,YAAY,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,CAAC;;;;YAIzD,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC;YAC9B,CAAC,CAAC,kBAAkB,CAAC;gBACjB,QAAQ,EAAE,SAAS,CAAC,SAAS;gBAC7B,OAAO,EAAE,UAAU;gBACnB,gBAAgB,EAAE,SAAS,CAAC,eAAe,CAAC,EAAE;gBAC9C,mBAAmB,EAAE,SAAS,CAAC,mBAAmB;gBAClD,YAAY,EAAE,SAAS,CAAC,YAAY;gBACpC,SAAS,EAAE,SAAS,CAAC,OAAO,CAAC,EAAE;gBAC/B,SAAS,EAAE,SAAS,CAAC,YAAY;gBACjC,eAAe,EAAE,KAAK;aACvB,CAAC;YACJ,CAAC,CAAC,EAAE;YACJ,mBAAmB,CAAC;YACpB,MAAM,EAAE,SAAS,CAAC,MAAM;YACxB,eAAe,EAAE,SAAS,CAAC,eAAe;YAC1C,UAAU,EAAE,SAAS,CAAC,UAAU;YAChC,mBAAmB,EAAE,SAAS,CAAC,mBAAmB;YAClD,iBAAiB,EAAE,SAAS,CAAC,iBAAiB;YAC9C,cAAc;YACd,UAAU;YACV,QAAQ,EAAE,SAAS,CAAC,QAAQ;YAC5B,OAAO,EAAE,SAAS,CAAC,OAAO;YAC1B,cAAc,EAAE,SAAS,CAAC,cAAc;YACxC,uBAAuB,EAAE,SAAS,CAAC,uBAAuB;YAC1D,aAAa,EAAE,SAAS,CAAC,aAAa;YACtC,UAAU,EAAE,SAAS,CAAC,UAAU;YAChC,kBAAkB,EAAE,SAAS,CAAC,kBAAkB;YAChD,eAAe,EAAE,gBAAgB;YACjC,SAAS,EAAE,SAAS,CAAC,YAAY;SAClC,CAAC;;;KAGP;QACD,WAAW,EAAE,CAAC,mBAAmB,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC;KAClD,CAAC,CAAC;AACL,CAAC;AAED,SAAS,uBAAuB,CAAC,EAC/B,SAAS,EACT,oBAAoB,EACpB,OAAO,EACP,UAAU,GAMX;IACC,MAAM,cAAc,GAAG,UAAU,EAAE,IAAI,IAAI,UAAU,EAAE,GAAG,IAAI,mBAAmB,CAAC;IAClF,OAAO,IAAI,CAAA;;;;;;;;;;;;;;;+EAekE,cAAc;;;;;;;;oBAQzE,eAAe;IACf,iEAAiE;IACjE,iBAAiB,CAAC,KAAK,CAAC,SAAS,CAAC,iBAAiB,CAAC,WAAW,CAAC,EAChE,SAAS,CAAC,eAAe,CAAC,gBAAgB,CAC3C;uBACI,cAAc;;;oBAGjB,YAAY,CAAC;QACb,SAAS;QACT,OAAO,EAAE,IAAI;QACb,qBAAqB,EAAE,IAAI;QAC3B,SAAS,EAAE,uBAAuB;QAClC,OAAO,EAAE,UAAU;KACpB,CAAC;;;;;;oBAMA,oBAAoB,CAAC,IAAI;QACzB,CAAC,CAAC,GAAG,eAAe,CAChB,oBAAoB,CAAC,IAAI,EACzB,SAAS,CAAC,eAAe,CAAC,gBAAgB,CAC3C,GAAG;QACN,CAAC,CAAC,EAAE;uBACD,oBAAoB,CAAC,WAAW;;;oBAGnC,YAAY,CAAC;QACb,SAAS;QACT,aAAa,EACX,CAAC,oBAAoB,CAAC,KAAK,IAAI,CAAC,CAAC,GAAG,SAAS,CAAC,mBAAmB,CAAC,UAAU;QAC9E,kBAAkB,EAAE,oBAAoB,CAAC,WAAW,IAAI,CAAC;QACzD,oBAAoB,EAAE,oBAAoB,CAAC,aAAa,IAAI,CAAC;QAC7D,WAAW,EAAE,oBAAoB;QACjC,OAAO,EAAE,aAAa;QACtB,OAAO;KACR,CAAC;;;;;;;;GAQjB,CAAC;AACJ,CAAC","sourcesContent":["import { z } from 'zod';\n\nimport { formatDateYMDHM } from '@prairielearn/formatter';\nimport { html, unsafeHtml } from '@prairielearn/html';\n\nimport { InstructorInfoPanel } from '../../../components/InstructorInfoPanel.html.js';\nimport { PageLayout } from '../../../components/PageLayout.html.js';\nimport { PersonalNotesPanel } from '../../../components/PersonalNotesPanel.html.js';\nimport { QuestionContainer } from '../../../components/QuestionContainer.html.js';\nimport { QuestionSyncErrorsAndWarnings } from '../../../components/SyncErrorsAndWarnings.html.js';\nimport { assetPath, compiledScriptTag, nodeModulesAssetPath } from '../../../lib/assets.js';\nimport { DateFromISOString, GradingJobSchema, type User } from '../../../lib/db-types.js';\n\nimport { GradingPanel } from './gradingPanel.html.js';\nimport { RubricSettingsModal } from './rubricSettingsModal.html.js';\n\nexport const GradingJobDataSchema = GradingJobSchema.extend({\n  score_perc: z.number().nullable(),\n  grader_name: z.string().nullable(),\n});\nexport type GradingJobData = z.infer<typeof GradingJobDataSchema>;\n\nexport function InstanceQuestion({\n  resLocals,\n  conflict_grading_job,\n  graders,\n  assignedGrader,\n  lastGrader,\n}: {\n  resLocals: Record<string, any>;\n  conflict_grading_job: GradingJobData | null;\n  graders: User[] | null;\n  assignedGrader: User | null;\n  lastGrader: User | null;\n}) {\n  return PageLayout({\n    resLocals: {\n      ...resLocals,\n      // instance_question_info is reset to keep the default title from showing the student question number\n      instance_question_info: undefined,\n    },\n    pageTitle: 'Manual Grading',\n    navContext: {\n      type: 'instructor',\n      page: 'assessment',\n      subPage: 'manual_grading',\n    },\n    options: {\n      fullWidth: true,\n      pageNote: `Instance - question ${resLocals.instance_question_info.instructor_question_number}`,\n    },\n    headContent: html`\n      ${compiledScriptTag('question.ts')}\n      <script defer src=\"${nodeModulesAssetPath('mathjax/es5/startup.js')}\"></script>\n      <script>\n        document.urlPrefix = '${resLocals.urlPrefix}';\n      </script>\n      ${resLocals.question.type !== 'Freeform'\n        ? html`\n            <script src=\"${assetPath('javascripts/lodash.min.js')}\"></script>\n            <script src=\"${assetPath('javascripts/require.js')}\"></script>\n            <script src=\"${assetPath('localscripts/question.js')}\"></script>\n            <script src=\"${assetPath(\n                `localscripts/question${resLocals.effectiveQuestionType}.js`,\n              )}\"></script>\n          `\n        : ''}\n      ${unsafeHtml(resLocals.extraHeadersHtml)}\n      ${compiledScriptTag('instructorAssessmentManualGradingInstanceQuestion.js')}\n    `,\n    preContent: html`\n      <div class=\"container-fluid\">\n        ${QuestionSyncErrorsAndWarnings({\n          authz_data: resLocals.authz_data,\n          question: resLocals.question,\n          course: resLocals.course,\n          urlPrefix: resLocals.urlPrefix,\n        })}\n      </div>\n    `,\n    content: html`\n      <h1 class=\"visually-hidden\">Instance Question Manual Grading</h1>\n      ${resLocals.assessment_instance.open\n        ? html`\n            <div class=\"alert alert-danger\" role=\"alert\">\n              This assessment instance is still open. Student may still be able to submit new\n              answers.\n            </div>\n          `\n        : ''}\n      ${conflict_grading_job\n        ? ConflictGradingJobModal({ resLocals, conflict_grading_job, graders, lastGrader })\n        : ''}\n      <div class=\"row\">\n        <div class=\"col-lg-8 col-12\">\n          ${QuestionContainer({ resLocals, questionContext: 'manual_grading', showFooter: false })}\n        </div>\n\n        <div class=\"col-lg-4 col-12\">\n          <div class=\"card mb-4 border-info\">\n            <div class=\"card-header bg-info text-white\">Grading</div>\n            <div class=\"js-main-grading-panel\">\n              ${GradingPanel({ resLocals, context: 'main', graders })}\n            </div>\n          </div>\n\n          ${resLocals.file_list.length > 0\n            ? PersonalNotesPanel({\n                fileList: resLocals.file_list,\n                context: 'question',\n                courseInstanceId: resLocals.course_instance.id,\n                assessment_instance: resLocals.assessment_instance,\n                authz_result: resLocals.authz_result,\n                variantId: resLocals.variant.id,\n                csrfToken: resLocals.__csrf_token,\n                allowNewUploads: false,\n              })\n            : ''}\n          ${InstructorInfoPanel({\n            course: resLocals.course,\n            course_instance: resLocals.course_instance,\n            assessment: resLocals.assessment,\n            assessment_instance: resLocals.assessment_instance,\n            instance_question: resLocals.instance_question,\n            assignedGrader,\n            lastGrader,\n            question: resLocals.question,\n            variant: resLocals.variant,\n            instance_group: resLocals.instance_group,\n            instance_group_uid_list: resLocals.instance_group_uid_list,\n            instance_user: resLocals.instance_user,\n            authz_data: resLocals.authz_data,\n            question_is_shared: resLocals.question_is_shared,\n            questionContext: 'manual_grading',\n            csrfToken: resLocals.__csrf_token,\n          })}\n        </div>\n      </div>\n    `,\n    postContent: [RubricSettingsModal({ resLocals })],\n  });\n}\n\nfunction ConflictGradingJobModal({\n  resLocals,\n  conflict_grading_job,\n  graders,\n  lastGrader,\n}: {\n  resLocals: Record<string, any>;\n  conflict_grading_job: GradingJobData;\n  graders: User[] | null;\n  lastGrader: User | null;\n}) {\n  const lastGraderName = lastGrader?.name ?? lastGrader?.uid ?? 'an unknown grader';\n  return html`\n    <div id=\"conflictGradingJobModal\" class=\"modal fade\">\n      <div class=\"modal-dialog modal-xl\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header bg-danger text-light\">\n            <div class=\"modal-title\">Grading conflict identified</div>\n            <button\n              type=\"button\"\n              class=\"btn-close\"\n              data-bs-dismiss=\"modal\"\n              aria-label=\"Close\"\n            ></button>\n          </div>\n          <div class=\"modal-body\">\n            <div class=\"alert alert-danger\" role=\"alert\">\n              The submission you have just graded has already been graded by ${lastGraderName}. Your\n              score and feedback have not been applied. Please review the feedback below and select\n              how you would like to proceed.\n            </div>\n            <div class=\"row mb-2\">\n              <div class=\"col-lg-6 col-12\">\n                <div><strong>Existing score and feedback</strong></div>\n                <div class=\"mb-2\">\n                  ${formatDateYMDHM(\n                    // The modified_at value may have come from a non-validated query\n                    DateFromISOString.parse(resLocals.instance_question.modified_at),\n                    resLocals.course_instance.display_timezone,\n                  )},\n                  by ${lastGraderName}\n                </div>\n                <div class=\"card\">\n                  ${GradingPanel({\n                    resLocals,\n                    disable: true,\n                    hide_back_to_question: true,\n                    skip_text: 'Accept existing score',\n                    context: 'existing',\n                  })}\n                </div>\n              </div>\n              <div class=\"col-lg-6 col-12\">\n                <div><strong>Conflicting score and feedback</strong></div>\n                <div class=\"mb-2\">\n                  ${conflict_grading_job.date\n                    ? `${formatDateYMDHM(\n                        conflict_grading_job.date,\n                        resLocals.course_instance.display_timezone,\n                      )},`\n                    : ''}\n                  by ${conflict_grading_job.grader_name}\n                </div>\n                <div class=\"card\">\n                  ${GradingPanel({\n                    resLocals,\n                    custom_points:\n                      (conflict_grading_job.score ?? 0) * resLocals.assessment_question.max_points,\n                    custom_auto_points: conflict_grading_job.auto_points ?? 0,\n                    custom_manual_points: conflict_grading_job.manual_points ?? 0,\n                    grading_job: conflict_grading_job,\n                    context: 'conflicting',\n                    graders,\n                  })}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n}\n"]}