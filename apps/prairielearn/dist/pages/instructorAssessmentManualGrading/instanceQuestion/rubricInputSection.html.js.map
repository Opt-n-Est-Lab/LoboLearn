{"version":3,"file":"rubricInputSection.html.js","sourceRoot":"","sources":["../../../../src/pages/instructorAssessmentManualGrading/instanceQuestion/rubricInputSection.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, unsafeHtml } from '@prairielearn/html';\n\nimport type { AssessmentQuestion, RubricGradingItem } from '../../../lib/db-types.js';\nimport { type RubricData, type RubricGradingData } from '../../../lib/manualGrading.js';\n\nexport function RubricInputSection({\n  resLocals,\n  disable,\n}: {\n  resLocals: Record<string, any>;\n  disable: boolean;\n}) {\n  if (!resLocals.rubric_data) return '';\n  const rubric_data: RubricData = resLocals.rubric_data;\n  const rubric_grading: RubricGradingData | null = resLocals.submission.rubric_grading;\n\n  return html`\n    <style>\n      .js-selectable-rubric-item-label {\n        border-color: rgba(0, 0, 0, 0);\n        border-width: 1px;\n        border-style: solid;\n      }\n      .js-selectable-rubric-item-label:has(input:checked) {\n        border-color: rgba(0, 0, 0, 0.125);\n        background-color: var(--light);\n      }\n      .js-selectable-rubric-item-label p {\n        margin-bottom: 0;\n      }\n    </style>\n    ${RubricItems({\n      rubric_items: rubric_data.rubric_items,\n      rubric_grading_items: rubric_grading?.rubric_items,\n      assessment_question: resLocals.assessment_question,\n      disable,\n    })}\n    <div class=\"js-adjust-points d-flex justify-content-end\">\n      <button\n        type=\"button\"\n        class=\"js-adjust-points-enable btn btn-sm btn-link ${rubric_grading?.adjust_points ||\n        disable\n          ? 'd-none'\n          : ''}\"\n      >\n        Apply adjustment\n      </button>\n      <div\n        class=\"js-adjust-points-input-container w-25 ${rubric_grading?.adjust_points\n          ? ''\n          : 'd-none'}\"\n      >\n        <label>\n          <span class=\"small\">Adjustment:</span>\n          <div class=\"js-manual-grading-points\">\n            <div class=\"input-group input-group-sm\">\n              <input\n                type=\"number\"\n                step=\"any\"\n                class=\"form-control js-adjust-points-points\"\n                name=\"score_manual_adjust_points\"\n                data-max-points=\"${resLocals.assessment_question.max_manual_points ||\n                resLocals.assessment_question.max_points}\"\n                value=\"${Math.round((rubric_grading?.adjust_points ?? 0) * 100) / 100 || ''}\"\n                ${disable ? 'disabled' : ''}\n              />\n            </div>\n          </div>\n          ${resLocals.assessment_question.max_points\n            ? html`\n                <div class=\"js-manual-grading-percentage\">\n                  <div class=\"input-group input-group-sm\">\n                    <input\n                      type=\"number\"\n                      step=\"any\"\n                      class=\"form-control js-adjust-points-percentage\"\n                      name=\"score_manual_adjust_percent\"\n                      data-max-points=\"${resLocals.assessment_question.max_manual_points ||\n                      resLocals.assessment_question.max_points}\"\n                      value=\"${Math.round(\n                        ((rubric_grading?.adjust_points || 0) * 10000) /\n                          (resLocals.assessment_question.max_manual_points ||\n                            resLocals.assessment_question.max_points),\n                      ) / 100 || ''}\"\n                      ${disable ? 'disabled' : ''}\n                    />\n                    <span class=\"input-group-text\">%</span>\n                  </div>\n                </div>\n              `\n            : ''}\n        </label>\n      </div>\n    </div>\n  `;\n}\n\nfunction RubricItems({\n  rubric_items,\n  rubric_grading_items,\n  assessment_question,\n  disable,\n}: {\n  rubric_items: RubricData['rubric_items'][0][] | null | undefined;\n  rubric_grading_items: Record<string, RubricGradingItem> | null | undefined;\n  assessment_question: AssessmentQuestion;\n  disable: boolean;\n}) {\n  return rubric_items?.map((item) =>\n    RubricItem({\n      item,\n      item_grading: rubric_grading_items?.[item.id],\n      assessment_question,\n      disable,\n    }),\n  );\n}\n\nfunction RubricItem({\n  item,\n  item_grading,\n  assessment_question,\n  disable,\n}: {\n  item: RubricData['rubric_items'][0];\n  item_grading: RubricGradingItem | undefined | null;\n  assessment_question: AssessmentQuestion;\n  disable: boolean;\n}) {\n  return html`\n    <div>\n      <label class=\"js-selectable-rubric-item-label w-100\">\n        <input\n          type=\"checkbox\"\n          name=\"rubric_item_selected_manual\"\n          class=\"js-selectable-rubric-item\"\n          value=\"${item.id}\"\n          ${item_grading?.score ? 'checked' : ''}\n          ${disable ? 'disabled' : ''}\n          data-rubric-item-points=\"${item.points}\"\n          data-key-binding=\"${item.key_binding}\"\n        />\n        <span class=\"badge text-bg-info\">${item.key_binding}</span>\n        <span class=\"float-end text-${item.points >= 0 ? 'success' : 'danger'}\">\n          <strong>\n            <span class=\"js-manual-grading-points\" data-testid=\"rubric-item-points\">\n              [${(item.points >= 0 ? '+' : '') + Math.round(item.points * 100) / 100}]\n            </span>\n            ${assessment_question.max_points\n              ? html`\n                  <span class=\"js-manual-grading-percentage\">\n                    [${(item.points >= 0 ? '+' : '') +\n                    Math.round(\n                      (item.points * 10000) /\n                        (assessment_question.max_manual_points || assessment_question.max_points),\n                    ) /\n                      100}%]\n                  </span>\n                `\n              : ''}\n          </strong>\n        </span>\n        <span>\n          <div class=\"d-inline-block\" data-testid=\"rubric-item-description\">\n            ${unsafeHtml(item.description_rendered ?? '')}\n          </div>\n          <div class=\"small text-muted\" data-testid=\"rubric-item-explanation\">\n            ${unsafeHtml(item.explanation_rendered ?? '')}\n          </div>\n          <div class=\"small text-muted\" data-testid=\"rubric-item-grader-note\">\n            ${unsafeHtml(item.grader_note_rendered ?? '')}\n          </div>\n        </span>\n      </label>\n    </div>\n  `;\n}\n"]}