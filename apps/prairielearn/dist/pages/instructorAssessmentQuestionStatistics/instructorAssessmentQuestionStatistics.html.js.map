{"version":3,"file":"instructorAssessmentQuestionStatistics.html.js","sourceRoot":"","sources":["../../../src/pages/instructorAssessmentQuestionStatistics/instructorAssessmentQuestionStatistics.html.ts"],"names":[],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport { z } from 'zod';\n\nimport { html, unsafeHtml } from '@prairielearn/html';\n\nimport { Modal } from '../../components/Modal.html.js';\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { Scorebar } from '../../components/Scorebar.html.js';\nimport { AssessmentSyncErrorsAndWarnings } from '../../components/SyncErrorsAndWarnings.html.js';\nimport { compiledScriptTag } from '../../lib/assets.js';\nimport {\n  AlternativeGroupSchema,\n  AssessmentQuestionSchema,\n  CourseInstanceSchema,\n  CourseSchema,\n  IdSchema,\n  QuestionSchema,\n  TopicSchema,\n  ZoneSchema,\n} from '../../lib/db-types.js';\nimport { formatFloat } from '../../lib/format.js';\nimport { STAT_DESCRIPTIONS } from '../shared/assessmentStatDescriptions.js';\n\nexport const AssessmentQuestionStatsRowSchema = AssessmentQuestionSchema.extend({\n  course_short_name: CourseSchema.shape.short_name,\n  course_instance_short_name: CourseInstanceSchema.shape.short_name,\n  assessment_label: z.string(),\n  qid: QuestionSchema.shape.qid,\n  question_title: QuestionSchema.shape.title,\n  topic: TopicSchema,\n  question_id: IdSchema,\n  assessment_question_number: z.string(),\n  alternative_group_number: AlternativeGroupSchema.shape.number,\n  alternative_group_size: z.number(),\n  zone_title: ZoneSchema.shape.title,\n  start_new_zone: z.boolean(),\n  start_new_alternative_group: z.boolean(),\n});\ntype AssessmentQuestionStatsRow = z.infer<typeof AssessmentQuestionStatsRowSchema>;\n\nexport function InstructorAssessmentQuestionStatistics({\n  questionStatsCsvFilename,\n  statsLastUpdated,\n  rows,\n  resLocals,\n}: {\n  questionStatsCsvFilename: string;\n  statsLastUpdated: string;\n  rows: AssessmentQuestionStatsRow[];\n  resLocals: Record<string, any>;\n}) {\n  const histminiOptions = { width: 60, height: 20, ymax: 1 };\n\n  return PageLayout({\n    resLocals,\n    pageTitle: 'Question Statistics',\n    navContext: {\n      type: 'instructor',\n      page: 'assessment',\n      subPage: 'question_statistics',\n    },\n    options: {\n      fullWidth: true,\n    },\n    headContent: [compiledScriptTag('instructorAssessmentQuestionStatisticsClient.ts')],\n    content: html`\n      <h1 class=\"visually-hidden\">\n        ${resLocals.assessment_set.name} ${resLocals.assessment.number} Question Statistics\n      </h1>\n      ${AssessmentSyncErrorsAndWarnings({\n        authz_data: resLocals.authz_data,\n        assessment: resLocals.assessment,\n        courseInstance: resLocals.course_instance,\n        course: resLocals.course,\n        urlPrefix: resLocals.urlPrefix,\n      })}\n      ${resLocals.authz_data.has_course_permission_edit\n        ? Modal({\n            title: 'Refresh statistics',\n            id: 'refreshAssessmentQuestionStatsModal',\n            body: html`\n              Are you sure you want to refresh all statistics for\n              <strong>${resLocals.assessment_set.name} ${resLocals.assessment.number}</strong>? This\n              cannot be undone.\n            `,\n            footer: html`\n              <input type=\"hidden\" name=\"__action\" value=\"refresh_stats\" />\n              <input type=\"hidden\" name=\"__csrf_token\" value=\"${resLocals.__csrf_token}\" />\n              <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">\n                Cancel\n              </button>\n              <button type=\"submit\" class=\"btn btn-danger\">Submit</button>\n            `,\n          })\n        : ''}\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white d-flex align-items-center\">\n          <h2>\n            ${resLocals.assessment_set.name} ${resLocals.assessment.number}: Question difficulty vs\n            discrimination\n          </h2>\n          <div class=\"ms-auto\">\n            <small>\n              <span class=\"text-light me-2\">Last calculated: ${statsLastUpdated}</span>\n            </small>\n            <button\n              type=\"button\"\n              class=\"btn btn-sm btn-light\"\n              data-bs-toggle=\"modal\"\n              data-bs-target=\"#refreshAssessmentQuestionStatsModal\"\n            >\n              <i class=\"fa fa-sync\" aria-hidden=\"true\"></i> Recalculate statistics\n            </button>\n          </div>\n        </div>\n\n        ${resLocals.assessment.score_stat_number > 0\n          ? html`\n              <div class=\"card-body\">\n                <div\n                  id=\"difficultyDiscriminationScatter\"\n                  class=\"js-scatter\"\n                  data-xdata=\"${JSON.stringify(rows.map((q) => q.mean_question_score))}\"\n                  data-ydata=\"${JSON.stringify(rows.map((q) => q.discrimination))}\"\n                  data-options=\"${JSON.stringify({\n                    xgrid: _.range(0, 110, 10),\n                    ygrid: _.range(0, 110, 10),\n                    xlabel: 'mean score / %',\n                    ylabel: 'discrimination / %',\n                    radius: 2,\n                    topMargin: 30,\n                    labels: rows.map((q) => q.assessment_question_number),\n                  })}\"\n                ></div>\n              </div>\n              <div class=\"card-footer small\">\n                <ul>\n                  <li>\n                    <strong>Mean score</strong> of a question is the average score for all students\n                    on the question. It is best to have a range of questions with different mean\n                    scores on the test, with some easy (mean score above 90%) and some hard (mean\n                    score below 50%).\n                  </li>\n                  <li>\n                    <strong>Discrimination</strong> of a question is the correlation coefficient\n                    between the scores on the question and the total assessment scores.\n                    Discrimination values should be above 20%, unless a question is very easy (mean\n                    score above 95%), in which case it is acceptable to have lower discriminations.\n                    It is always better to have higher discriminations for all questions, and a\n                    range of discriminations is not desired.\n                  </li>\n                </ul>\n              </div>\n            `\n          : html`<div class=\"card-body\">No student data.</div>`}\n      </div>\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white d-flex align-items-center\">\n          <h2>\n            ${resLocals.assessment_set.name} ${resLocals.assessment.number}: Question statistics\n          </h2>\n          <div class=\"ms-auto\">\n            <small>\n              <span class=\"text-light me-2\">Last calculated: ${statsLastUpdated}</span>\n            </small>\n            <button\n              type=\"button\"\n              class=\"btn btn-sm btn-light\"\n              data-bs-toggle=\"modal\"\n              data-bs-target=\"#refreshAssessmentQuestionStatsModal\"\n            >\n              <i class=\"fa fa-sync\" aria-hidden=\"true\"></i> Recalculate statistics\n            </button>\n          </div>\n        </div>\n\n        <div class=\"table-responsive\">\n          <table class=\"table table-sm table-hover tablesorter\" aria-label=\"Question statistics\">\n            <thead>\n              <tr>\n                <th class=\"text-center\">Question</th>\n                <th class=\"text-center\">Mean score</th>\n                <th class=\"text-center\">Discrimination</th>\n                <th class=\"text-center\">Auto-graded Attempts</th>\n                <th class=\"text-center\">Quintiles</th>\n                <th>Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${rows.map(\n                (row) => html`\n                  <tr>\n                    <td>\n                      <a href=\"${resLocals.urlPrefix}/question/${row.question_id}/\">\n                        ${row.assessment_question_number}. ${row.question_title}\n                      </a>\n                    </td>\n                    <td class=\"text-center align-middle\">\n                      ${Scorebar(\n                        row.mean_question_score ? Math.round(row.mean_question_score) : null,\n                      )}\n                    </td>\n                    <td class=\"text-center align-middle\">\n                      ${Scorebar(row.discrimination ? Math.round(row.discrimination) : null)}\n                    </td>\n                    <td class=\"text-center\">\n                      ${(row.max_auto_points ?? 0) > 0 ||\n                      row.max_manual_points === 0 ||\n                      (row.average_number_submissions ?? 0) > 0\n                        ? formatFloat(row.average_number_submissions)\n                        : html`&mdash;`}\n                    </td>\n                    ${(row.number ?? 0) > 0\n                      ? html`\n                          <td class=\"text-center\">\n                            <div\n                              class=\"js-histmini\"\n                              data-data=\"${JSON.stringify(row.quintile_question_scores)}\"\n                              data-options=\"${JSON.stringify({\n                                ...histminiOptions,\n                                ymax: 100,\n                              })}\"\n                            ></div>\n                          </td>\n                        `\n                      : html`<td class=\"text-center\"></td>`}\n                    <td class=\"align-middle text-nowrap\" style=\"width: 1em;\">\n                      ${resLocals.authz_data.has_course_instance_permission_edit\n                        ? html`\n                            <a\n                              class=\"btn btn-xs btn-primary\"\n                              href=\"${resLocals.urlPrefix}/assessment/${resLocals.assessment\n                                .id}/manual_grading/assessment_question/${row.id}\"\n                            >\n                              Manual grading\n                            </a>\n                          `\n                        : ''}\n                    </td>\n                  </tr>\n                `,\n              )}\n            </tbody>\n          </table>\n        </div>\n        <div class=\"card-footer\">\n          <p>\n            Download\n            <a\n              href=\"${resLocals.urlPrefix}/assessment/${resLocals.assessment\n                .id}/question_statistics/${questionStatsCsvFilename}\"\n            >\n              ${questionStatsCsvFilename}\n            </a>\n          </p>\n          <div class=\"small\">\n            <ul>\n              <li>\n                <strong>Mean score</strong> of a question is the average score for all students on\n                the question. It is best to have a range of questions with different mean scores on\n                the test, with some easy (mean score above 90%) and some hard (mean score below\n                50%).\n              </li>\n              <li>\n                <strong>Discrimination</strong> of a question is the correlation coefficient between\n                the scores on the question and the total assessment scores. Discrimination values\n                should be above 20%, unless a question is very easy (mean score above 95%), in which\n                case it is acceptable to have lower discriminations. It is always better to have\n                higher discriminations for all questions, and a range of discriminations is not\n                desired.\n              </li>\n              <li>\n                <strong>Auto-graded Attempts</strong> for a question is the average number of\n                auto-graded attempts made per student at the question.\n              </li>\n              <li>\n                <strong>Quintiles</strong> shows the average scores on the question for students in\n                the lowest 20% of the class, the next 20%, etc, where the quintiles are determined\n                by total assessment score. Good questions should have very low scores for the lowest\n                quintile (the left-most), and very high scores for the highest quintile (the\n                right-most). This is essentially a graphical representation of the discrimination.\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white d-flex align-items-center\">\n          <h2>\n            ${resLocals.assessment_set.name} ${resLocals.assessment.number}: Detailed question\n            statistics\n          </h2>\n          <div class=\"ms-auto\">\n            <small>\n              <span class=\"text-light me-2\">Last calculated: ${statsLastUpdated}</span>\n            </small>\n            <button\n              type=\"button\"\n              class=\"btn btn-sm btn-light\"\n              data-bs-toggle=\"modal\"\n              data-bs-target=\"#refreshAssessmentQuestionStatsModal\"\n            >\n              <i class=\"fa fa-sync\" aria-hidden=\"true\"></i> Recalculate statistics\n            </button>\n          </div>\n        </div>\n\n        <div class=\"table-responsive\">\n          <table\n            class=\"table table-sm table-hover tablesorter table-bordered\"\n            aria-label=\"Detailed question statistics\"\n          >\n            <thead>\n              <tr>\n                <th class=\"text-center\">Question</th>\n                ${Object.keys(STAT_DESCRIPTIONS).map((stat) => {\n                  if (\n                    stat !== 'INCREMENTAL_SUBMISSION_SCORE_POINTS_AVERAGES' ||\n                    resLocals.assessment.type !== 'Homework'\n                  ) {\n                    // We use `unsafeHtml` for the description below because some\n                    // contain raw HTML. This is safe, as none of this is user-controlled.\n                    return html`\n                      <th class=\"text-center\" title=\"${STAT_DESCRIPTIONS[stat].description}\">\n                        ${unsafeHtml(STAT_DESCRIPTIONS[stat].title)}\n                      </th>\n                    `;\n                  }\n                })}\n              </tr>\n            </thead>\n            <tbody>\n              ${rows.map(function (row) {\n                return html`\n                  <tr>\n                    <td style=\"white-space: nowrap;\">\n                      <a href=\"${resLocals.urlPrefix}/question/${row.question_id}/\">\n                        ${row.assessment_question_number}. ${row.qid}\n                      </a>\n                    </td>\n                    <td class=\"text-center\">${formatFloat(row.mean_question_score, 1)}</td>\n                    <td class=\"text-center\">${formatFloat(row.median_question_score, 1)}</td>\n                    <td class=\"text-center\">${formatFloat(row.question_score_variance, 1)}</td>\n                    <td class=\"text-center\">${formatFloat(row.discrimination, 1)}</td>\n                    ${(row.max_auto_points ?? 0) > 0 || row.max_manual_points === 0\n                      ? html`\n                          <td class=\"text-center\">${formatFloat(row.some_submission_perc, 1)}</td>\n                          <td class=\"text-center\">\n                            ${formatFloat(row.some_perfect_submission_perc, 1)}\n                          </td>\n                          <td class=\"text-center\">\n                            ${formatFloat(row.some_nonzero_submission_perc, 1)}\n                          </td>\n                          <td class=\"text-center\">\n                            ${formatFloat(row.average_first_submission_score, 2)}\n                          </td>\n                          <td class=\"text-center\">\n                            ${formatFloat(row.first_submission_score_variance, 2)}\n                          </td>\n                          <td class=\"text-center\">\n                            ${row.first_submission_score_hist !== null\n                              ? html`\n                                  <div\n                                    class=\"js-histmini\"\n                                    data-data=\"${JSON.stringify(row.first_submission_score_hist)}\"\n                                    data-options=\"${JSON.stringify({\n                                      ...histminiOptions,\n                                      normalize: true,\n                                    })}\"\n                                  ></div>\n                                `\n                              : ''}\n                          </td>\n                          <td class=\"text-center\">\n                            ${formatFloat(row.average_last_submission_score, 2)}\n                          </td>\n                          <td class=\"text-center\">\n                            ${formatFloat(row.last_submission_score_variance, 2)}\n                          </td>\n                          <td class=\"text-center\">\n                            ${row.last_submission_score_hist !== null\n                              ? html`\n                                  <div\n                                    class=\"js-histmini\"\n                                    data-data=\"${JSON.stringify(row.last_submission_score_hist)}\"\n                                    data-options=\"${JSON.stringify({\n                                      ...histminiOptions,\n                                      normalize: true,\n                                    })}\"\n                                  ></div>\n                                `\n                              : ''}\n                          </td>\n                          <td class=\"text-center\">\n                            ${formatFloat(row.average_max_submission_score, 2)}\n                          </td>\n                          <td class=\"text-center\">\n                            ${formatFloat(row.max_submission_score_variance, 2)}\n                          </td>\n                          <td class=\"text-center\">\n                            ${row.max_submission_score_hist !== null\n                              ? html`\n                                  <div\n                                    class=\"js-histmini\"\n                                    data-data=\"${JSON.stringify(row.max_submission_score_hist)}\"\n                                    data-options=\"${JSON.stringify({\n                                      ...histminiOptions,\n                                      normalize: true,\n                                    })}\"\n                                  ></div>\n                                `\n                              : ''}\n                          </td>\n                          <td class=\"text-center\">\n                            ${formatFloat(row.average_average_submission_score, 2)}\n                          </td>\n                          <td class=\"text-center\">\n                            ${formatFloat(row.average_submission_score_variance, 2)}\n                          </td>\n                          <td class=\"text-center\">\n                            ${row.average_submission_score_hist !== null\n                              ? html`\n                                  <div\n                                    class=\"js-histmini\"\n                                    data-data=\"${JSON.stringify(row.average_submission_score_hist)}\"\n                                    data-options=\"${JSON.stringify({\n                                      ...histminiOptions,\n                                      normalize: true,\n                                    })}\"\n                                  ></div>\n                                `\n                              : ''}\n                          </td>\n                          <td class=\"text-center\">\n                            ${row.submission_score_array_averages !== null\n                              ? html`\n                                  <div\n                                    class=\"js-histmini\"\n                                    data-data=\"${JSON.stringify(\n                                      row.submission_score_array_averages,\n                                    )}\"\n                                    data-options=\"${JSON.stringify(histminiOptions)}\"\n                                  ></div>\n                                `\n                              : ''}\n                          </td>\n                          <td class=\"text-center\">\n                            ${row.incremental_submission_score_array_averages !== null\n                              ? html`\n                                  <div\n                                    class=\"js-histmini\"\n                                    data-data=\"${JSON.stringify(\n                                      row.incremental_submission_score_array_averages,\n                                    )}\"\n                                    data-options=\"${JSON.stringify(histminiOptions)}\"\n                                  ></div>\n                                `\n                              : ''}\n                          </td>\n                          ${resLocals.assessment.type !== 'Homework'\n                            ? html`\n                                <td class=\"text-center\">\n                                  ${row.incremental_submission_points_array_averages != null\n                                    ? html`\n                                        <div\n                                          class=\"js-histmini\"\n                                          data-data=\"${JSON.stringify(\n                                            row.incremental_submission_points_array_averages,\n                                          )}\"\n                                          data-options=\"${JSON.stringify({\n                                            ...histminiOptions,\n                                            ymax: row.max_points,\n                                          })}\"\n                                        ></div>\n                                      `\n                                    : ''}\n                                </td>\n                              `\n                            : ''}\n                          <td class=\"text-center\">\n                            ${formatFloat(row.average_number_submissions, 2)}\n                          </td>\n                          <td class=\"text-center\">\n                            ${formatFloat(row.number_submissions_variance, 2)}\n                          </td>\n                          <td class=\"text-center\">\n                            ${row.number_submissions_hist !== null\n                              ? html`\n                                  <div\n                                    class=\"js-histmini\"\n                                    data-data=\"${JSON.stringify(row.number_submissions_hist)}\"\n                                    data-options=\"${JSON.stringify({\n                                      ...histminiOptions,\n                                      normalize: true,\n                                    })}\"\n                                  ></div>\n                                `\n                              : ''}\n                          </td>\n                          <td class=\"text-center\">\n                            ${row.quintile_question_scores !== null\n                              ? html`\n                                  <div\n                                    class=\"js-histmini\"\n                                    data-data=\"${JSON.stringify(row.quintile_question_scores)}\"\n                                    data-options=\"${JSON.stringify({\n                                      ...histminiOptions,\n                                      ymax: 100,\n                                    })}\"\n                                  ></div>\n                                `\n                              : ''}\n                          </td>\n                        `\n                      : html`\n                          <td\n                            class=\"text-center\"\n                            colspan=\"${resLocals.assessment.type === 'Homework' ? 21 : 22}\"\n                          >\n                            Manually-graded question\n                          </td>\n                        `}\n                  </tr>\n                `;\n              })}\n            </tbody>\n          </table>\n        </div>\n        <div class=\"card-footer\">\n          <p>\n            Download\n            <a\n              href=\"${resLocals.urlPrefix}/assessment/${resLocals.assessment\n                .id}/question_statistics/${questionStatsCsvFilename}\"\n            >\n              ${questionStatsCsvFilename}\n            </a>\n          </p>\n          <div class=\"small\">\n            <ul>\n              ${Object.keys(STAT_DESCRIPTIONS).map((stat) => {\n                return html`\n                  <li>\n                    <strong>${unsafeHtml(STAT_DESCRIPTIONS[stat].title)}: </strong>\n                    ${unsafeHtml(STAT_DESCRIPTIONS[stat].description)}\n                  </li>\n                `;\n              })}\n            </ul>\n            <p class=\"mb-0\">\n              In the case that a student takes this assessment multiple times (e.g., if this\n              assessment is a practice exam), we are calculating the above statistics by first\n              averaging over all assessment instances for each student, then averaging over\n              students.\n            </p>\n          </div>\n        </div>\n      </div>\n    `,\n  });\n}\n"]}