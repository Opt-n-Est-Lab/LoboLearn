{"version":3,"file":"instructorAssessmentRegrading.html.js","sourceRoot":"","sources":["../../../src/pages/instructorAssessmentRegrading/instructorAssessmentRegrading.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\n\nimport { html } from '@prairielearn/html';\n\nimport { JobStatus } from '../../components/JobStatus.html.js';\nimport { Modal } from '../../components/Modal.html.js';\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { AssessmentSyncErrorsAndWarnings } from '../../components/SyncErrorsAndWarnings.html.js';\nimport { JobSequenceSchema, UserSchema } from '../../lib/db-types.js';\n\nexport const RegradingJobSequenceSchema = z.object({\n  job_sequence: JobSequenceSchema,\n  start_date_formatted: z.string(),\n  user_uid: UserSchema.shape.uid,\n});\ntype RegradingJobSequence = z.infer<typeof RegradingJobSequenceSchema>;\n\nexport function InstructorAssessmentRegrading({\n  resLocals,\n  regradingJobSequences,\n}: {\n  resLocals: Record<string, any>;\n  regradingJobSequences: RegradingJobSequence[];\n}) {\n  return PageLayout({\n    resLocals,\n    pageTitle: 'Regrading',\n    navContext: {\n      type: 'instructor',\n      page: 'assessment',\n      subPage: 'regrading',\n    },\n    options: {\n      fullWidth: true,\n    },\n    content: html`\n      ${AssessmentSyncErrorsAndWarnings({\n        authz_data: resLocals.authz_data,\n        assessment: resLocals.assessment,\n        courseInstance: resLocals.course_instance,\n        course: resLocals.course,\n        urlPrefix: resLocals.urlPrefix,\n      })}\n      ${resLocals.authz_data.has_course_instance_permission_edit\n        ? html`\n            ${regradeAllAssessmentInstancesModal({\n              assessmentSetName: resLocals.assessment_set.name,\n              assessmentNumber: resLocals.assessment.number,\n              csrfToken: resLocals.__csrf_token,\n            })}\n          `\n        : ''}\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white\">\n          <h1>${resLocals.assessment_set.name} ${resLocals.assessment.number}: Regrading</h1>\n        </div>\n\n        ${resLocals.authz_data.has_course_instance_permission_edit\n          ? html`\n              <div class=\"card-body\">\n                <p>\n                  <button\n                    type=\"button\"\n                    class=\"btn btn-primary\"\n                    data-bs-toggle=\"modal\"\n                    data-bs-target=\"#regrade-all-form\"\n                  >\n                    <i class=\"fa fa-sync\" aria-hidden=\"true\"></i>\n                    Regrade all assessment instances\n                  </button>\n                </p>\n                <p class=\"small\">\n                  To regrade assessment instances for specific students, use the \"Action\" dropdown\n                  on the\n                  <a href=\"${resLocals.urlPrefix}/assessment/${resLocals.assessment.id}/instances\">\n                    assessment instances page</a\n                  >.\n                </p>\n              </div>\n            `\n          : ''}\n\n        <div class=\"table-responsive\">\n          <table class=\"table table-sm table-hover\" aria-label=\"Regrading job history\">\n            <thead>\n              <tr>\n                <th>Number</th>\n                <th>Date</th>\n                <th>Description</th>\n                <th>User</th>\n                <th>Status</th>\n                <th>Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${regradingJobSequences && regradingJobSequences.length > 0\n                ? regradingJobSequences.map((jobSequence) => {\n                    return html`\n                      <tr>\n                        <td>${jobSequence.job_sequence.number}</td>\n                        <td>${jobSequence.start_date_formatted}</td>\n                        <td>${jobSequence.job_sequence.description}</td>\n                        <td>${jobSequence.user_uid}</td>\n                        <td>${JobStatus({ status: jobSequence.job_sequence.status })}</td>\n                        <td>\n                          <a\n                            href=\"${resLocals.urlPrefix}/jobSequence/${jobSequence.job_sequence.id}\"\n                            class=\"btn btn-xs btn-info\"\n                          >\n                            Details\n                          </a>\n                        </td>\n                      </tr>\n                    `;\n                  })\n                : html`\n                    <tr>\n                      <td colspan=\"6\">No previous regradings.</td>\n                    </tr>\n                  `}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    `,\n  });\n}\n\nfunction regradeAllAssessmentInstancesModal({\n  assessmentSetName,\n  assessmentNumber,\n  csrfToken,\n}: {\n  assessmentSetName: string;\n  assessmentNumber: string;\n  csrfToken: string;\n}) {\n  return Modal({\n    id: 'regrade-all-form',\n    title: 'Regrade all assessment instances',\n    body: html`\n      Are you sure you want to regrade all assessment instances for\n      <strong>${assessmentSetName} ${assessmentNumber}</strong>? This cannot be undone.\n    `,\n    footer: html`\n      <input type=\"hidden\" name=\"__action\" value=\"regrade_all\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n      <button type=\"submit\" class=\"btn btn-primary\">Regrade all</button>\n    `,\n  });\n}\n"]}