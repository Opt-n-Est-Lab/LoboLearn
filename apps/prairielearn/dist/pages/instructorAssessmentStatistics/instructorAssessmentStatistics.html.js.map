{"version":3,"file":"instructorAssessmentStatistics.html.js","sourceRoot":"","sources":["../../../src/pages/instructorAssessmentStatistics/instructorAssessmentStatistics.html.ts"],"names":[],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport { z } from 'zod';\n\nimport { html } from '@prairielearn/html';\n\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { AssessmentSyncErrorsAndWarnings } from '../../components/SyncErrorsAndWarnings.html.js';\nimport { compiledScriptTag } from '../../lib/assets.js';\nimport { type Assessment, AssessmentInstanceSchema, AssessmentSchema } from '../../lib/db-types.js';\n\nexport const DurationStatSchema = z.object({\n  median_formatted: z.string(),\n  min_formatted: z.string(),\n  max_formatted: z.string(),\n  mean_formatted: z.string(),\n  median_minutes: z.number(),\n  min_minutes: z.number(),\n  max_minutes: z.number(),\n  mean_minutes: z.number(),\n  threshold_seconds: AssessmentSchema.shape.duration_stat_threshold_seconds,\n  threshold_labels: AssessmentSchema.shape.duration_stat_threshold_labels,\n  hist: AssessmentSchema.shape.duration_stat_hist,\n});\nexport type DurationStat = z.infer<typeof DurationStatSchema>;\n\nexport const AssessmentScoreHistogramByDateSchema = z.object({\n  date: z.date(),\n  date_formatted: z.string(),\n  number: z.number(),\n  mean_score_perc: z.number(),\n  histogram: z.array(z.number()),\n});\ntype AssessmentScoreHistogramByDate = z.infer<typeof AssessmentScoreHistogramByDateSchema>;\n\nexport const UserScoreSchema = z.object({\n  duration_secs: z.number(),\n  score_perc: AssessmentInstanceSchema.shape.score_perc,\n});\ntype UserScore = z.infer<typeof UserScoreSchema>;\n\nexport interface Filenames {\n  scoreStatsCsvFilename: string;\n  durationStatsCsvFilename: string;\n  statsByDateCsvFilename: string;\n}\n\nexport function InstructorAssessmentStatistics({\n  resLocals,\n  assessment,\n  durationStat,\n  assessmentScoreHistogramByDate,\n  userScores,\n  filenames,\n}: {\n  resLocals: Record<string, any>;\n  assessment: Assessment;\n  durationStat: DurationStat;\n  assessmentScoreHistogramByDate: AssessmentScoreHistogramByDate[];\n  userScores: UserScore[];\n  filenames: Filenames;\n}) {\n  return PageLayout({\n    resLocals,\n    pageTitle: 'Assessment Statistics',\n    navContext: {\n      type: 'instructor',\n      page: 'assessment',\n      subPage: 'assessment_statistics',\n    },\n    options: {\n      fullWidth: true,\n    },\n    headContent: [compiledScriptTag('instructorAssessmentStatisticsClient.ts')],\n    content: html`\n      ${AssessmentSyncErrorsAndWarnings({\n        authz_data: resLocals.authz_data,\n        assessment: resLocals.assessment,\n        courseInstance: resLocals.course_instance,\n        course: resLocals.course,\n        urlPrefix: resLocals.urlPrefix,\n      })}\n      <h1 class=\"visually-hidden\">\n        ${resLocals.assessment_set.name} ${assessment.number} Statistics\n      </h1>\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white\">\n          <h2>${resLocals.assessment_set.name} ${assessment.number}: Score statistics</h2>\n        </div>\n        ${assessment.score_stat_number > 0\n          ? html`\n              <div class=\"card-body\">\n                <div\n                  class=\"js-histogram\"\n                  data-histogram=\"${JSON.stringify(assessment.score_stat_hist)}\"\n                  data-xgrid=\"${JSON.stringify(_.range(0, 110, 10))}\"\n                  data-options=\"${JSON.stringify({\n                    ymin: 0,\n                    xlabel: 'score / %',\n                    ylabel: 'number of students',\n                  })}\"\n                ></div>\n              </div>\n\n              <div class=\"table-responsive\">\n                <table class=\"table table-sm table-hover\" aria-label=\"Assessment score statistics\">\n                  <tbody>\n                    <tr>\n                      <td>Number of students</td>\n                      <td>${assessment.score_stat_number}</td>\n                    </tr>\n                    <tr>\n                      <td>Mean score</td>\n                      <td>${Math.round(assessment.score_stat_mean)}%</td>\n                    </tr>\n                    <tr>\n                      <td>Standard deviation</td>\n                      <td>${Math.round(assessment.score_stat_std)}%</td>\n                    </tr>\n                    <tr>\n                      <td>Median score</td>\n                      <td>${Math.round(assessment.score_stat_median)}%</td>\n                    </tr>\n                    <tr>\n                      <td>Minimum score</td>\n                      <td>${Math.round(assessment.score_stat_min)}%</td>\n                    </tr>\n                    <tr>\n                      <td>Maximum score</td>\n                      <td>${Math.round(assessment.score_stat_max)}%</td>\n                    </tr>\n                    <tr>\n                      <td>Number of 0%</td>\n                      <td>\n                        ${assessment.score_stat_n_zero}\n                        (${Math.round(assessment.score_stat_n_zero_perc)}% of class)\n                      </td>\n                    </tr>\n                    <tr>\n                      <td>Number of 100%</td>\n                      <td>\n                        ${assessment.score_stat_n_hundred}\n                        (${Math.round(assessment.score_stat_n_hundred_perc)}% of class)\n                      </td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n              <div class=\"card-footer\">\n                <small>\n                  Download\n                  <a\n                    href=\"${resLocals.urlPrefix}/assessment/${assessment.id}/assessment_statistics/${filenames.scoreStatsCsvFilename}\"\n                    >${filenames.scoreStatsCsvFilename}</a\n                  >. Data outside of the plotted range is included in the last bin.\n                </small>\n              </div>\n            `\n          : html`<div class=\"card-body\">No student data.</div> `}\n      </div>\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white\">\n          <h2>${resLocals.assessment_set.name} ${assessment.number}: Duration statistics</h2>\n        </div>\n\n        ${assessment.score_stat_number > 0\n          ? html`\n              <div class=\"card-body\">\n                <div\n                  class=\"js-histogram\"\n                  data-histogram=\"${JSON.stringify(durationStat.hist)}\"\n                  data-xgrid=\"${JSON.stringify(durationStat.threshold_seconds)}\"\n                  data-options=\"${JSON.stringify({\n                    ymin: 0,\n                    xlabel: 'duration',\n                    ylabel: 'number of students',\n                    xTickLabels: durationStat.threshold_labels,\n                  })}\"\n                ></div>\n              </div>\n\n              <div class=\"table-responsive\">\n                <table\n                  class=\"table table-sm table-hover\"\n                  aria-label=\"Assessment duration statistics\"\n                >\n                  <tbody>\n                    <tr>\n                      <td>Mean duration</td>\n                      <td>${durationStat.mean_formatted}</td>\n                    </tr>\n                    <tr>\n                      <td>Median duration</td>\n                      <td>${durationStat.median_formatted}</td>\n                    </tr>\n                    <tr>\n                      <td>Minimum duration</td>\n                      <td>${durationStat.min_formatted}</td>\n                    </tr>\n                    <tr>\n                      <td>Maximum duration</td>\n                      <td>${durationStat.max_formatted}</td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n              <div class=\"card-footer\">\n                <small>\n                  Download\n                  <a\n                    href=\"${resLocals.urlPrefix}/assessment/${assessment.id}/assessment_statistics/${filenames.durationStatsCsvFilename}\"\n                    >${filenames.durationStatsCsvFilename}</a\n                  >. Data outside of the plotted range is included in the last bin.\n                </small>\n              </div>\n            `\n          : html`<div class=\"card-body\">No student data.</div>`}\n      </div>\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white\">\n          <h2>${resLocals.assessment_set.name} ${assessment.number}: Duration versus score</h2>\n        </div>\n\n        ${assessment.score_stat_number > 0\n          ? html`\n              <div class=\"card-body\">\n                <div\n                  class=\"js-scatter\"\n                  data-xdata=\"${JSON.stringify(userScores.map((user) => user.duration_secs))}\"\n                  data-ydata=\"${JSON.stringify(userScores.map((user) => user.score_perc))}\"\n                  data-options=\"${JSON.stringify({\n                    xgrid: durationStat.threshold_seconds,\n                    ygrid: _.range(0, 110, 10),\n                    xlabel: 'duration',\n                    ylabel: 'score / %',\n                    xTickLabels: durationStat.threshold_labels,\n                  })}\"\n                ></div>\n              </div>\n\n              <div class=\"card-footer\">\n                <small>\n                  Each point is one student assessment. Points beyond the plot range are plotted on\n                  the edge.\n                </small>\n              </div>\n            `\n          : html`<div class=\"card-body\">No student data.</div>`}\n      </div>\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white\">\n          <h2>${resLocals.assessment_set.name} ${assessment.number}: Score statistics by date</h2>\n        </div>\n\n        ${assessment.score_stat_number > 0\n          ? html`\n              <div class=\"card-body\">\n                <div\n                  style=\"overflow-x: scroll; overflow-y: hidden;\"\n                  class=\"js-parallel-histograms\"\n                  data-histograms=\"${JSON.stringify(\n                    assessmentScoreHistogramByDate.map((day) => ({\n                      label: day.date_formatted,\n                      mean: day.mean_score_perc,\n                      histogram: day.histogram,\n                    })),\n                  )}\"\n                  data-options=\"${JSON.stringify({\n                    ygrid: _.range(0, 110, 10),\n                    xgrid: assessmentScoreHistogramByDate.length,\n                    xlabel: 'start date',\n                    ylabel: 'score / %',\n                    yTickLabels: _.range(100, -10, -10),\n                    width: assessmentScoreHistogramByDate.length * 200,\n                  })}\"\n                ></div>\n              </div>\n\n              <div class=\"card-footer\">\n                <small>\n                  Download\n                  <a\n                    href=\"${resLocals.urlPrefix}/assessment/${assessment.id}/assessment_statistics/${filenames.statsByDateCsvFilename}\"\n                    >${filenames.statsByDateCsvFilename}</a\n                  >.\n                  <br />\n                  Each day shows a histogram of the scores on this assessment for that day. The\n                  widths are scaled relative to the maximum value across all bins and days. The\n                  thick black horizontal lines are the mean scores for each day.\n                </small>\n              </div>\n            `\n          : html`<div class=\"card-body\">No student data.</div>`}\n      </div>\n    `,\n  });\n}\n"]}