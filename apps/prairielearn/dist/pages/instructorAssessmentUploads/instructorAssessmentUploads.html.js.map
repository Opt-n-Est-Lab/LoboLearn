{"version":3,"file":"instructorAssessmentUploads.html.js","sourceRoot":"","sources":["../../../src/pages/instructorAssessmentUploads/instructorAssessmentUploads.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\n\nimport { html } from '@prairielearn/html';\n\nimport { JobStatus } from '../../components/JobStatus.html.js';\nimport { Modal } from '../../components/Modal.html.js';\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { AssessmentSyncErrorsAndWarnings } from '../../components/SyncErrorsAndWarnings.html.js';\nimport { JobSequenceSchema, UserSchema } from '../../lib/db-types.js';\n\nexport const UploadJobSequenceSchema = z.object({\n  job_sequence: JobSequenceSchema,\n  start_date_formatted: z.string(),\n  user_uid: UserSchema.shape.uid,\n});\ntype UploadJobSequence = z.infer<typeof UploadJobSequenceSchema>;\n\nexport function InstructorAssessmentUploads({\n  resLocals,\n  uploadJobSequences,\n}: {\n  resLocals: Record<string, any>;\n  uploadJobSequences: UploadJobSequence[];\n}) {\n  return PageLayout({\n    resLocals,\n    pageTitle: 'Uploads',\n    navContext: {\n      type: 'instructor',\n      page: 'assessment',\n      subPage: 'uploads',\n    },\n    options: {\n      fullWidth: true,\n    },\n    content: html`\n      ${AssessmentSyncErrorsAndWarnings({\n        authz_data: resLocals.authz_data,\n        assessment: resLocals.assessment,\n        courseInstance: resLocals.course_instance,\n        course: resLocals.course,\n        urlPrefix: resLocals.urlPrefix,\n      })}\n      ${resLocals.authz_data.has_course_instance_permission_edit\n        ? html`\n            ${UploadInstanceQuestionScoresModal({ csrfToken: resLocals.__csrf_token })}\n            ${UploadAssessmentInstanceScoresModal({ csrfToken: resLocals.__csrf_token })}\n          `\n        : ''}\n      ${AssessmentUploadCard({\n        assessmentSetName: resLocals.assessment_set.name,\n        assessmentNumber: resLocals.assessment.number,\n        authzHasPermissionEdit: resLocals.authz_data.has_course_instance_permission_edit,\n        uploadJobSequences,\n        urlPrefix: resLocals.urlPrefix,\n      })}\n    `,\n  });\n}\n\nfunction AssessmentUploadCard({\n  assessmentSetName,\n  assessmentNumber,\n  authzHasPermissionEdit,\n  uploadJobSequences,\n  urlPrefix,\n}: {\n  assessmentSetName: string;\n  assessmentNumber: number;\n  authzHasPermissionEdit: boolean;\n  uploadJobSequences: UploadJobSequence[];\n  urlPrefix: string;\n}) {\n  return html`\n    <div class=\"card mb-4\">\n      <div class=\"card-header bg-primary text-white\">\n        <h1>${assessmentSetName} ${assessmentNumber}: Uploads</h1>\n      </div>\n\n      ${authzHasPermissionEdit\n        ? html`\n            <div class=\"table-responsive pb-0\">\n              <table class=\"table\" aria-label=\"Score uploads\">\n                <tbody>\n                  <tr>\n                    <td style=\"width: 1%\">\n                      <button\n                        type=\"button\"\n                        class=\"btn btn-primary text-nowrap\"\n                        data-bs-toggle=\"modal\"\n                        data-bs-target=\"#upload-instance-question-scores-form\"\n                      >\n                        <i class=\"fas fa-upload\"></i> Upload new question scores\n                      </button>\n                    </td>\n                    <td>\n                      <p>\n                        Upload a CSV file to set per-question scores for individual students.\n                        <a data-bs-toggle=\"collapse\" href=\"#uploadInstanceQuestionScoresHelp\">\n                          Show details...\n                        </a>\n                      </p>\n                      <div class=\"collapse\" id=\"uploadInstanceQuestionScoresHelp\">\n                        ${CsvHelpInstanceQuestionScores()}\n                      </div>\n                    </td>\n                  </tr>\n                  <tr>\n                    <td style=\"width: 1%\">\n                      <button\n                        type=\"button\"\n                        class=\"btn btn-primary text-nowrap\"\n                        data-bs-toggle=\"modal\"\n                        data-bs-target=\"#upload-assessment-instance-scores-form\"\n                      >\n                        <i class=\"fas fa-upload\"></i> Upload new total scores\n                      </button>\n                    </td>\n                    <td>\n                      <p>\n                        Upload a CSV file to set the total assessment score for individual students.\n                        <a data-bs-toggle=\"collapse\" href=\"#uploadAssessmentScoresHelp\"\n                          >Show details...</a\n                        >\n                      </p>\n                      <div class=\"collapse\" id=\"uploadAssessmentScoresHelp\">\n                        ${CsvHelpAssessmentInstanceScores()}\n                      </div>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          `\n        : ''}\n\n      <div class=\"table-responsive\">\n        <table class=\"table table-sm table-hover\" aria-label=\"Score upload job history\">\n          <thead>\n            <tr>\n              <th>Number</th>\n              <th>Date</th>\n              <th>Description</th>\n              <th>User</th>\n              <th>Status</th>\n              <th>Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${uploadJobSequences && uploadJobSequences.length > 0\n              ? uploadJobSequences.map((job_sequence) => {\n                  return html`\n                    <tr>\n                      <td>${job_sequence.job_sequence.number}</td>\n                      <td>${job_sequence.start_date_formatted}</td>\n                      <td>${job_sequence.job_sequence.description}</td>\n                      <td>${job_sequence.user_uid}</td>\n                      <td>${JobStatus({ status: job_sequence.job_sequence.status })}</td>\n                      <td>\n                        <a\n                          href=\"${urlPrefix}/jobSequence/${job_sequence.job_sequence.id}\"\n                          class=\"btn btn-xs btn-info\"\n                          >Details</a\n                        >\n                      </td>\n                    </tr>\n                  `;\n                })\n              : html`\n                  <tr>\n                    <td colspan=\"6\">No previous uploads.</td>\n                  </tr>\n                `}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  `;\n}\n\nfunction CsvHelpInstanceQuestionScores() {\n  return html`\n    <p>\n      Upload a CSV file in the format of the\n      <code><i>&lt;assessment&gt;</i>_submissions_for_manual_grading.csv</code>\n      file from the Downloads page. See the\n      <a href=\"https://prairielearn.readthedocs.io/en/latest/manualGrading/\"\n        >Manual Grading documentation</a\n      >.\n    </p>\n    <p>Alternatively, the CSV file can be in the format:</p>\n    <pre class=\"ms-4\">\nuid,instance,qid,score_perc,feedback\nstudent1@example.com,1,addTwoNumbers,34.5,The second step was wrong\nstudent2@example.com,1,addTwoNumbers,78.92,\nstudent2@example.com,1,matrixMultiply,100,Great job!</pre\n    >\n    <p>\n      The <code>instance</code> column indicates which assessment instance to modify. The total\n      scores for the assessments will be automatically recalculated. The feedback will be attached\n      to the most recent student submission. To change the per-question points, replace the\n      <code>score_perc</code> column above with a <code>points</code> column.\n    </p>\n    <p>\n      By default the updates above change the manual portion of the grades for the instance\n      question, in such a way that the sum of the new manual portion with the existing autograding\n      portion matches the total listed in the <code>points</code> or <code>score_perc</code> columns\n      above. It is, however, possible to replace these columns with <code>manual_points</code> and\n      <code>auto_points</code> (or <code>manual_score_perc</code> and <code>auto_score_perc</code>)\n      for more fine-tuned change of grade components.\n    </p>\n  `;\n}\n\nfunction CsvHelpAssessmentInstanceScores() {\n  return html`\n    <p>Upload a CSV file like this:</p>\n    <pre class=\"ms-4\">\nuid,instance,score_perc\nstudent1@example.com,1,63.5\nstudent2@example.com,1,100</pre\n    >\n    <p>\n      The example above will change the total assessment percentage scores for\n      <code>student1@example.com</code> to 63.5% and for <code>student2@example.com</code> to 100%.\n      The <code>instance</code> column indicates which assessment instance to modify, and should be\n      <code>1</code> if there is only a single instance per student.\n    </p>\n    <p>\n      Alternatively, the total assessment points can be changed with a CSV containing a\n      <code>points</code> column, like:\n    </p>\n    <pre class=\"ms-4\">\nuid,instance,points\nstudent1@example.com,1,120\nstudent2@example.com,1,130.27</pre\n    >\n    <p>For assessments using group work, use the <code>group_name</code> column instead:</p>\n    <pre class=\"ms-4\">\ngroup_name,instance,score_perc\nmyhappygroup,1,95\ngreatgroup,1,85</pre\n    >\n  `;\n}\n\nfunction UploadInstanceQuestionScoresModal({ csrfToken }: { csrfToken: string }) {\n  return Modal({\n    id: 'upload-instance-question-scores-form',\n    title: 'Upload new question scores',\n    formEncType: 'multipart/form-data',\n    body: html`\n      ${CsvHelpInstanceQuestionScores()}\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"uploadInstanceQuestionScoresFileInput\">\n          Choose CSV file\n        </label>\n        <input\n          type=\"file\"\n          name=\"file\"\n          class=\"form-control\"\n          id=\"uploadInstanceQuestionScoresFileInput\"\n        />\n      </div>\n    `,\n    footer: html`\n      <input type=\"hidden\" name=\"__action\" value=\"upload_instance_question_scores\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n      <button type=\"submit\" class=\"btn btn-primary\">Upload</button>\n    `,\n  });\n}\n\nfunction UploadAssessmentInstanceScoresModal({ csrfToken }: { csrfToken: string }) {\n  return Modal({\n    id: 'upload-assessment-instance-scores-form',\n    title: 'Upload new total scores',\n    formEncType: 'multipart/form-data',\n    body: html`\n      ${CsvHelpAssessmentInstanceScores()}\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"uploadAssessmentInstanceScoresFileInput\">\n          Choose CSV file\n        </label>\n        <input\n          type=\"file\"\n          name=\"file\"\n          class=\"form-control\"\n          id=\"uploadAssessmentInstanceScoresFileInput\"\n        />\n      </div>\n    `,\n    footer: html`\n      <input type=\"hidden\" name=\"__action\" value=\"upload_assessment_instance_scores\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n      <button type=\"submit\" class=\"btn btn-primary\">Upload</button>\n    `,\n  });\n}\n"]}