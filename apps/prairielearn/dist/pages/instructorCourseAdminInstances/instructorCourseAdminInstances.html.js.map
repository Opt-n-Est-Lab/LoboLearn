{"version":3,"file":"instructorCourseAdminInstances.html.js","sourceRoot":"","sources":["../../../src/pages/instructorCourseAdminInstances/instructorCourseAdminInstances.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { Temporal } from '@js-temporal/polyfill';\n\nimport { formatDateYMDHM } from '@prairielearn/formatter';\nimport { html } from '@prairielearn/html';\nimport { run } from '@prairielearn/run';\n\nimport { Modal } from '../../components/Modal.html.js';\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { CourseSyncErrorsAndWarnings } from '../../components/SyncErrorsAndWarnings.html.js';\nimport { SyncProblemButton } from '../../components/SyncProblemButton.html.js';\nimport { compiledScriptTag } from '../../lib/assets.js';\nimport { type CourseInstanceAuthz } from '../../models/course-instances.js';\n\nexport type CourseInstanceAuthzRow = CourseInstanceAuthz & { enrollment_count?: number };\n\nexport function InstructorCourseAdminInstances({\n  resLocals,\n  courseInstances,\n}: {\n  resLocals: Record<string, any>;\n  courseInstances: CourseInstanceAuthzRow[];\n}) {\n  const initialStartDate = Temporal.Now.zonedDateTimeISO(resLocals.course.timeZone).with({\n    hour: 0,\n    minute: 1,\n    second: 0,\n  });\n  const initialStartDateFormatted = formatDateYMDHM(\n    new Date(initialStartDate.epochMilliseconds),\n    resLocals.course.time_zone,\n  );\n\n  const initialEndDate = initialStartDate.add({ months: 4 }).with({\n    hour: 23,\n    minute: 59,\n    second: 0,\n  });\n  const initialEndDateFormatted = formatDateYMDHM(\n    new Date(initialEndDate.epochMilliseconds),\n    resLocals.course.time_zone,\n  );\n\n  return PageLayout({\n    resLocals,\n    pageTitle: 'Course Instances',\n    navContext: {\n      type: 'instructor',\n      page: 'course_admin',\n      subPage: 'instances',\n    },\n    options: {\n      fullWidth: true,\n    },\n    headContent: [compiledScriptTag('instructorCourseAdminInstancesClient.ts')],\n    content: html`\n      ${CourseSyncErrorsAndWarnings({\n        authz_data: resLocals.authz_data,\n        course: resLocals.course,\n        urlPrefix: resLocals.urlPrefix,\n      })}\n      ${CreateCourseInstanceModal({\n        courseShortName: resLocals.course.short_name,\n        csrfToken: resLocals.__csrf_token,\n        initialStartDateFormatted,\n        initialEndDateFormatted,\n        timezone: resLocals.course.display_timezone,\n      })}\n      <div class=\"card mb-4\">\n        <div\n          class=\"card-header bg-primary text-white d-flex align-items-center justify-content-between\"\n        >\n          <h1>Course instances</h1>\n          ${resLocals.authz_data.has_course_permission_edit &&\n          !resLocals.course.example_course &&\n          !resLocals.needToSync &&\n          courseInstances.length > 0\n            ? html`\n                <button\n                  type=\"button\"\n                  class=\"btn btn-sm btn-light\"\n                  data-bs-toggle=\"modal\"\n                  data-bs-target=\"#createCourseInstanceModal\"\n                >\n                  <i class=\"fa fa-plus\" aria-hidden=\"true\"></i>\n                  <span class=\"d-none d-sm-inline\">Add course instance</span>\n                </button>\n              `\n            : ''}\n        </div>\n        ${courseInstances.length > 0\n          ? html`\n              <div class=\"table-responsive\">\n                <table\n                  class=\"table table-sm table-hover table-striped\"\n                  aria-label=\"Course instances\"\n                >\n                  <thead>\n                    <tr>\n                      <th>Long Name</th>\n                      <th>CIID</th>\n                      <th id=\"earliest-access-date\">\n                        Earliest Access Date\n                        <button\n                          type=\"button\"\n                          class=\"btn btn-xs btn-light\"\n                          aria-label=\"Information about Earliest Access Date\"\n                          data-bs-toggle=\"popover\"\n                          data-bs-container=\"body\"\n                          data-bs-placement=\"bottom\"\n                          data-bs-html=\"true\"\n                          data-bs-title=\"Earliest Access Date\"\n                          data-bs-content=\"${PopoverStartDate()}\"\n                        >\n                          <i class=\"far fa-question-circle\" aria-hidden=\"true\"></i>\n                        </button>\n                      </th>\n                      <th id=\"latest-access-date\">\n                        Latest Access Date\n                        <button\n                          type=\"button\"\n                          class=\"btn btn-xs btn-light\"\n                          aria-label=\"Information about Latest Access Date\"\n                          data-bs-toggle=\"popover\"\n                          data-bs-container=\"body\"\n                          data-bs-placement=\"bottom\"\n                          data-bs-html=\"true\"\n                          data-bs-title=\"Latest Access Date\"\n                          data-bs-content=\"${PopoverEndDate()}\"\n                        >\n                          <i class=\"far fa-question-circle\" aria-hidden=\"true\"></i>\n                        </button>\n                      </th>\n                      <th>Students</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    ${courseInstances.map((row) => {\n                      return html`\n                        <tr>\n                          <td class=\"align-left\">\n                            ${row.sync_errors\n                              ? SyncProblemButton({\n                                  type: 'error',\n                                  output: row.sync_errors,\n                                })\n                              : row.sync_warnings\n                                ? SyncProblemButton({\n                                    type: 'warning',\n                                    output: row.sync_warnings,\n                                  })\n                                : ''}\n                            <a\n                              href=\"${resLocals.plainUrlPrefix}/course_instance/${row.id}/instructor/instance_admin\"\n                              >${row.long_name}</a\n                            >\n                          </td>\n                          <td class=\"align-left\">${row.short_name}</td>\n                          <td class=\"align-left\">${row.formatted_start_date}</td>\n                          <td class=\"align-left\">${row.formatted_end_date}</td>\n                          <td class=\"align-middle\">${row.enrollment_count}</td>\n                        </tr>\n                      `;\n                    })}\n                  </tbody>\n                </table>\n              </div>\n            `\n          : html`\n              <div class=\"my-4 card-body text-center\" style=\"text-wrap: balance;\">\n                <p class=\"fw-bold\">No course instances found.</p>\n                <p class=\"mb-0\">\n                  A course instance contains the assessments and other configuration for a single\n                  offering of a course.\n                </p>\n                <p>\n                  Learn more in the\n                  <a\n                    href=\"https://prairielearn.readthedocs.io/en/latest/courseInstance/\"\n                    target=\"_blank\"\n                    >course instance documentation</a\n                  >.\n                </p>\n                ${run(() => {\n                  if (resLocals.course.example_course) {\n                    return html`<p>You can't add course instances to the example course.</p>`;\n                  }\n                  if (!resLocals.authz_data.has_course_permission_edit) {\n                    return html`<p>Course Editors can create new course instances.</p>`;\n                  }\n                  if (resLocals.needToSync) {\n                    return html`\n                      <p>\n                        You must\n                        <a href=\"${resLocals.urlPrefix}/course_admin/syncs\">sync this course</a>\n                        before creating a new course instance.\n                      </p>\n                    `;\n                  }\n                  return html`\n                    <button\n                      type=\"button\"\n                      class=\"btn btn-sm btn-primary\"\n                      data-bs-toggle=\"modal\"\n                      data-bs-target=\"#createCourseInstanceModal\"\n                    >\n                      <i class=\"fa fa-plus\" aria-hidden=\"true\"></i>\n                      <span class=\"d-none d-sm-inline\">Add course instance</span>\n                    </button>\n                  `;\n                })}\n              </div>\n            `}\n      </div>\n    `,\n  });\n}\n\nfunction PopoverStartDate() {\n  return html`\n    <p>\n      This date is the earliest <code>startDate</code> that appears in any\n      <code>accessRule</code> for the course instance. Course instances are listed in order from\n      newest to oldest according to this date.\n    </p>\n    <p>\n      It is recommended that you define at least one <code>accessRule</code> that makes the course\n      instance accessible to students only during the semester or other time period in which that\n      particular course instance is offered. You can do so by editing the\n      <code>infoCourseInstance.json</code> file for the course instance. For more information, see\n      the\n      <a href=\"https://prairielearn.readthedocs.io/en/latest/accessControl/\"\n        >documentation on access control</a\n      >.\n    </p>\n  `.toString();\n}\n\nfunction PopoverEndDate() {\n  return html`\n    <p>\n      This date is the latest <code>endDate</code> that appears in any <code>accessRule</code> for\n      the course instance. If two course instances have the same \"Earliest Access Date,\" then they\n      are listed from newest to oldest according to this \"Latest Access Date.\"\n    </p>\n    <p>\n      It is recommended that you define at least one <code>accessRule</code> that makes the course\n      instance accessible to students only during the semester or other time period in which that\n      particular course instance is offered. You can do so by editing the\n      <code>infoCourseInstance.json</code> file for the course instance. For more information, see\n      the\n      <a href=\"https://prairielearn.readthedocs.io/en/latest/accessControl/\"\n        >documentation on access control</a\n      >.\n    </p>\n  `.toString();\n}\n\nfunction CreateCourseInstanceModal({\n  courseShortName,\n  csrfToken,\n  initialStartDateFormatted,\n  initialEndDateFormatted,\n  timezone,\n}: {\n  courseShortName: string;\n  csrfToken: string;\n  initialStartDateFormatted: string;\n  initialEndDateFormatted: string;\n  timezone: string;\n}) {\n  return Modal({\n    id: 'createCourseInstanceModal',\n    title: 'Create course instance',\n    formMethod: 'POST',\n    body: html`\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"long_name\">Long name</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"long_name\"\n          name=\"long_name\"\n          required\n          aria-describedby=\"long_name_help\"\n        />\n        <small id=\"long_name_help\" class=\"form-text text-muted\">\n          The full course instance name, such as \"Fall 2025\". Users see it joined to the course\n          name, e.g. \"${courseShortName} Fall 2025\".\n        </small>\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"short_name\">Short name</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"short_name\"\n          name=\"short_name\"\n          required\n          pattern=\"[\\\\-A-Za-z0-9_\\\\/]+\"\n          aria-describedby=\"short_name_help\"\n        />\n        <small id=\"short_name_help\" class=\"form-text text-muted\">\n          A short name, such as \"Fa25\" or \"W25b\". This is used in menus and headers where a short\n          description is required. Use only letters, numbers, dashes, and underscores, with no\n          spaces.\n        </small>\n      </div>\n      <div class=\"form-check mb-3\">\n        <input\n          type=\"checkbox\"\n          class=\"form-check-input\"\n          id=\"access_dates_enabled\"\n          name=\"access_dates_enabled\"\n          aria-describedby=\"access_dates_enabled_help\"\n        />\n        <label class=\"form-check-label\" for=\"access_dates_enabled\">\n          Make course instance available to students\n          <br />\n          <small id=\"access_dates_enabled_help\" class=\"form-text text-muted mt-0\">\n            This can be enabled later.\n          </small>\n        </label>\n      </div>\n      <div id=\"accessDates\" hidden>\n        <div class=\"mb-3\">\n          <label class=\"form-label\" for=\"start_access_date\">Access start date</label>\n          <div class=\"input-group date-picker\">\n            <input\n              class=\"form-control date-picker\"\n              type=\"datetime-local\"\n              id=\"start_access_date\"\n              name=\"start_access_date\"\n              value=\"${initialStartDateFormatted}\"\n              aria-describedby=\"start_access_date_help\"\n            />\n            <span class=\"input-group-text date-picker\">${timezone}</span>\n          </div>\n          <small id=\"start_access_date_help\" class=\"form-text text-muted\">\n            The date when students can access the course instance. Can be edited later.\n          </small>\n        </div>\n        <div class=\"mb-3\">\n          <label class=\"form-label\" for=\"end_access_date\">Access end date</label>\n          <div class=\"input-group date-picker\">\n            <input\n              class=\"form-control date-picker\"\n              type=\"datetime-local\"\n              id=\"end_access_date\"\n              name=\"end_access_date\"\n              value=\"${initialEndDateFormatted}\"\n              aria-describedby=\"end_access_date_help\"\n            />\n            <span class=\"input-group-text date-picker\">${timezone}</span>\n          </div>\n          <small id=\"end_access_date_help\" class=\"form-text text-muted\">\n            The date when students can no longer access the course instance. Can be edited later.\n          </small>\n        </div>\n      </div>\n    `,\n    footer: html`\n      <input type=\"hidden\" name=\"__action\" value=\"add_course_instance\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n      <button type=\"submit\" id=\"add_course_instance_button\" class=\"btn btn-primary\">Create</button>\n    `,\n  });\n}\n"]}