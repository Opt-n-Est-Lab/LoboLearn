{"version":3,"file":"instructorCourseAdminSharing.html.js","sourceRoot":"","sources":["../../../src/pages/instructorCourseAdminSharing/instructorCourseAdminSharing.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\n\nimport { type HtmlSafeString, escapeHtml, html } from '@prairielearn/html';\n\nimport { Modal } from '../../components/Modal.html.js';\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { CourseSyncErrorsAndWarnings } from '../../components/SyncErrorsAndWarnings.html.js';\n\nexport const SharingSetRowSchema = z.object({\n  name: z.string(),\n  id: z.string(),\n  shared_with: z.string().array(),\n});\ntype SharingSetRow = z.infer<typeof SharingSetRowSchema>;\n\nfunction AddCourseToSharingSetPopover({\n  sharing_set,\n  resLocals,\n}: {\n  sharing_set: SharingSetRow;\n  resLocals: Record<string, any>;\n}) {\n  return html`\n    <form name=\"sharing-set-access-add-${sharing_set.id}\" method=\"POST\">\n      <input type=\"hidden\" name=\"__action\" value=\"course_sharing_set_add\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${resLocals.__csrf_token}\" />\n      <input type=\"hidden\" name=\"unsafe_sharing_set_id\" value=\"${sharing_set.id}\" />\n      <div class=\"mb-3\">\n        <div class=\"form-text text-wrap\">\n          <p>\n            To allow another course to access questions in the sharing set \"${sharing_set.name}\",\n            enter their course sharing token below.\n          </p>\n        </div>\n      </div>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"course_sharing_token\">Course sharing token</label>\n        <input\n          class=\"form-control form-control-sm\"\n          type=\"text\"\n          id=\"course_sharing_token\"\n          name=\"unsafe_course_sharing_token\"\n          required\n        />\n      </div>\n      <div>\n        <button type=\"button\" class=\"btn btn-sm btn-secondary\" data-bs-dismiss=\"popover\">\n          Cancel\n        </button>\n        <button type=\"submit\" class=\"btn btn-sm btn-primary\">Add Course</button>\n      </div>\n    </form>\n  `;\n}\n\nfunction ChooseSharingNameModal({\n  canChooseSharingName,\n  csrfToken,\n}: {\n  canChooseSharingName: boolean;\n  csrfToken: string;\n}) {\n  let body: HtmlSafeString;\n  let footer: HtmlSafeString;\n  if (canChooseSharingName) {\n    body = html`\n      <p class=\"form-text\">Enter the sharing name you would like for your course.</p>\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"course_sharing_name\">Sharing name</label>\n        <input\n          class=\"form-control\"\n          type=\"text\"\n          id=\"course_sharing_name\"\n          name=\"course_sharing_name\"\n          required\n        />\n      </div>\n      <p>\n        <strong>\n          Once you have shared a question either publicly or with another course, you will no longer\n          be able to change your sharing name.\n        </strong>\n        Doing so would break the assessments of other courses that have imported your questions. It\n        is recommended that you choose something short but descriptive. For example, if you're\n        teaching a calculus course at a university that goes by the abbreviation 'XYZ', then you\n        could choose the sharing name 'xyz-calculus'. Then other courses will import questions from\n        your course with the syntax '@xyz-calculus/qid'.\n      </p>\n    `;\n    footer = html`\n      <input type=\"hidden\" name=\"__action\" value=\"choose_sharing_name\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <button type=\"submit\" class=\"btn btn-primary\">Choose Sharing Name</button>\n    `;\n  } else {\n    body = html`\n      <strong>Unable to change your course's sharing name.</strong>\n      <p>\n        Your course's sharing name cannot be changed because at least one question has been shared.\n        Doing so would break the assessments of other courses that have imported your questions.\n      </p>\n    `;\n    footer = html`\n      <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Close</button>\n    `;\n  }\n  return Modal({\n    title: 'Choose Sharing Name',\n    id: 'chooseSharingNameModal',\n    form: canChooseSharingName,\n    body,\n    footer,\n  });\n}\n\nexport function InstructorCourseAdminSharing({\n  sharingName,\n  sharingToken,\n  sharingSets,\n  publicSharingLink,\n  canChooseSharingName,\n  resLocals,\n}: {\n  sharingName: string | null;\n  sharingToken: string;\n  sharingSets: SharingSetRow[];\n  publicSharingLink: string;\n  canChooseSharingName: boolean;\n  resLocals: Record<string, any>;\n}) {\n  const isCourseOwner = resLocals.authz_data.has_course_permission_own;\n\n  return PageLayout({\n    resLocals,\n    pageTitle: 'Course sharing',\n    navContext: {\n      type: 'instructor',\n      page: 'course_admin',\n      subPage: 'sharing',\n    },\n    options: {\n      fullWidth: true,\n    },\n    content: html`\n      ${CourseSyncErrorsAndWarnings({\n        authz_data: resLocals.authz_data,\n        course: resLocals.course,\n        urlPrefix: resLocals.urlPrefix,\n      })}\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white d-flex\">\n          <h1>Course sharing details</h1>\n        </div>\n        <table\n          class=\"table table-sm table-hover two-column-description\"\n          aria-label=\"Course sharing details\"\n        >\n          <tbody>\n            <tr>\n              <th>Sharing name</th>\n              <td data-testid=\"sharing-name\">\n                ${sharingName !== null ? sharingName : ''}\n                ${isCourseOwner\n                  ? html`\n                      <button\n                        type=\"button\"\n                        class=\"btn btn-xs btn-secondary mx-2\"\n                        aria-label=\"Choose Sharing Name\"\n                        data-bs-toggle=\"modal\"\n                        data-bs-target=\"#chooseSharingNameModal\"\n                      >\n                        <i class=\"fas fa-share-nodes\" aria-hidden=\"true\"></i>\n                        <span class=\"d-none d-sm-inline\">Choose Sharing Name</span>\n                      </button>\n                      ${ChooseSharingNameModal({\n                        canChooseSharingName,\n                        csrfToken: resLocals.__csrf_token,\n                      })}\n                    `\n                  : ''}\n              </td>\n            </tr>\n            <tr>\n              <th>Sharing Token</th>\n              <td>\n                ${sharingToken}\n                <button\n                  type=\"button\"\n                  class=\"btn btn-xs btn-secondary mx-2\"\n                  onclick=\"navigator.clipboard.writeText('${sharingToken}');\"\n                >\n                  <i class=\"fa fa-copy\"></i>\n                  <span>Copy</span>\n                </button>\n                ${isCourseOwner\n                  ? html`\n                      <form name=\"sharing-id-regenerate\" method=\"POST\" class=\"d-inline\">\n                        <input type=\"hidden\" name=\"__action\" value=\"sharing_token_regenerate\" />\n                        <input\n                          type=\"hidden\"\n                          name=\"__csrf_token\"\n                          value=\"${resLocals.__csrf_token}\"\n                        />\n                        <button type=\"submit\" class=\"btn btn-xs btn-secondary\">\n                          <i class=\"fa fa-rotate\"></i>\n                          <span>Regenerate</span>\n                        </button>\n                      </form>\n                    `\n                  : ''}\n              </td>\n            </tr>\n            <tr>\n              <th>Public Questions Page</th>\n              <td class=\"align-middle\">\n                <a href=\"${publicSharingLink}\" target=\"_blank\">${publicSharingLink}</a>\n                <button\n                  type=\"button\"\n                  class=\"btn btn-xs btn-secondary mx-2\"\n                  onclick=\"navigator.clipboard.writeText('${publicSharingLink}');\"\n                >\n                  <i class=\"fa fa-copy\"></i>\n                  <span>Copy</span>\n                </button>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white d-flex align-items-center\">\n          <h2>Sharing Sets</h2>\n        </div>\n        <table class=\"table table-sm table-hover table-striped\" aria-label=\"Sharing sets\">\n          <thead>\n            <tr>\n              <th>Sharing Set Name</th>\n              <th>Shared With</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${sharingSets.map(\n              (sharing_set) => html`\n                <tr>\n                  <td class=\"align-middle\">${sharing_set.name}</td>\n                  <td class=\"align-middle\" data-testid=\"shared-with\">\n                    ${sharing_set.shared_with.map(\n                      (course_shared_with) => html`\n                        <span class=\"badge color-gray1\"> ${course_shared_with} </span>\n                      `,\n                    )}${isCourseOwner\n                      ? html`\n                          <div class=\"btn-group btn-group-sm\" role=\"group\">\n                            <button\n                              type=\"button\"\n                              class=\"btn btn-sm btn-outline-dark\"\n                              aria-label=\"Add course to sharing set\"\n                              data-bs-toggle=\"popover\"\n                              data-bs-container=\"body\"\n                              data-bs-html=\"true\"\n                              data-bs-placement=\"auto\"\n                              data-bs-title=\"Add Course to Sharing Set\"\n                              data-bs-content=\"${escapeHtml(\n                                AddCourseToSharingSetPopover({\n                                  resLocals,\n                                  sharing_set,\n                                }),\n                              )}\"\n                            >\n                              Add...\n                              <i class=\"fas fa-plus\" aria-hidden=\"true\"></i>\n                            </button>\n                          </div>\n                        `\n                      : ''}\n                  </td>\n                </tr>\n              `,\n            )}\n          </tbody>\n        </table>\n      </div>\n    `,\n  });\n}\n"]}