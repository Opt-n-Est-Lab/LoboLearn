{"version":3,"file":"instructorCourseAdminStaff.html.js","sourceRoot":"","sources":["../../../src/pages/instructorCourseAdminStaff/instructorCourseAdminStaff.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\n\nimport { escapeHtml, html } from '@prairielearn/html';\n\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { CourseSyncErrorsAndWarnings } from '../../components/SyncErrorsAndWarnings.html.js';\nimport {\n  type CourseInstance,\n  CourseInstancePermissionSchema,\n  CourseInstanceSchema,\n  CoursePermissionSchema,\n  type User,\n  UserSchema,\n} from '../../lib/db-types.js';\n\nexport const CourseUsersRowSchema = z.object({\n  user: UserSchema,\n  course_permission: CoursePermissionSchema,\n  course_instance_roles: z\n    .array(\n      z.object({\n        id: CourseInstanceSchema.shape.id,\n        short_name: CourseInstanceSchema.shape.short_name,\n        course_instance_permission_id: CourseInstancePermissionSchema.shape.id,\n        course_instance_role: CourseInstancePermissionSchema.shape.course_instance_role,\n        course_instance_role_formatted: z.string(),\n      }),\n    )\n    .nullable(),\n  other_course_instances: z\n    .array(\n      z.object({\n        id: CourseInstanceSchema.shape.id,\n        short_name: CourseInstanceSchema.shape.short_name,\n      }),\n    )\n    .nullable(),\n});\ntype CourseUsersRow = z.infer<typeof CourseUsersRowSchema>;\n\nfunction hasUnknownUsers(courseUsers: CourseUsersRow[]) {\n  return courseUsers.some((courseUser) => courseUser.user.name == null);\n}\n\nexport function InstructorCourseAdminStaff({\n  resLocals,\n  courseInstances,\n  courseUsers,\n  uidsLimit,\n  githubAccessLink,\n}: {\n  resLocals: Record<string, any>;\n  courseInstances: CourseInstance[];\n  courseUsers: CourseUsersRow[];\n  uidsLimit: number;\n  githubAccessLink: string | null;\n}) {\n  return PageLayout({\n    resLocals,\n    pageTitle: 'Staff',\n    navContext: {\n      type: 'instructor',\n      page: 'course_admin',\n      subPage: 'staff',\n    },\n    options: {\n      fullWidth: true,\n    },\n    headContent: html`\n      <style>\n        .popover {\n          max-width: 35%;\n        }\n      </style>\n    `,\n    content: html`\n      ${CourseSyncErrorsAndWarnings({\n        authz_data: resLocals.authz_data,\n        course: resLocals.course,\n        urlPrefix: resLocals.urlPrefix,\n      })}\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white d-flex flex-wrap align-items-center\">\n          <h1 class=\"me-2\">Staff</h1>\n          <div class=\"ms-auto\">\n            <button\n              type=\"button\"\n              class=\"btn btn-light btn-sm\"\n              aria-label=\"Remove all student data access\"\n              data-bs-toggle=\"popover\"\n              data-bs-container=\"body\"\n              data-bs-html=\"true\"\n              data-bs-placement=\"auto\"\n              data-bs-title=\"Remove all student data access\"\n              data-bs-content=\"${escapeHtml(\n                CoursePermissionsRemoveStudentDataAccessForm({\n                  csrfToken: resLocals.__csrf_token,\n                }),\n              )}\"\n              data-testid=\"remove-all-student-data-access-button\"\n            >\n              <i class=\"fas fa-eye-slash\" aria-hidden=\"true\"></i>\n              <span class=\"d-none d-sm-inline\">Remove all student data access</span>\n            </button>\n            <button\n              type=\"button\"\n              class=\"btn btn-light btn-sm\"\n              aria-label=\"Delete users with no access\"\n              data-bs-toggle=\"popover\"\n              data-bs-container=\"body\"\n              data-bs-html=\"true\"\n              data-bs-placement=\"auto\"\n              data-bs-title=\"Delete users with no access\"\n              data-bs-content=\"${escapeHtml(\n                CoursePermissionsDeleteNoAccessForm({\n                  csrfToken: resLocals.__csrf_token,\n                }),\n              )}\"\n              data-testid=\"delete-users-with-no-access-button\"\n            >\n              <i class=\"fas fa-recycle\" aria-hidden=\"true\"></i>\n              <span class=\"d-none d-sm-inline\">Delete users with no access</span>\n            </button>\n            <button\n              type=\"button\"\n              class=\"btn btn-light btn-sm\"\n              aria-label=\"Delete non-owners\"\n              data-bs-toggle=\"popover\"\n              data-bs-container=\"body\"\n              data-bs-html=\"true\"\n              data-bs-placement=\"auto\"\n              data-bs-title=\"Delete non-owners\"\n              data-bs-content=\"${escapeHtml(\n                CoursePermissionsDeleteNonOwnersForm({\n                  csrfToken: resLocals.__csrf_token,\n                }),\n              )}\"\n              data-testid=\"delete-non-owners-button\"\n            >\n              <i class=\"fas fa-users-slash\" aria-hidden=\"true\"></i>\n              <span class=\"d-none d-sm-inline\">Delete non-owners</span>\n            </button>\n            <button\n              type=\"button\"\n              class=\"btn btn-light btn-sm\"\n              aria-label=\"Add users\"\n              data-bs-toggle=\"popover\"\n              data-bs-container=\"body\"\n              data-bs-html=\"true\"\n              data-bs-placement=\"auto\"\n              data-bs-title=\"Add users\"\n              data-bs-content=\"${escapeHtml(\n                CoursePermissionsInsertForm({\n                  csrfToken: resLocals.__csrf_token,\n                  uidsLimit,\n                  courseInstances,\n                }),\n              )}\"\n              data-testid=\"add-users-button\"\n            >\n              <i class=\"fas fa-users\" aria-hidden=\"true\"></i>\n              <span class=\"d-none d-sm-inline\">Add users</span>\n            </button>\n          </div>\n        </div>\n        ${StaffTable({\n          csrfToken: resLocals.__csrf_token,\n          courseUsers,\n          authnUser: resLocals.authn_user,\n          user: resLocals.user,\n          isAdministrator: resLocals.is_administrator,\n        })}\n        <div class=\"card-footer small\">\n          ${hasUnknownUsers(courseUsers)\n            ? html`\n                <p class=\"alert alert-warning\">\n                  Users with name \"<span class=\"text-danger\">Unknown user</span>\" either have never\n                  logged in or have an incorrect UID.\n                </p>\n              `\n            : ''}\n          <details>\n            <summary>Recommended access levels</summary>\n            ${AccessLevelsTable()}\n          </details>\n          ${githubAccessLink\n            ? html`\n                <div class=\"alert alert-info mt-3\">\n                  The settings above do not affect access to the course's Git repository. To change\n                  repository permissions, go to the\n                  <a class=\"alert-link\" href=\"${githubAccessLink}\" target=\"_blank\">\n                    GitHub access settings page</a\n                  >.\n                </div>\n              `\n            : ''}\n        </div>\n      </div>\n    `,\n  });\n}\n\nfunction CoursePermissionsRemoveStudentDataAccessForm({ csrfToken }: { csrfToken: string }) {\n  return html`\n    <form name=\"remove-student-data-access\" method=\"POST\">\n      <input type=\"hidden\" name=\"__action\" value=\"remove_all_student_data_access\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n\n      <div class=\"mb-3\">\n        <p class=\"form-text\">\n          Taking this action will remove all student data access from all users (but will leave\n          these users on the course staff).\n        </p>\n      </div>\n\n      <div class=\"text-right\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"popover\">Cancel</button>\n        <button type=\"submit\" class=\"btn btn-primary\">Remove all student data access</button>\n      </div>\n    </form>\n  `;\n}\n\nfunction CoursePermissionsDeleteNoAccessForm({ csrfToken }: { csrfToken: string }) {\n  return html`\n    <form name=\"delete-no-access\" method=\"POST\">\n      <input type=\"hidden\" name=\"__action\" value=\"delete_no_access\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n\n      <div class=\"mb-3\">\n        <p class=\"form-text\">\n          Taking this action will remove every user from course staff who has neither course content\n          access nor student data access.\n        </p>\n      </div>\n\n      <div class=\"text-right\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"popover\">Cancel</button>\n        <button type=\"submit\" class=\"btn btn-primary\">Delete users with no access</button>\n      </div>\n    </form>\n  `;\n}\n\nfunction CoursePermissionsInsertForm({\n  csrfToken,\n  uidsLimit,\n  courseInstances,\n}: {\n  csrfToken: string;\n  uidsLimit: number;\n  courseInstances: CourseInstance[];\n}) {\n  return html`\n    <form name=\"add-users-form\" method=\"POST\">\n      <input type=\"hidden\" name=\"__action\" value=\"course_permissions_insert_by_user_uids\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n\n      <div class=\"mb-3\">\n        <p class=\"form-text\">\n          Use this form to add users to the course staff. Any UIDs of users who are already on the\n          course staff will have their permissions updated only if the new permissions are higher\n          than their existing permissions. All new users will be given the same access to course\n          content and to student data.\n        </p>\n      </div>\n\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"addUsersInputUid\">UIDs:</label>\n        <textarea\n          class=\"form-control\"\n          id=\"addUsersInputUid\"\n          name=\"uid\"\n          placeholder=\"staff1@example.com, staff2@example.com\"\n          required\n          aria-describedby=\"addUsersInputUidHelp\"\n        ></textarea>\n        <small id=\"addUsersInputUidHelp\" class=\"form-text text-muted\">\n          Enter up to ${uidsLimit} UIDs separated by commas, semicolons, or whitespace.\n        </small>\n      </div>\n\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"addUsersInputCourseRole\">\n          Course content access for all new users:\n        </label>\n        <select\n          class=\"custom-select form-select-sm\"\n          id=\"addUsersInputCourseRole\"\n          name=\"course_role\"\n          required\n        >\n          <option value=\"None\" selected>None</option>\n          <option value=\"Previewer\">Previewer</option>\n          <option value=\"Viewer\">Viewer</option>\n          <option value=\"Editor\">Editor</option>\n          <option value=\"Owner\">Owner</option>\n        </select>\n      </div>\n\n      ${courseInstances?.length > 0\n        ? html`\n            <div class=\"mb-3\">\n              <label class=\"form-label\" for=\"addUsersInputCourseInstance\">\n                Student data access for all new users:\n              </label>\n              <div class=\"input-group\">\n                <select\n                  class=\"custom-select form-select-sm\"\n                  id=\"addUsersInputCourseInstance\"\n                  name=\"course_instance_id\"\n                >\n                  <option selected value>None</option>\n                  ${courseInstances.map(\n                    (ci) => html` <option value=\"${ci.id}\">${ci.short_name}</option>`,\n                  )}\n                </select>\n                <select\n                  class=\"custom-select form-select-sm\"\n                  id=\"addUsersInputCourseInstanceRole\"\n                  name=\"course_instance_role\"\n                >\n                  <option value=\"Student Data Viewer\" selected>Viewer</option>\n                  <option value=\"Student Data Editor\">Editor</option>\n                </select>\n              </div>\n            </div>\n          `\n        : ''}\n\n      <div class=\"text-right\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"popover\">Cancel</button>\n        <button type=\"submit\" class=\"btn btn-primary\">Add users</button>\n      </div>\n    </form>\n  `;\n}\n\nfunction CoursePermissionsDeleteNonOwnersForm({ csrfToken }: { csrfToken: string }) {\n  return html`\n    <form name=\"delete-non-owners\" method=\"POST\">\n      <input type=\"hidden\" name=\"__action\" value=\"delete_non_owners\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n\n      <div class=\"mb-3\">\n        <p class=\"form-text\">\n          Taking this action will remove every user from course staff who is not a course content\n          Owner.\n        </p>\n      </div>\n\n      <div class=\"text-right\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"popover\">Cancel</button>\n        <button type=\"submit\" class=\"btn btn-primary\">Delete non-owners</button>\n      </div>\n    </form>\n  `;\n}\n\nfunction StaffTable({\n  csrfToken,\n  courseUsers,\n  authnUser,\n  user,\n  isAdministrator,\n}: {\n  csrfToken: string;\n  courseUsers: CourseUsersRow[];\n  authnUser: User;\n  user: User;\n  isAdministrator: boolean;\n}) {\n  return html`\n    <table class=\"table table-sm table-hover table-striped\" aria-label=\"Course staff members\">\n      <thead>\n        <tr>\n          <th>UID</th>\n          <th>Name</th>\n          <th>Course content access</th>\n          <th>Student data access</th>\n          <th>Actions</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${courseUsers.map((courseUser) => {\n          // Cannot change the course role of yourself (or of the\n          // user you are emulating) unless you are an administrator.\n          const canChangeCourseRole =\n            (courseUser.user.user_id !== authnUser.user_id &&\n              courseUser.user.user_id !== user.user_id) ||\n            isAdministrator;\n          return html`\n            <tr>\n              <td class=\"align-middle\">${courseUser.user.uid}</td>\n              <td class=\"align-middle\">\n                ${courseUser.user.name\n                  ? courseUser.user.name\n                  : html`<span class=\"text-danger\">Unknown user</span>`}\n              </td>\n              <td class=\"align-middle\">\n                ${!canChangeCourseRole\n                  ? html`\n                      <button\n                        id=\"courseContentDropdown-${courseUser.user.user_id}\"\n                        type=\"button\"\n                        class=\"btn btn-sm btn-outline-primary disabled\"\n                        disabled\n                      >\n                        ${courseUser.course_permission.course_role}\n                      </button>\n                    `\n                  : html`\n                      <form\n                        name=\"course-content-access-form-${courseUser.user.user_id}\"\n                        method=\"POST\"\n                      >\n                        <input\n                          type=\"hidden\"\n                          name=\"__action\"\n                          value=\"course_permissions_update_role\"\n                        />\n                        <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n                        <input type=\"hidden\" name=\"user_id\" value=\"${courseUser.user.user_id}\" />\n                        <div class=\"btn-group btn-group-sm\" role=\"group\">\n                          <button\n                            id=\"courseContentDropdown-${courseUser.user.user_id}\"\n                            type=\"button\"\n                            class=\"btn btn-sm btn-outline-primary dropdown-toggle\"\n                            data-bs-toggle=\"dropdown\"\n                            aria-haspopup=\"true\"\n                            aria-expanded=\"false\"\n                          >\n                            ${courseUser.course_permission.course_role}\n                          </button>\n                          <div\n                            class=\"dropdown-menu\"\n                            aria-labelledby=\"courseContentDropdown-${courseUser.user.user_id}\"\n                            style=\"width: 35em;\"\n                          >\n                            <div class=\"dropdown-header text-wrap\">\n                              <p>\n                                Users with course content access can see aggregate student data\n                                (e.g., mean scores), but cannot see the names or scores of\n                                individual students without also having student data access to a\n                                particular course instance.\n                              </p>\n                            </div>\n                            <div class=\"dropdown-divider\"></div>\n                            <button\n                              class=\"dropdown-item mt-2\"\n                              type=\"submit\"\n                              name=\"course_role\"\n                              value=\"None\"\n                            >\n                              <div class=\"text-wrap\">\n                                <h6>None</h6>\n                                <p class=\"small\">Cannot see any course content.</p>\n                              </div>\n                            </button>\n                            <div class=\"dropdown-divider\"></div>\n                            <button\n                              class=\"dropdown-item\"\n                              type=\"submit\"\n                              name=\"course_role\"\n                              value=\"Previewer\"\n                            >\n                              <div class=\"text-wrap\">\n                                <h6>Previewer</h6>\n                                <p class=\"small\">\n                                  Can see all questions, course instances, and assessments. Can see\n                                  but not close issues. Cannot see any code or configuration files.\n                                </p>\n                              </div>\n                            </button>\n                            <div class=\"dropdown-divider\"></div>\n                            <button\n                              class=\"dropdown-item\"\n                              type=\"submit\"\n                              name=\"course_role\"\n                              value=\"Viewer\"\n                            >\n                              <div class=\"text-wrap\">\n                                <h6>Viewer</h6>\n                                <p class=\"small\">\n                                  Can see all questions, course instances, and assessments. Can see\n                                  but not close issues. Can see and download but not edit all code\n                                  and configuration files.\n                                </p>\n                              </div>\n                            </button>\n                            <div class=\"dropdown-divider\"></div>\n                            <button\n                              class=\"dropdown-item\"\n                              type=\"submit\"\n                              name=\"course_role\"\n                              value=\"Editor\"\n                            >\n                              <div class=\"text-wrap\">\n                                <h6>Editor</h6>\n                                <p class=\"small\">\n                                  Can see all questions, course instances, and assessments. Can see\n                                  and close issues. Can see, download, and edit all code and\n                                  configuration files. Can sync course files to and from the GitHub\n                                  repository.\n                                </p>\n                              </div>\n                            </button>\n                            <div class=\"dropdown-divider\"></div>\n                            <button\n                              class=\"dropdown-item\"\n                              type=\"submit\"\n                              name=\"course_role\"\n                              value=\"Owner\"\n                            >\n                              <div class=\"text-wrap\">\n                                <h6>Owner</h6>\n                                <p class=\"small\">\n                                  Can see all questions, course instances, and assessments. Can see\n                                  and close issues. Can see, download, and edit all code and\n                                  configuration files. Can sync course files to and from the GitHub\n                                  repository. Can add and remove course staff and can change access\n                                  roles.\n                                </p>\n                              </div>\n                            </button>\n                          </div>\n                        </div>\n                      </form>\n                    `}\n              </td>\n              <td class=\"align-middle\">\n                ${courseUser.course_instance_roles\n                  ? courseUser.course_instance_roles.map((cir) => {\n                      return html`\n                        <form\n                          name=\"student-data-access-change-${courseUser.user.user_id}-${cir.id}\"\n                          method=\"POST\"\n                          class=\"d-inline\"\n                        >\n                          <input\n                            type=\"hidden\"\n                            name=\"__action\"\n                            value=\"course_instance_permissions_update_role_or_delete\"\n                          />\n                          <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n                          <input type=\"hidden\" name=\"user_id\" value=\"${courseUser.user.user_id}\" />\n                          <input type=\"hidden\" name=\"course_instance_id\" value=\"${cir.id}\" />\n                          <div\n                            class=\"btn-group btn-group-sm\"\n                            role=\"group\"\n                            aria-label=\"Button group with nested dropdown\"\n                          >\n                            <div class=\"btn-group btn-group-sm\" role=\"group\">\n                              <button\n                                id=\"changeCIPDrop-${courseUser.user.user_id}-${cir.id}\"\n                                type=\"button\"\n                                class=\"btn btn-sm btn-outline-primary dropdown-toggle\"\n                                data-bs-toggle=\"dropdown\"\n                                aria-haspopup=\"true\"\n                                aria-expanded=\"false\"\n                              >\n                                ${cir.short_name} (${cir.course_instance_role_formatted})\n                              </button>\n                              <div\n                                class=\"dropdown-menu\"\n                                aria-labelledby=\"changeCIPDrop-${courseUser.user.user_id}-${cir.id}\"\n                                style=\"width: 35em;\"\n                              >\n                                <div class=\"dropdown-header text-wrap\">\n                                  <p>\n                                    Users with student data access can see all assessments in the\n                                    course instance <code>${cir.short_name}</code>, can see all\n                                    questions, and can see issues. They cannot see any code or\n                                    configuration files, or close issues, without also having course\n                                    content access.\n                                  </p>\n                                </div>\n                                <div class=\"dropdown-divider\"></div>\n                                <button\n                                  class=\"dropdown-item\"\n                                  type=\"submit\"\n                                  name=\"course_instance_role\"\n                                  value=\"Student Data Viewer\"\n                                >\n                                  <div class=\"text-wrap\">\n                                    <h6>Viewer</h6>\n                                    <p class=\"small\">\n                                      Can see but not edit scores of individual students for the\n                                      course instance\n                                      <code>${cir.short_name}</code>.\n                                    </p>\n                                  </div>\n                                </button>\n                                <div class=\"dropdown-divider\"></div>\n                                <button\n                                  class=\"dropdown-item\"\n                                  type=\"submit\"\n                                  name=\"course_instance_role\"\n                                  value=\"Student Data Editor\"\n                                >\n                                  <div class=\"text-wrap\">\n                                    <h6>Editor</h6>\n                                    <p class=\"small\">\n                                      Can see and edit scores of individual students for the course\n                                      instance\n                                      <code>${cir.short_name}</code>.\n                                    </p>\n                                  </div>\n                                </button>\n                              </div>\n                            </div>\n                            <button\n                              type=\"submit\"\n                              class=\"btn btn-sm btn-outline-primary\"\n                              aria-label=\"Remove access\"\n                            >\n                              <i class=\"fa fa-times\"></i>\n                            </button>\n                          </div>\n                        </form>\n                      `;\n                    })\n                  : ''}\n                ${courseUser.other_course_instances?.length\n                  ? html`\n                      <form\n                        name=\"student-data-access-add-${courseUser.user.user_id}\"\n                        method=\"POST\"\n                        class=\"d-inline\"\n                      >\n                        <input\n                          type=\"hidden\"\n                          name=\"__action\"\n                          value=\"course_instance_permissions_insert\"\n                        />\n                        <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n                        <input type=\"hidden\" name=\"user_id\" value=\"${courseUser.user.user_id}\" />\n                        <div class=\"btn-group btn-group-sm\" role=\"group\">\n                          <button\n                            id=\"addCIPDrop-${courseUser.user.user_id}\"\n                            type=\"button\"\n                            class=\"btn btn-sm btn-outline-dark dropdown-toggle\"\n                            data-bs-toggle=\"dropdown\"\n                            aria-haspopup=\"true\"\n                            aria-expanded=\"false\"\n                          >\n                            Add...\n                          </button>\n                          <div\n                            class=\"dropdown-menu\"\n                            aria-labelledby=\"addCIPDrop-${courseUser.user.user_id}\"\n                          >\n                            ${courseUser.other_course_instances.map((ci) => {\n                              return html`\n                                <button\n                                  class=\"dropdown-item\"\n                                  type=\"submit\"\n                                  name=\"course_instance_id\"\n                                  value=\"${ci.id}\"\n                                >\n                                  ${ci.short_name}\n                                </button>\n                              `;\n                            })}\n                          </div>\n                        </div>\n                      </form>\n                    `\n                  : ''}\n              </td>\n              <td class=\"align-middle\">\n                ${courseUser.course_permission.course_role !== 'Owner' || isAdministrator\n                  ? html`\n                      <form\n                        name=\"student-data-access-remove-${courseUser.user.user_id}\"\n                        method=\"POST\"\n                      >\n                        <input type=\"hidden\" name=\"__action\" value=\"course_permissions_delete\" />\n                        <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n                        <input type=\"hidden\" name=\"user_id\" value=\"${courseUser.user.user_id}\" />\n                        <button type=\"submit\" class=\"btn btn-sm btn-outline-dark\">\n                          <i class=\"fa fa-times\"></i> Delete user\n                        </button>\n                      </form>\n                    `\n                  : ''}\n              </td>\n            </tr>\n          `;\n        })}\n      </tbody>\n    </table>\n  `;\n}\n\nfunction AccessLevelsTable() {\n  return html`\n    <table\n      class=\"table table-striped table-sm border\"\n      style=\"max-width: 45em\"\n      aria-label=\"Recommended access levels\"\n    >\n      <thead>\n        <tr>\n          <th scope=\"col\">Role</th>\n          <th class=\"text-center\" scope=\"col\">Course content access</th>\n          <th class=\"text-center\" scope=\"col\">Student data access</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td>Instructor</td>\n          <td class=\"text-center\">Course content owner</td>\n          <td class=\"text-center\">Student data editor</td>\n        </tr>\n        <tr>\n          <td>TAs developing course content</td>\n          <td class=\"text-center\">Course content editor</td>\n          <td class=\"text-center\">Student data editor</td>\n        </tr>\n        <tr>\n          <td>Student content developers (not TAs)</td>\n          <td class=\"text-center\">Course content editor</td>\n          <td class=\"text-center\">None</td>\n        </tr>\n        <tr>\n          <td>TAs involved in grading</td>\n          <td class=\"text-center\">None</td>\n          <td class=\"text-center\">Student data editor</td>\n        </tr>\n        <tr>\n          <td>Other TAs</td>\n          <td class=\"text-center\">None</td>\n          <td class=\"text-center\">Student data viewer</td>\n        </tr>\n        <tr>\n          <td>Instructors from other classes</td>\n          <td class=\"text-center\">Course content viewer</td>\n          <td class=\"text-center\">None</td>\n        </tr>\n      </tbody>\n    </table>\n  `;\n}\n"]}