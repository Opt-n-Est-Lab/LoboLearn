{"version":3,"file":"instructorEffectiveUser.html.js","sourceRoot":"","sources":["../../../src/pages/instructorEffectiveUser/instructorEffectiveUser.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { format, toZonedTime } from 'date-fns-tz';\nimport { z } from 'zod';\n\nimport { html } from '@prairielearn/html';\n\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport {\n  CourseInstancePermissionSchema,\n  CoursePermissionSchema,\n  UserSchema,\n} from '../../lib/db-types.js';\n\nexport const CourseRolesSchema = z.object({\n  available_course_roles: CoursePermissionSchema.shape.course_role.unwrap().array(),\n  available_course_instance_roles: CourseInstancePermissionSchema.shape.course_instance_role\n    .unwrap()\n    .array(),\n  available_uids: UserSchema.shape.uid.array().nullable(),\n});\nexport type CourseRoles = z.infer<typeof CourseRolesSchema>;\n\nexport function InstructorEffectiveUser({\n  resLocals,\n  ipAddress,\n  courseRoles,\n}: {\n  resLocals: Record<string, any>;\n  ipAddress: string;\n  courseRoles: CourseRoles;\n}) {\n  const { authz_data, course_instance, __csrf_token, req_date, true_req_date, user } = resLocals;\n\n  // This page can be mounted under `/pl/course/...`, in which case we won't\n  // have a course instance to get a display timezone from. In that case, we'll\n  // fall back to the course, and then to the institution. All institutions must\n  // have a display timezone, so we're always guaranteed to have one.\n  const displayTimezone =\n    resLocals.course_instance?.display_timezone ??\n    resLocals.course.display_timezone ??\n    resLocals.institution.display_timezone;\n\n  const formattedTrueReqDate = format(\n    toZonedTime(true_req_date, displayTimezone),\n    \"yyyy-MM-dd'T'HH:mm:ss.SSSxxx\",\n    { timeZone: displayTimezone },\n  );\n  const formattedReqDate = format(\n    toZonedTime(req_date, displayTimezone),\n    \"yyyy-MM-dd'T'HH:mm:ss.SSSxxx\",\n    { timeZone: displayTimezone },\n  );\n\n  return PageLayout({\n    pageTitle: 'Change Effective User',\n    resLocals,\n    navContext: {\n      type: resLocals.navbarType,\n      page: 'effective',\n    },\n    options: {\n      fullWidth: true,\n    },\n    content: html`\n      <h1 class=\"visually-hidden\">Effective User</h1>\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white\">\n          <h2>Authenticated user</h2>\n        </div>\n\n        <div class=\"card-body\">\n          <p><strong>Authenticated UID:</strong> ${authz_data.authn_user.uid}</p>\n          <p><strong>Authenticated name:</strong> ${authz_data.authn_user.name}</p>\n          <p><strong>Authenticated course role:</strong> ${authz_data.authn_course_role}</p>\n          ${course_instance\n            ? html`\n                <p>\n                  <strong>Authenticated course instance role:</strong>\n                  ${authz_data.authn_course_instance_role}\n                </p>\n              `\n            : ''}\n          <p><strong>Authenticated mode:</strong> ${authz_data.authn_mode}</p>\n          <p><strong>Authenticated date:</strong> ${formattedTrueReqDate}</p>\n\n          <form id=\"resetForm\" method=\"POST\">\n            <p>\n              <input type=\"hidden\" name=\"__action\" value=\"reset\" />\n              <input type=\"hidden\" name=\"__csrf_token\" value=\"${__csrf_token}\" />\n              <button type=\"submit\" class=\"btn btn-info\">Reset to these values</button>\n            </p>\n          </form>\n\n          <p><strong>Connecting from IP:</strong> ${ipAddress}</p>\n        </div>\n\n        <div class=\"card-footer\">\n          <small>\n            The <em>authenticated</em> values above are the ones that you logged in with. The\n            <em>effective</em> values below allow you to view PrairieLearn as if you had a different\n            <em>course role</em> or as if you were a specific other person with a different\n            <em>UID</em>. This can be used to test out how PrairieLearn will look from different\n            points of view. The “Reset to these values” button above will reset all effective values\n            below to your authenticated values. Effective values are also reset when you choose a\n            course instance or when you switch to a different course.\n          </small>\n        </div>\n      </div>\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white\">\n          <h2>Effective user</h2>\n        </div>\n\n        <div class=\"card-body\">\n          <p><strong>Effective UID:</strong> ${user.uid}</p>\n          <p><strong>Effective name:</strong> ${user.name}</p>\n\n          <div class=\"alert alert-secondary mb-0\">\n            <form id=\"changeUidForm\" method=\"POST\">\n              <div class=\"mb-3\">\n                <label class=\"form-label\" for=\"changeEffectiveUid\">Change effective UID to:</label>\n                <input\n                  list=\"userList\"\n                  type=\"text\"\n                  class=\"form-control me-2\"\n                  style=\"width: 20em;\"\n                  name=\"pl_requested_uid\"\n                  id=\"changeEffectiveUid\"\n                  placeholder=\"username@example.com\"\n                />\n                <datalist id=\"userList\">\n                  ${courseRoles.available_uids?.map(\n                    (available_uid) => html`\n                      <option value=\"${available_uid}\">${available_uid}</option>\n                    `,\n                  )}\n                </datalist>\n              </div>\n              <input type=\"hidden\" name=\"__action\" value=\"changeUid\" />\n              <input type=\"hidden\" name=\"__csrf_token\" value=\"${__csrf_token}\" />\n              <button type=\"submit\" class=\"btn btn-primary\">Change UID</button>\n            </form>\n          </div>\n        </div>\n\n        <div class=\"card-footer\">\n          <small>\n            Changing your effective user identity to another person allows you to see PrairieLearn\n            exactly as they would see it. You cannot emulate an effective user with a higher access\n            level than your own.\n          </small>\n        </div>\n      </div>\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white\">\n          <h2>Effective course role</h2>\n        </div>\n\n        <div class=\"card-body\">\n          <p><strong>Effective course role:</strong> ${authz_data.course_role}</p>\n\n          <div class=\"alert alert-secondary mb-0\">\n            <form id=\"changeCourseRoleForm\" method=\"POST\">\n              <div class=\"mb-3\">\n                <label class=\"form-label\" for=\"changeEffectiveCourseRole\">\n                  Change effective course role to:\n                </label>\n                <select\n                  class=\"form-select me-2\"\n                  id=\"changeEffectiveCourseRole\"\n                  name=\"pl_requested_course_role\"\n                >\n                  ${courseRoles.available_course_roles\n                    .reverse()\n                    .map((available_course_role) =>\n                      available_course_role === authz_data.course_role\n                        ? html`\n                            <option value=\"${available_course_role}\" selected>\n                              ${available_course_role} (current)\n                            </option>\n                          `\n                        : html`\n                            <option value=\"${available_course_role}\">\n                              ${available_course_role}\n                            </option>\n                          `,\n                    )}\n                </select>\n              </div>\n              <input type=\"hidden\" name=\"__action\" value=\"changeCourseRole\" />\n              <input type=\"hidden\" name=\"__csrf_token\" value=\"${__csrf_token}\" />\n              <button type=\"submit\" class=\"btn btn-primary\">Change course role</button>\n            </form>\n          </div>\n        </div>\n\n        <div class=\"card-footer\">\n          <small>\n            Your <em>course role</em> determines the permissions that you have to view and edit\n            course content in PrairieLearn. It is specific to this course, so you can be an Editor\n            in one course but a Previewer in a different course.\n          </small>\n        </div>\n      </div>\n\n      ${course_instance\n        ? html`\n            <div class=\"card mb-4\">\n              <div class=\"card-header bg-primary text-white\">\n                <h2>Effective course instance role</h2>\n              </div>\n\n              <div class=\"card-body\">\n                <p>\n                  <strong>Effective course instance role:</strong>\n                  ${authz_data.course_instance_role}\n                </p>\n\n                <div class=\"alert alert-secondary mb-0\">\n                  <form id=\"changeCourseInstanceRoleForm\" method=\"POST\">\n                    <div class=\"mb-3\">\n                      <label class=\"form-label\" for=\"changeEffectiveCourseInstanceRole\">\n                        Change effective course instance role to:\n                      </label>\n                      <select\n                        class=\"form-select me-2\"\n                        id=\"changeEffectiveCourseInstanceRole\"\n                        name=\"pl_requested_course_instance_role\"\n                      >\n                        ${courseRoles.available_course_instance_roles\n                          .reverse()\n                          .map((available_course_instance_role) =>\n                            available_course_instance_role === authz_data.course_instance_role\n                              ? html`\n                                  <option value=\"${available_course_instance_role}\" selected>\n                                    ${available_course_instance_role} (current)\n                                  </option>\n                                `\n                              : html`\n                                  <option value=\"${available_course_instance_role}\">\n                                    ${available_course_instance_role}\n                                  </option>\n                                `,\n                          )}\n                      </select>\n                    </div>\n                    <input type=\"hidden\" name=\"__action\" value=\"changeCourseInstanceRole\" />\n                    <input type=\"hidden\" name=\"__csrf_token\" value=\"${__csrf_token}\" />\n                    <button type=\"submit\" class=\"btn btn-primary\">\n                      Change course instance role\n                    </button>\n                  </form>\n                </div>\n              </div>\n\n              <div class=\"card-footer\">\n                <small>\n                  Your <em>course instance role</em> determines the permissions that you have to\n                  view and edit student data in PrairieLearn. It is specific to this course\n                  instance, so you can be a Student Data Editor in one course instance but a Student\n                  Data Viewer in a different course instance.\n                </small>\n              </div>\n            </div>\n          `\n        : ''}\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white\">\n          <h2>Effective date</h2>\n        </div>\n\n        <div class=\"card-body\">\n          <p><strong>Effective date:</strong> ${formattedReqDate}</p>\n\n          <div class=\"alert alert-secondary mb-0\">\n            <form id=\"changeDateForm\" method=\"POST\">\n              <div class=\"mb-3\">\n                <label class=\"form-label\" for=\"changeDate\">Change effective date to:</label>\n                <input\n                  type=\"text\"\n                  class=\"form-control me-2\"\n                  style=\"width:30em;\"\n                  id=\"changeDate\"\n                  name=\"pl_requested_date\"\n                  value=\"${formattedReqDate}\"\n                />\n              </div>\n              <input type=\"hidden\" name=\"__action\" value=\"changeDate\" />\n              <input type=\"hidden\" name=\"__csrf_token\" value=\"${__csrf_token}\" />\n              <button type=\"submit\" class=\"btn btn-primary\">Change date</button>\n            </form>\n          </div>\n        </div>\n\n        <div class=\"card-footer\">\n          <small>\n            The <em>date</em> of the server determines which assessments are available. Changing the\n            effective date to something other than the current date allows you to check if homework\n            and exam assessments will be available to students when you mean them to be. The date\n            has the format <code>YYYY-MM-DDTHH:MM:SS.SSS</code>, with a suffix that gives the offset\n            from UTC (i.e., the time zone) in the format <code>&plusmn;HH:MM</code>.\n          </small>\n        </div>\n      </div>\n    `,\n  });\n}\n"]}