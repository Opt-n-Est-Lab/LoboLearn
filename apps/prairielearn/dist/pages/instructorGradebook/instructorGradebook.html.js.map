{"version":3,"file":"instructorGradebook.html.js","sourceRoot":"","sources":["../../../src/pages/instructorGradebook/instructorGradebook.html.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,WAAW,EAAE,MAAM,6BAA6B,CAAC;AAC1D,OAAO,EAAE,IAAI,EAAE,MAAM,oBAAoB,CAAC;AAE1C,OAAO,EAAE,KAAK,EAAE,MAAM,gCAAgC,CAAC;AACvD,OAAO,EAAE,UAAU,EAAE,MAAM,qCAAqC,CAAC;AACjE,OAAO,EAAE,mCAAmC,EAAE,MAAM,gDAAgD,CAAC;AACrG,OAAO,EACL,iBAAiB,EACjB,qBAAqB,EACrB,oBAAoB,GACrB,MAAM,qBAAqB,CAAC;AAC7B,OAAO,EAAa,MAAM,uBAAuB,CAAC;AAElD,OAAO,EAGN,MAAM,gCAAgC,CAAC;AAExC,MAAM,UAAU,mBAAmB,CAAC,EAClC,SAAS,EACT,YAAY,EACZ,WAAW,EACX,iBAAiB,GAMlB;IACC,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,YAAY,EAAE,GAAG,SAAS,CAAC;IAE1D,OAAO,UAAU,CAAC;QAChB,SAAS;QACT,SAAS,EAAE,WAAW;QACtB,UAAU,EAAE;YACV,IAAI,EAAE,YAAY;YAClB,IAAI,EAAE,gBAAgB;YACtB,OAAO,EAAE,WAAW;SACrB;QACD,OAAO,EAAE;YACP,SAAS,EAAE,IAAI;SAChB;QACD,WAAW,EAAE,IAAI,CAAA;;;qBAGA,oBAAoB,CAAC,6CAA6C,CAAC;;gBAExE,oBAAoB,CAAC,8CAA8C,CAAC;;;;gBAIpE,oBAAoB,CAC1B,qFAAqF,CACtF;;;QAGD,iBAAiB,CAAC,kCAAkC,CAAC;QACrD,iBAAiB,CAAC,8BAA8B,CAAC;QACjD,qBAAqB,CAAC,yBAAyB,CAAC;QAChD,WAAW,CACX;YACE,SAAS;YACT,WAAW;YACX,SAAS,EAAE,YAAY;YACvB,+BAA+B,EAAE,UAAU,CAAC,mCAAmC;YAC/E,iBAAiB,EAAE,iBAAiB,IAAI,EAAE;SAC3C,EACD,gBAAgB,CACjB;KACF;QACD,OAAO,EAAE,IAAI,CAAA;QACT,mCAAmC,CAAC;YACpC,UAAU;YACV,cAAc,EAAE,SAAS,CAAC,eAAe;YACzC,MAAM,EAAE,SAAS,CAAC,MAAM;YACxB,SAAS;SACV,CAAC;QACA,CAAC,UAAU,CAAC,mCAAmC;YAC/C,CAAC,CAAC,sBAAsB,CAAC;gBACrB,YAAY;gBACZ,sBAAsB,EAAE,UAAU,CAAC,yBAAyB;gBAC5D,SAAS;aACV,CAAC;YACJ,CAAC,CAAC,IAAI,CAAA;;;;;;;;;;;cAWA,oBAAoB,EAAE;WACzB;KACN;KACF,CAAC,CAAC;AACL,CAAC;AAED,SAAS,sBAAsB,CAAC,EAC9B,YAAY,EACZ,sBAAsB,EACtB,SAAS,GAKV;IACC,OAAO,IAAI,CAAA;;;;;;;;UAQH,sBAAsB;QACtB,CAAC,CAAC,IAAI,CAAA;;;2BAGW,SAAS;;aAEvB;QACH,CAAC,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC;YACvB,CAAC,CAAC,IAAI,CAAA;;;oBAGE,YAAY,CAAC,GAAG,CAChB,CAAC,KAAK,EAAE,EAAE,CAAC,IAAI,CAAA,OAAO,KAAK,CAAC,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,EAAE,OAAO,CAC9E;;eAEJ;YACH,CAAC,CAAC,EAAE;;;GAGb,CAAC;AACJ,CAAC;AAED,SAAS,oBAAoB;IAC3B,OAAO,KAAK,CAAC;QACX,EAAE,EAAE,WAAW;QACf,KAAK,EAAE,OAAO;QACd,IAAI,EAAE,KAAK;QACX,IAAI,EAAE,IAAI,CAAA;;;;;;;;;;;;;;;;;KAiBT;QACD,MAAM,EAAE,IAAI,CAAA;;KAEX;KACF,CAAC,CAAC;AACL,CAAC","sourcesContent":["import { EncodedData } from '@prairielearn/browser-utils';\nimport { html } from '@prairielearn/html';\n\nimport { Modal } from '../../components/Modal.html.js';\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { CourseInstanceSyncErrorsAndWarnings } from '../../components/SyncErrorsAndWarnings.html.js';\nimport {\n  compiledScriptTag,\n  compiledStylesheetTag,\n  nodeModulesAssetPath,\n} from '../../lib/assets.js';\nimport { type User } from '../../lib/db-types.js';\n\nimport {\n  type CourseAssessmentRow,\n  type InstructorGradebookData,\n} from './instructorGradebook.types.js';\n\nexport function InstructorGradebook({\n  resLocals,\n  courseOwners,\n  csvFilename,\n  courseAssessments,\n}: {\n  resLocals: Record<string, any>;\n  courseOwners: User[];\n  csvFilename: string;\n  courseAssessments?: CourseAssessmentRow[];\n}) {\n  const { authz_data, urlPrefix, __csrf_token } = resLocals;\n\n  return PageLayout({\n    resLocals,\n    pageTitle: 'Gradebook',\n    navContext: {\n      type: 'instructor',\n      page: 'instance_admin',\n      subPage: 'gradebook',\n    },\n    options: {\n      fullWidth: true,\n    },\n    headContent: html`\n      <!-- Importing javascript using <script> tags as below is *not* the preferred method, it is better to directly use 'import'\n        from a javascript file. However, bootstrap-table is doing some hacky stuff that prevents us from importing it that way. -->\n      <script src=\"${nodeModulesAssetPath('bootstrap-table/dist/bootstrap-table.min.js')}\"></script>\n      <link\n        href=\"${nodeModulesAssetPath('bootstrap-table/dist/bootstrap-table.min.css')}\"\n        rel=\"stylesheet\"\n      />\n      <link\n        href=\"${nodeModulesAssetPath(\n          'bootstrap-table/dist/extensions/sticky-header/bootstrap-table-sticky-header.min.css',\n        )}\"\n        rel=\"stylesheet\"\n      />\n      ${compiledScriptTag('bootstrap-table-sticky-header.js')}\n      ${compiledScriptTag('instructorGradebookClient.ts')}\n      ${compiledStylesheetTag('instructorGradebook.css')}\n      ${EncodedData<InstructorGradebookData>(\n        {\n          urlPrefix,\n          csvFilename,\n          csrfToken: __csrf_token,\n          hasCourseInstancePermissionEdit: authz_data.has_course_instance_permission_edit,\n          courseAssessments: courseAssessments ?? [],\n        },\n        'gradebook-data',\n      )}\n    `,\n    content: html`\n      ${CourseInstanceSyncErrorsAndWarnings({\n        authz_data,\n        courseInstance: resLocals.course_instance,\n        course: resLocals.course,\n        urlPrefix,\n      })}\n      ${!authz_data.has_course_instance_permission_view\n        ? StudentDataViewMissing({\n            courseOwners,\n            hasCoursePermissionOwn: authz_data.has_course_permission_own,\n            urlPrefix,\n          })\n        : html`\n            <div class=\"card mb-4\">\n              <div class=\"card-header bg-primary text-white\">\n                <h1>Gradebook</h1>\n              </div>\n              <table id=\"gradebook-table\" aria-label=\"Gradebook\"></table>\n\n              <div class=\"spinning-wheel card-body spinner-border\">\n                <span class=\"visually-hidden\">Loading...</span>\n              </div>\n            </div>\n            ${RoleDescriptionModal()}\n          `}\n    `,\n  });\n}\n\nfunction StudentDataViewMissing({\n  courseOwners,\n  hasCoursePermissionOwn,\n  urlPrefix,\n}: {\n  courseOwners: any[];\n  hasCoursePermissionOwn: boolean;\n  urlPrefix: string;\n}) {\n  return html`\n    <div class=\"card mb-4\">\n      <div class=\"card-header bg-danger text-white\">\n        <h1>Gradebook</h1>\n      </div>\n      <div class=\"card-body\">\n        <h2>Insufficient permissions</h2>\n        <p>You must have permission to view student data in order to access the gradebook.</p>\n        ${hasCoursePermissionOwn\n          ? html`\n              <p>\n                You can grant yourself access to student data on the course's\n                <a href=\"${urlPrefix}/course_admin/staff\">Staff tab</a>.\n              </p>\n            `\n          : courseOwners.length > 0\n            ? html`\n                <p>Contact one of the below course owners to request access.</p>\n                <ul>\n                  ${courseOwners.map(\n                    (owner) => html`<li>${owner.uid} ${owner.name ? `(${owner.name})` : ''}</li>`,\n                  )}\n                </ul>\n              `\n            : ''}\n      </div>\n    </div>\n  `;\n}\n\nfunction RoleDescriptionModal() {\n  return Modal({\n    id: 'role-help',\n    title: 'Roles',\n    form: false,\n    body: html`\n      <ul>\n        <li>\n          <strong>Staff</strong> is a member of the course staff. Depending on course settings, they\n          may have permission to see the data of all users, and to edit the information of other\n          users.\n        </li>\n        <li>\n          <strong>Student</strong> is a student participating in the class. They can only see their\n          own information, and can do assessments.\n        </li>\n        <li>\n          <strong>None</strong> is a user who at one point was part of the course but is no longer\n          enrolled in the course or part of the staff. They can no longer access the course but\n          their work done within the course has been retained.\n        </li>\n      </ul>\n    `,\n    footer: html`\n      <button type=\"button\" class=\"btn btn-primary\" data-bs-dismiss=\"modal\">Close</button>\n    `,\n  });\n}\n"]}