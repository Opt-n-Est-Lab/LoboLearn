{"version":3,"file":"instructorGradingJob.html.js","sourceRoot":"","sources":["../../../src/pages/instructorGradingJob/instructorGradingJob.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\n\nimport { formatDate } from '@prairielearn/formatter';\nimport { html } from '@prairielearn/html';\n\nimport { HeadContents } from '../../components/HeadContents.html.js';\nimport { Navbar } from '../../components/Navbar.html.js';\nimport { GradingJobSchema, QuestionSchema, UserSchema } from '../../lib/db-types.js';\n\nexport const GradingJobRowSchema = z.object({\n  // This object will have other columns, but we only care about this one\n  aai: z.object({ authorized: z.boolean() }).nullable(),\n  grading_job: GradingJobSchema,\n  question_qid: QuestionSchema.shape.qid,\n  user_uid: UserSchema.shape.uid,\n});\ntype GradingJobRow = z.infer<typeof GradingJobRowSchema>;\n\nexport function InstructorGradingJob({\n  resLocals,\n  gradingJobRow,\n}: {\n  resLocals: Record<string, any>;\n  gradingJobRow: GradingJobRow;\n}) {\n  const formatGradingJobDate = (date: Date | null) =>\n    date\n      ? formatDate(\n          date,\n          resLocals.course_instance?.display_timezone || resLocals.course.display_timezone,\n          { includeMs: true },\n        )\n      : html`&mdash;`;\n  return html`\n    <!doctype html>\n    <html lang=\"en\">\n      <head>\n        ${HeadContents({ resLocals, pageTitle: `Grading Job ${gradingJobRow.grading_job.id}` })}\n      </head>\n      <body>\n        ${Navbar({ resLocals })}\n        <main id=\"content\" class=\"container\">\n          <div class=\"card mb-4\">\n            <div class=\"card-header bg-primary text-white\">\n              <h1>Grading Job ${gradingJobRow.grading_job.id}</h1>\n            </div>\n\n            <table\n              class=\"table table-sm table-hover two-column-description\"\n              aria-label=\"Grading job details\"\n            >\n              <tbody>\n                <tr>\n                  <th>Question</th>\n                  <td>${gradingJobRow.question_qid}</td>\n                </tr>\n                <tr>\n                  <th>User</th>\n                  <td>${gradingJobRow.user_uid}</td>\n                </tr>\n                <tr>\n                  <th>Requested at</th>\n                  <td>${formatGradingJobDate(gradingJobRow.grading_job.grading_requested_at)}</td>\n                </tr>\n                <tr>\n                  <th>Submitted at</th>\n                  <td>${formatGradingJobDate(gradingJobRow.grading_job.grading_submitted_at)}</td>\n                </tr>\n                <tr>\n                  <th>Received at</th>\n                  <td>${formatGradingJobDate(gradingJobRow.grading_job.grading_received_at)}</td>\n                </tr>\n                <tr>\n                  <th>Started at</th>\n                  <td>${formatGradingJobDate(gradingJobRow.grading_job.grading_started_at)}</td>\n                </tr>\n                <tr>\n                  <th>Finished at</th>\n                  <td>${formatGradingJobDate(gradingJobRow.grading_job.grading_finished_at)}</td>\n                </tr>\n                <tr>\n                  <th>Graded at</th>\n                  <td>${formatGradingJobDate(gradingJobRow.grading_job.graded_at)}</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n\n          ${gradingJobRow.grading_job.s3_bucket && gradingJobRow.grading_job.s3_root_key\n            ? html`\n                <div class=\"card mb-4\">\n                  <div class=\"card-header bg-primary text-white\">Downloads</div>\n                  <table class=\"table table-sm table-hover\" aria-label=\"Grading job downloads\">\n                    <thead>\n                      <tr>\n                        <th>File</th>\n                        <th>Description</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      ${resLocals.authz_data.has_course_permission_view\n                        ? html` <tr>\n                              <td>\n                                <a\n                                  href=\"${resLocals.urlPrefix}/grading_job/${gradingJobRow\n                                    .grading_job.id}/file/job.tar.gz\"\n                                >\n                                  job.tar.gz\n                                </a>\n                              </td>\n                              <td>\n                                Contains all files necessary for grading; this is what is mounted to\n                                <code>/grade</code> when your job is run.\n                              </td>\n                            </tr>\n                            <tr>\n                              <td>\n                                <a\n                                  href=\"${resLocals.urlPrefix}/grading_job/${gradingJobRow\n                                    .grading_job.id}/file/archive.tar.gz\"\n                                  >archive.tar.gz</a\n                                >\n                              </td>\n                              <td>\n                                A snapshot of <code>/grade</code> after your job has been executed.\n                              </td>\n                            </tr>`\n                        : ''}\n                      <tr>\n                        <td>\n                          <a\n                            href=\"${resLocals.urlPrefix}/grading_job/${gradingJobRow.grading_job\n                              .id}/file/results.json\"\n                            >results.json</a\n                          >\n                        </td>\n                        <td>\n                          Contains the PrairieLearn-generated results, which includes the contents\n                          of your\n                          <code>results.json</code> as well as some PrairieLearn metadata.\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <a\n                            href=\"${resLocals.urlPrefix}/grading_job/${gradingJobRow.grading_job\n                              .id}/file/output.log\"\n                            >output.log</a\n                          >\n                        </td>\n                        <td>\n                          Contains the raw output from stdout/stderr for your job. Lines beginning\n                          with\n                          <code>container &gt;</code> are from your container; the rest are\n                          diagnostic logs from PrairieLearn.\n                        </td>\n                      </tr>\n                    </tbody>\n                  </table>\n                </div>\n              `\n            : ''}\n\n          <div class=\"card mb-4\">\n            <div class=\"card-header bg-primary text-white\">Job Output</div>\n            <div class=\"card-body\">\n              ${gradingJobRow.grading_job.s3_bucket && gradingJobRow.grading_job.s3_root_key\n                ? html`\n                    <script>\n                      $(() => {\n                        const outputUrl = document.getElementById('job-output').dataset.outputUrl;\n\n                        $.get(outputUrl)\n                          .done(function (data) {\n                            $('#job-output-loading').hide();\n                            $('#job-output').text(data);\n                            $('#job-output').show();\n                          })\n                          .fail(function () {\n                            $('#job-output-loading').hide();\n                            $('#job-output').text('Unable to load grader results');\n                            $('#job-output').show();\n                          });\n                      });\n                    </script>\n                    <pre\n                      class=\"bg-dark text-white rounded p-3 mb-0\"\n                      id=\"job-output\"\n                      style=\"display: none;\"\n                      data-output-url=\"${resLocals.urlPrefix}/grading_job/${gradingJobRow\n                        .grading_job.id}/file/output.log\"\n                    ></pre>\n                    <div id=\"job-output-loading\" class=\"w-100 text-center\">\n                      <i class=\"fa fa-spinner fa-spin fa-2x\"></i>\n                    </div>\n                  `\n                : gradingJobRow.grading_job.output\n                  ? html`\n                      <pre class=\"bg-dark text-white rounded p-3 mb-0\" id=\"job-output\">\n${gradingJobRow.grading_job.output}</pre\n                      >\n                    `\n                  : html`\n                      <pre class=\"bg-dark text-white rounded p-3 mb-0\">\nNo output was captured for this grading job.</pre\n                      >\n                    `}\n            </div>\n          </div>\n        </main>\n      </body>\n    </html>\n  `.toString();\n}\n"]}