{"version":3,"file":"instructorQuestionStatistics.html.js","sourceRoot":"","sources":["../../../src/pages/instructorQuestionStatistics/instructorQuestionStatistics.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\n\nimport { html, unsafeHtml } from '@prairielearn/html';\n\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { QuestionSyncErrorsAndWarnings } from '../../components/SyncErrorsAndWarnings.html.js';\nimport { compiledScriptTag } from '../../lib/assets.js';\nimport {\n  AssessmentQuestionSchema,\n  AssessmentSchema,\n  AssessmentSetSchema,\n  CourseInstanceSchema,\n  CourseSchema,\n  IdSchema,\n  QuestionSchema,\n} from '../../lib/db-types.js';\nimport { formatFloat } from '../../lib/format.js';\nimport { STAT_DESCRIPTIONS } from '../shared/assessmentStatDescriptions.js';\n\nexport const AssessmentQuestionStatsRowSchema = AssessmentQuestionSchema.extend({\n  course_short_name: CourseSchema.shape.short_name,\n  course_instance_short_name: CourseInstanceSchema.shape.short_name,\n  assessment_label: z.string(),\n  assessment_color: AssessmentSetSchema.shape.color,\n  assessment_id: IdSchema,\n  assessment_type: AssessmentSchema.shape.type,\n  course_instance_id: IdSchema,\n  qid: QuestionSchema.shape.qid,\n  question_title: QuestionSchema.shape.title,\n  assessment_question_number: z.string(),\n});\ntype AssessmentQuestionStatsRow = z.infer<typeof AssessmentQuestionStatsRowSchema>;\n\nexport function InstructorQuestionStatistics({\n  questionStatsCsvFilename,\n  rows,\n  resLocals,\n}: {\n  questionStatsCsvFilename: string;\n  rows: AssessmentQuestionStatsRow[];\n  resLocals: Record<string, any>;\n}) {\n  const histminiOptions = { width: 60, height: 20, ymax: 1 };\n\n  return PageLayout({\n    resLocals,\n    pageTitle: 'Statistics',\n    navContext: {\n      type: 'instructor',\n      page: 'question',\n      subPage: 'statistics',\n    },\n    options: {\n      fullWidth: true,\n      pageNote: resLocals.question.qid,\n    },\n    headContent: [compiledScriptTag('instructorQuestionStatisticsClient.ts')],\n    content: html`\n      ${QuestionSyncErrorsAndWarnings({\n        authz_data: resLocals.authz_data,\n        question: resLocals.question,\n        course: resLocals.course,\n        urlPrefix: resLocals.urlPrefix,\n      })}\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white\">\n          <h1>Detailed assessment statistics for question ${resLocals.question.qid}</h1>\n        </div>\n\n        <div class=\"table-responsive\">\n          <table\n            class=\"table table-sm table-hover tablesorter table-bordered\"\n            aria-label=\"Question statistics by assessment\"\n          >\n            <thead>\n              <tr>\n                <th class=\"text-center\">Course Instance</th>\n                <th class=\"text-center\">Assessment</th>\n                ${Object.values(STAT_DESCRIPTIONS).map((stat) => {\n                  return html`\n                    <th class=\"text-center\" title=\"${stat.description}\">\n                      ${unsafeHtml(stat.title)}\n                    </th>\n                  `;\n                })}\n              </tr>\n            </thead>\n            <tbody>\n              ${rows.map((row) => {\n                return html`\n                  <tr>\n                    <td>${row.course_instance_short_name}</td>\n                    <td style=\"width: 1%\">\n                      <a\n                        href=\"/pl/course_instance/${row.course_instance_id}/instructor/assessment/${row.assessment_id}/\"\n                        class=\"btn btn-badge color-${row.assessment_color}\"\n                      >\n                        ${row.assessment_label}\n                      </a>\n                    </td>\n                    <td class=\"text-center\">${formatFloat(row.mean_question_score, 1)}</td>\n                    <td class=\"text-center\">${formatFloat(row.median_question_score, 1)}</td>\n                    <td class=\"text-center\">${formatFloat(row.question_score_variance, 1)}</td>\n                    <td class=\"text-center\">${formatFloat(row.discrimination, 1)}</td>\n                    <td class=\"text-center\">${formatFloat(row.some_submission_perc, 1)}</td>\n                    <td class=\"text-center\">${formatFloat(row.some_perfect_submission_perc, 1)}</td>\n                    <td class=\"text-center\">${formatFloat(row.some_nonzero_submission_perc, 1)}</td>\n                    <td class=\"text-center\">\n                      ${formatFloat(row.average_first_submission_score, 2)}\n                    </td>\n                    <td class=\"text-center\">\n                      ${formatFloat(row.first_submission_score_variance, 2)}\n                    </td>\n                    <td class=\"text-center\">\n                      ${row.first_submission_score_hist !== null\n                        ? html`\n                            <div\n                              class=\"js-histmini\"\n                              data-options=\"${JSON.stringify({\n                                ...histminiOptions,\n                                normalize: true,\n                              })}\"\n                              data-data=\"${JSON.stringify(row.first_submission_score_hist)}\"\n                            ></div>\n                          `\n                        : ''}\n                    </td>\n                    <td class=\"text-center\">\n                      ${formatFloat(row.average_last_submission_score, 2)}\n                    </td>\n                    <td class=\"text-center\">\n                      ${formatFloat(row.last_submission_score_variance, 2)}\n                    </td>\n                    <td class=\"text-center\">\n                      ${row.last_submission_score_hist !== null\n                        ? html`\n                            <div\n                              class=\"js-histmini\"\n                              data-options=\"${JSON.stringify({\n                                ...histminiOptions,\n                                normalize: true,\n                              })}\"\n                              data-data=\"${JSON.stringify(row.last_submission_score_hist)}\"\n                            ></div>\n                          `\n                        : ''}\n                    </td>\n                    <td class=\"text-center\">${formatFloat(row.average_max_submission_score, 2)}</td>\n                    <td class=\"text-center\">\n                      ${formatFloat(row.max_submission_score_variance, 2)}\n                    </td>\n                    <td class=\"text-center\">\n                      ${row.max_submission_score_hist !== null\n                        ? html`\n                            <div\n                              class=\"js-histmini\"\n                              data-options=\"${JSON.stringify({\n                                ...histminiOptions,\n                                normalize: true,\n                              })}\"\n                              data-data=\"${JSON.stringify(row.max_submission_score_hist)}\"\n                            ></div>\n                          `\n                        : ''}\n                    </td>\n                    <td class=\"text-center\">\n                      ${formatFloat(row.average_average_submission_score, 2)}\n                    </td>\n                    <td class=\"text-center\">\n                      ${formatFloat(row.average_submission_score_variance, 2)}\n                    </td>\n                    <td class=\"text-center\">\n                      ${row.average_submission_score_hist !== null\n                        ? html`\n                            <div\n                              class=\"js-histmini\"\n                              data-options=\"${JSON.stringify({\n                                ...histminiOptions,\n                                normalize: true,\n                              })}\"\n                              data-data=\"${JSON.stringify(row.average_submission_score_hist)}\"\n                            ></div>\n                          `\n                        : ''}\n                    </td>\n                    <td class=\"text-center\">\n                      ${row.submission_score_array_averages !== null\n                        ? html`\n                            <div\n                              class=\"js-histmini\"\n                              data-options=\"${JSON.stringify(histminiOptions)}\"\n                              data-data=\"${JSON.stringify(row.submission_score_array_averages)}\"\n                            ></div>\n                          `\n                        : ''}\n                    </td>\n                    <td class=\"text-center\">\n                      ${row.incremental_submission_score_array_averages !== null\n                        ? html`\n                            <div\n                              class=\"js-histmini\"\n                              data-options=\"${JSON.stringify(histminiOptions)}\"\n                              data-data=\"${JSON.stringify(\n                                row.incremental_submission_score_array_averages,\n                              )}\"\n                            ></div>\n                          `\n                        : ''}\n                    </td>\n                    <td class=\"text-center\">\n                      ${row.assessment_type !== 'Homework'\n                        ? html`\n                            ${row.incremental_submission_points_array_averages != null\n                              ? html`\n                                  <div\n                                    class=\"js-histmini\"\n                                    data-options=\"${JSON.stringify({\n                                      ...histminiOptions,\n                                      ymax: row.max_points,\n                                    })}\"\n                                    data-data=\"${JSON.stringify(\n                                      row.incremental_submission_points_array_averages,\n                                    )}\"\n                                  ></div>\n                                `\n                              : ''}\n                          `\n                        : 'N/A'}\n                    </td>\n                    <td class=\"text-center\">${formatFloat(row.average_number_submissions, 2)}</td>\n                    <td class=\"text-center\">${formatFloat(row.number_submissions_variance, 2)}</td>\n                    <td class=\"text-center\">\n                      ${row.number_submissions_hist !== null\n                        ? html`\n                            <div\n                              class=\"js-histmini\"\n                              data-options=\"${JSON.stringify({\n                                ...histminiOptions,\n                                normalize: true,\n                              })}\"\n                              data-data=\"${JSON.stringify(row.number_submissions_hist)}\"\n                            ></div>\n                          `\n                        : ''}\n                    </td>\n                    <td class=\"text-center\">\n                      ${row.quintile_question_scores !== null\n                        ? html`\n                            <div\n                              class=\"js-histmini\"\n                              data-options=\"${JSON.stringify({\n                                ...histminiOptions,\n                                ymax: 100,\n                              })}\"\n                              data-data=\"${JSON.stringify(row.quintile_question_scores)}\"\n                            ></div>\n                          `\n                        : ''}\n                    </td>\n                  </tr>\n                `;\n              })}\n            </tbody>\n          </table>\n        </div>\n\n        <div class=\"card-footer\">\n          <p>\n            Download\n            <a\n              href=\"${resLocals.urlPrefix}/question/${resLocals.question\n                .id}/statistics/${questionStatsCsvFilename}\"\n            >\n              ${questionStatsCsvFilename}\n            </a>\n          </p>\n          <div class=\"small\">\n            <ul>\n              ${Object.keys(STAT_DESCRIPTIONS).map((stat) => {\n                return html`\n                  <li>\n                    <strong> ${unsafeHtml(STAT_DESCRIPTIONS[stat].title)}: </strong>\n                    ${STAT_DESCRIPTIONS[stat].description}\n                  </li>\n                `;\n              })}\n            </ul>\n            <p class=\"mb-0\">\n              In the case that a student takes this assessment multiple times (e.g., if this\n              assessment is a practice exam), we are calculating the above statistics by first\n              averaging over all assessment instances for each student, then averaging over\n              students.\n            </p>\n          </div>\n        </div>\n      </div>\n    `,\n  });\n}\n"]}