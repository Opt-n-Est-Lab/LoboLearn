{"version":3,"file":"studentAssessments.html.js","sourceRoot":"","sources":["../../../src/pages/studentAssessments/studentAssessments.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\n\nimport { html } from '@prairielearn/html';\n\nimport { HeadContents } from '../../components/HeadContents.html.js';\nimport { Navbar } from '../../components/Navbar.html.js';\nimport { Scorebar } from '../../components/Scorebar.html.js';\nimport {\n  AuthzAccessRuleSchema,\n  StudentAccessRulesPopover,\n} from '../../components/StudentAccessRulesPopover.html.js';\nimport {\n  AssessmentAccessRuleSchema,\n  AssessmentInstanceSchema,\n  AssessmentSchema,\n  AssessmentSetSchema,\n} from '../../lib/db-types.js';\n\nexport const StudentAssessmentsRowSchema = z.object({\n  multiple_instance_header: z.boolean(),\n  assessment_number: AssessmentSchema.shape.number,\n  title: AssessmentSchema.shape.title,\n  group_work: AssessmentSchema.shape.group_work.nullable(),\n  assessment_set_name: AssessmentSetSchema.shape.name,\n  assessment_set_color: AssessmentSetSchema.shape.color,\n  label: z.string(),\n  credit_date_string: z.string(),\n  active: AssessmentAccessRuleSchema.shape.active,\n  access_rules: AuthzAccessRuleSchema.array(),\n  show_closed_assessment_score: AssessmentAccessRuleSchema.shape.show_closed_assessment_score,\n  assessment_instance_id: AssessmentInstanceSchema.shape.id.nullable(),\n  assessment_instance_score_perc: AssessmentInstanceSchema.shape.score_perc.nullable(),\n  assessment_instance_open: AssessmentInstanceSchema.shape.open.nullable(),\n  link: z.string(),\n  start_new_assessment_group: z.boolean(),\n  assessment_group_heading: z.string(),\n});\ntype StudentAssessmentsRow = z.infer<typeof StudentAssessmentsRowSchema>;\n\nexport function StudentAssessments({\n  resLocals,\n  rows,\n}: {\n  resLocals: Record<string, any>;\n  rows: StudentAssessmentsRow[];\n}) {\n  const { urlPrefix, authz_data } = resLocals;\n  return html`\n    <!doctype html>\n    <html lang=\"en\">\n      <head>\n        ${HeadContents({ resLocals, pageTitle: 'Assessments' })}\n      </head>\n      <body>\n        ${Navbar({ resLocals, navPage: 'assessments', navSubPage: 'assessments' })}\n        <main id=\"content\" class=\"container\">\n          <div class=\"card mb-4\">\n            <div class=\"card-header bg-primary text-white\">\n              <h1>Assessments</h1>\n            </div>\n\n            <table class=\"table table-sm table-hover\" aria-label=\"Assessments\">\n              <thead>\n                <tr>\n                  <th style=\"width: 1%\"><span class=\"visually-hidden\">Label</span></th>\n                  <th><span class=\"visually-hidden\">Title</span></th>\n                  <th class=\"text-center\">Available credit</th>\n                  <th class=\"text-center\">Score</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${rows.map(\n                  (row) => html`\n                    ${row.start_new_assessment_group\n                      ? html`\n                          <tr>\n                            <th colspan=\"4\" scope=\"row\" data-testid=\"assessment-group-heading\">\n                              ${row.assessment_group_heading}\n                            </th>\n                          </tr>\n                        `\n                      : ''}\n                    <tr>\n                      <td class=\"align-middle\" style=\"width: 1%\">\n                        <span\n                          class=\"badge color-${row.assessment_set_color}\"\n                          data-testid=\"assessment-set-badge\"\n                        >\n                          ${row.label}\n                        </span>\n                      </td>\n                      <td class=\"align-middle\">\n                        ${row.multiple_instance_header ||\n                        (!row.active && row.assessment_instance_id == null)\n                          ? row.title\n                          : html`\n                              <a href=\"${urlPrefix}${row.link}\">\n                                ${row.title}\n                                ${row.group_work\n                                  ? html`<i class=\"fas fa-users\" aria-hidden=\"true\"></i>`\n                                  : ''}\n                              </a>\n                            `}\n                      </td>\n                      <td class=\"text-center align-middle\">\n                        ${row.assessment_instance_open !== false\n                          ? row.credit_date_string\n                          : 'Assessment closed.'}\n                        ${StudentAccessRulesPopover({\n                          accessRules: row.access_rules,\n                        })}\n                      </td>\n                      <td class=\"text-center align-middle\">\n                        ${row.multiple_instance_header\n                          ? NewInstanceButton({ urlPrefix, row })\n                          : AssessmentScore(row)}\n                      </td>\n                    </tr>\n                  `,\n                )}\n              </tbody>\n            </table>\n          </div>\n          ${authz_data.mode === 'Exam'\n            ? html`\n                <p>\n                  Don't see your exam? Exams for this course are only made available to students\n                  with checked-in exam reservations. See a proctor for assistance.\n                </p>\n              `\n            : ''}\n        </main>\n      </body>\n    </html>\n  `.toString();\n}\n\nfunction AssessmentScore(row: StudentAssessmentsRow) {\n  if (row.assessment_instance_id == null) return 'Not started';\n  if (!row.show_closed_assessment_score) return 'Score not shown';\n  return Scorebar(row.assessment_instance_score_perc, { classes: 'mx-auto' });\n}\n\nfunction NewInstanceButton({ urlPrefix, row }: { urlPrefix: string; row: StudentAssessmentsRow }) {\n  if (row.active) {\n    return html`<a href=\"${urlPrefix}${row.link}\" class=\"btn btn-primary btn-sm\">New instance</a>`;\n  } else {\n    return html`<button type=\"button\" disabled class=\"btn btn-primary btn-sm\">\n      New instance\n    </button>`;\n  }\n}\n"]}