{"version":3,"file":"userSettings.html.js","sourceRoot":"","sources":["../../../src/pages/userSettings/userSettings.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod';\n\nimport { html } from '@prairielearn/html';\n\nimport { PageLayout } from '../../components/PageLayout.html.js';\nimport { UserSettingsPurchasesCard } from '../../ee/lib/billing/components/UserSettingsPurchasesCard.html.js';\nimport { type Purchase } from '../../ee/lib/billing/purchases.js';\nimport { IdSchema, type Institution, type User } from '../../lib/db-types.js';\nimport { isEnterprise } from '../../lib/license.js';\n\nexport const AccessTokenSchema = z.object({\n  created_at: z.string(),\n  id: IdSchema,\n  last_used_at: z.string().nullable(),\n  name: z.string(),\n  token_hash: z.string(),\n  token: z.string().nullable(),\n});\ntype AccessToken = z.infer<typeof AccessTokenSchema>;\n\nexport function UserSettings({\n  authn_user,\n  authn_institution,\n  authn_provider_name,\n  accessTokens,\n  newAccessTokens,\n  purchases,\n  isExamMode,\n  showEnhancedNavigationToggle,\n  enhancedNavigationEnabled,\n  resLocals,\n}: {\n  authn_user: User;\n  authn_institution: Institution;\n  authn_provider_name: string;\n  accessTokens: AccessToken[];\n  newAccessTokens: string[];\n  purchases: Purchase[];\n  isExamMode: boolean;\n  showEnhancedNavigationToggle: boolean;\n  enhancedNavigationEnabled: boolean;\n  resLocals: Record<string, any>;\n}) {\n  return PageLayout({\n    resLocals,\n    pageTitle: 'User Settings',\n    navContext: {\n      page: 'user_settings',\n      type: 'plain',\n    },\n    content: html`\n      <h1 class=\"mb-4\">Settings</h1>\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white d-flex align-items-center\">\n          <h2>User profile</h2>\n        </div>\n        <table class=\"table table-sm two-column-description\" aria-label=\"User profile information\">\n          <tbody>\n            <tr>\n              <th>UID</th>\n              <td>${authn_user.uid}</td>\n            </tr>\n            <tr>\n              <th>Name</th>\n              <td>${authn_user.name}</td>\n            </tr>\n            <tr>\n              <th>Unique Identifier (UIN)</th>\n              <td>${authn_user.uin}</td>\n            </tr>\n            <tr>\n              <th>Email</th>\n              <td>${authn_user.email}</td>\n            </tr>\n            <tr>\n              <th>Institution</th>\n              <td>${authn_institution.long_name} (${authn_institution.short_name})</td>\n            </tr>\n            <tr>\n              <th>Authentication method</th>\n              <td>${authn_provider_name}</td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n\n      ${showEnhancedNavigationToggle\n        ? html`\n            <form method=\"POST\">\n              <div class=\"card mb-4\">\n                <div class=\"card-header bg-primary text-white d-flex align-items-center\">\n                  <h2>Feature preview</h2>\n                </div>\n                <ul class=\"list-group list-group-flush\">\n                  <li class=\"list-group-item d-flex align-items-center\">\n                    <div class=\"form-check\">\n                      <input\n                        type=\"checkbox\"\n                        class=\"form-check-input\"\n                        name=\"enhanced_navigation\"\n                        value=\"1\"\n                        id=\"enhanced_navigation_toggle\"\n                        ${enhancedNavigationEnabled ? 'checked' : ''}\n                      />\n                      <label\n                        class=\"form-check-label d-flex align-items-center\"\n                        for=\"enhanced_navigation_toggle\"\n                      >\n                        Enhanced navigation\n                        <span class=\"badge rounded-pill text-bg-success ms-2\" aria-hidden=\"true\">\n                          Beta\n                        </span>\n                      </label>\n                      <div class=\"small text-muted\">\n                        Try a new navigation experience for instructors that makes accessing your\n                        course simpler, faster, and more intuitive.\n                      </div>\n                    </div>\n                  </li>\n                </ul>\n                <div class=\"card-footer\">\n                  <input type=\"hidden\" name=\"__csrf_token\" value=\"${resLocals.__csrf_token}\" />\n                  <button\n                    type=\"submit\"\n                    class=\"btn btn-sm btn-primary\"\n                    name=\"__action\"\n                    value=\"update_features\"\n                  >\n                    Save changes\n                  </button>\n                </div>\n              </div>\n            </form>\n          `\n        : ''}\n      ${isEnterprise() ? UserSettingsPurchasesCard({ purchases }) : ''}\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white d-flex align-items-center\">\n          <h2>Personal access tokens</h2>\n          ${!isExamMode\n            ? html`\n                <button\n                  type=\"button\"\n                  class=\"btn btn-light btn-sm ms-auto\"\n                  data-bs-toggle=\"popover\"\n                  data-bs-container=\"body\"\n                  data-bs-html=\"true\"\n                  data-bs-placement=\"auto\"\n                  data-bs-title=\"Generate new token\"\n                  data-bs-content=\"${TokenGenerateForm({\n                    csrfToken: resLocals.__csrf_token,\n                  }).toString()}\"\n                  data-testid=\"generate-token-button\"\n                >\n                  <i class=\"fa fa-plus\" aria-hidden=\"true\"></i>\n                  <span class=\"d-none d-sm-inline\">Generate new token</span>\n                </button>\n              `\n            : ''}\n        </div>\n        ${newAccessTokens.length > 0\n          ? html`\n              <div class=\"card-body\">\n                <div class=\"alert alert-primary\" role=\"alert\">\n                  New access token created! Be sure to copy it now, as you won't be able to see it\n                  later.\n                </div>\n                ${newAccessTokens.map(\n                  (token) => html`\n                    <div class=\"alert alert-success mb-0 new-access-token\" role=\"alert\">\n                      ${token}\n                    </div>\n                  `,\n                )}\n              </div>\n            `\n          : ''}\n        <ul class=\"list-group list-group-flush\">\n          ${TokenList({\n            accessTokens,\n            isExamMode,\n            resLocals,\n          })}\n        </ul>\n\n        <div class=\"card-footer small\">\n          Access tokens can be used to access the PrairieLearn API. Be sure to keep them secure.\n        </div>\n      </div>\n\n      <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white d-flex\">\n          <h2>Browser configuration</h2>\n        </div>\n        <div class=\"card-body\">\n          <p>\n            This section will let you reset browser settings related to technology inside\n            PrairieLearn.\n          </p>\n          <p>\n            If math formulas shows up as code like\n            <strong>$ x = rac {-b pm sqrt {b^2 - 4ac}}{2a} $</strong>\n            resetting the MathJax menu settings might help.\n          </p>\n          <button\n            type=\"button\"\n            class=\"btn btn-sm btn-primary\"\n            onclick=\"localStorage.removeItem('MathJax-Menu-Settings');alert('MathJax menu settings have been reset');\"\n          >\n            Reset MathJax menu settings\n          </button>\n        </div>\n      </div>\n    `,\n  });\n}\n\nfunction TokenList({\n  accessTokens,\n  isExamMode,\n  resLocals,\n}: {\n  accessTokens: AccessToken[];\n  isExamMode: boolean;\n  resLocals: Record<string, any>;\n}) {\n  if (isExamMode) {\n    return html`\n      <li class=\"list-group-item\">\n        <span class=\"text-muted\">Access tokens are not available in exam mode.</span>\n      </li>\n    `;\n  }\n\n  if (accessTokens.length === 0) {\n    return html`\n      <li class=\"list-group-item\">\n        <span class=\"text-muted\"> You don't currently have any access tokens. </span>\n      </li>\n    `;\n  }\n\n  return accessTokens.map(\n    (token) => html`\n      <li class=\"list-group-item d-flex align-items-center\">\n        <div class=\"d-flex flex-column me-3\">\n          <strong>${token.name}</strong>\n          <span class=\"text-muted\">Created at ${token.created_at}</span>\n          <span class=\"text-muted\">\n            ${token.last_used_at !== null ? html`Last used at ${token.last_used_at}` : 'Never used'}\n          </span>\n        </div>\n        <button\n          type=\"button\"\n          class=\"btn btn-outline-danger btn-sm ms-auto\"\n          data-bs-toggle=\"popover\"\n          data-bs-container=\"body\"\n          data-bs-html=\"true\"\n          data-bs-placement=\"auto\"\n          data-bs-title=\"Delete this token\"\n          data-bs-content=\"${TokenDeleteForm({\n            token_id: token.id,\n            csrfToken: resLocals.__csrf_token,\n          }).toString()}\"\n        >\n          Delete\n        </button>\n      </li>\n    `,\n  );\n}\n\nfunction TokenGenerateForm({ csrfToken }: { csrfToken: string }) {\n  return html`\n    <form name=\"generate-token-form\" method=\"post\">\n      <input type=\"hidden\" name=\"__action\" value=\"token_generate\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <div class=\"mb-3\">\n        <label class=\"form-label\" for=\"token_name\">Name:</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"token_name\"\n          name=\"token_name\"\n          placeholder=\"My token\"\n          autocomplete=\"off\"\n        />\n      </div>\n      <div class=\"text-right\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"popover\">Cancel</button>\n        <button type=\"submit\" class=\"btn btn-primary\">Generate token</button>\n      </div>\n    </form>\n  `;\n}\n\nfunction TokenDeleteForm({ token_id, csrfToken }: { token_id: string; csrfToken: string }) {\n  return html`\n    <form name=\"token-delete-form\" method=\"POST\">\n      <input type=\"hidden\" name=\"__action\" value=\"token_delete\" />\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${csrfToken}\" />\n      <input type=\"hidden\" name=\"token_id\" value=\"${token_id}\" />\n      <p>\n        Once you delete this token, any applications using it will no longer be able to access the\n        API. You cannot undo this action.\n      </p>\n      <div class=\"text-right\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"popover\">Cancel</button>\n        <button type=\"submit\" class=\"btn btn-danger\">Delete token</button>\n      </div>\n    </form>\n  `;\n}\n"]}