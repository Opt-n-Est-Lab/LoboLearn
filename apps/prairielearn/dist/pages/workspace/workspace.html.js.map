{"version":3,"file":"workspace.html.js","sourceRoot":"","sources":["../../../src/pages/workspace/workspace.html.ts"],"names":[],"mappings":"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","sourcesContent":["import { EncodedData } from '@prairielearn/browser-utils';\nimport { escapeHtml, html } from '@prairielearn/html';\n\nimport { HeadContents } from '../../components/HeadContents.html.js';\nimport { Modal } from '../../components/Modal.html.js';\nimport { assetPath, compiledScriptTag } from '../../lib/assets.js';\n\nexport function Workspace({\n  pageTitle,\n  pageNote,\n  navTitle,\n  navTitleHref,\n  showLogs,\n  heartbeatIntervalSec,\n  visibilityTimeoutSec,\n  socketToken,\n  resLocals,\n}: {\n  pageTitle?: string;\n  pageNote?: string;\n  navTitle: string;\n  navTitleHref: string;\n  showLogs: boolean;\n  heartbeatIntervalSec: number;\n  visibilityTimeoutSec: number;\n  socketToken: string;\n  resLocals: Record<string, any>;\n}) {\n  const { workspace_id, urlPrefix, __csrf_token } = resLocals;\n  return html`\n    <!doctype html>\n    <html lang=\"en\" class=\"h-100\">\n      <head>\n        ${HeadContents({ resLocals, pageNote, pageTitle })}\n        <link href=\"${assetPath('stylesheets/workspace.css')}\" rel=\"stylesheet\" />\n        ${compiledScriptTag('workspaceClient.ts')}\n        ${resLocals.assessment?.type === 'Exam' && resLocals.assessment_instance_remaining_ms\n          ? html`${compiledScriptTag('examTimeLimitCountdown.ts')}\n            ${EncodedData(\n              {\n                serverRemainingMS: resLocals.assessment_instance_remaining_ms,\n                serverTimeLimitMS: resLocals.assessment_instance_time_limit_ms,\n                serverUpdateURL: `${resLocals.plainUrlPrefix}/course_instance/${resLocals.course_instance_id}/assessment_instance/${resLocals.assessment_instance.id}/time_remaining`,\n                canTriggerFinish: false,\n                showsTimeoutWarning: true,\n                reloadOnFail: false,\n                csrfToken: resLocals.__csrf_token,\n              },\n              'time-limit-data',\n            )}`\n          : ''}\n      </head>\n\n      <body\n        class=\"d-flex flex-column h-100\"\n        data-socket-token=\"${socketToken}\"\n        data-workspace-id=\"${workspace_id}\"\n        data-heartbeat-interval-sec=\"${heartbeatIntervalSec}\"\n        data-visibility-timeout-sec=\"${visibilityTimeoutSec}\"\n      >\n        ${RebootModal({ __csrf_token })} ${ResetModal({ __csrf_token })}\n\n        <nav class=\"navbar navbar-light navbar-expand-lg bg-info align-items-center\">\n          <div class=\"container-fluid\">\n            <div class=\"d-flex flex-column me-3\">\n              <h1 class=\"h6 fw-normal mb-0\">\n                <a href=\"${navTitleHref}\" target=\"_blank\" style=\"color: #000;\">${navTitle}</a>\n              </h1>\n              <span class=\"small\" style=\"color: #000;\">\n                <i class=\"fa fa-laptop-code\" aria-hidden=\"true\"></i>\n                PrairieLearn Workspace\n              </span>\n            </div>\n\n            <div class=\"d-flex flex-row me-auto align-items-center\">\n              <span id=\"state\" class=\"badge text-bg-dark badge-workspace text-uppercase\">\n                <i class=\"fas fa-spinner fa-pulse\"></i>\n              </span>\n              <span\n                id=\"message\"\n                class=\"badge text-bg-dark badge-workspace badge-append fw-normal\"\n              ></span>\n            </div>\n            <button\n              class=\"navbar-toggler ms-2\"\n              type=\"button\"\n              data-bs-toggle=\"collapse\"\n              data-bs-target=\"#workspace-nav\"\n            >\n              <span class=\"navbar-toggler-icon\"></span>\n            </button>\n            <div class=\"collapse navbar-collapse\" id=\"workspace-nav\">\n              <ul class=\"navbar-nav ms-auto\">\n                ${resLocals.assessment?.type === 'Exam' &&\n                resLocals.assessment_instance_remaining_ms\n                  ? html` <li class=\"nav-item ms-2 my-1\">\n                      <div id=\"countdownProgress\"></div>\n                      <div class=\"text-white small\">\n                        Time remaining: <span id=\"countdownDisplay\"></span>\n                      </div>\n                    </li>`\n                  : ''}\n                <li class=\"nav-item ms-2 my-1\">\n                  <button\n                    id=\"reboot\"\n                    class=\"nav-item btn btn-light\"\n                    data-bs-toggle=\"modal\"\n                    data-bs-target=\"#rebootModal\"\n                  >\n                    <i class=\"fas fa-sync text-info\" aria-hidden=\"true\"></i>\n                    Reboot\n                  </button>\n                </li>\n                <li class=\"nav-item ms-2 my-1\">\n                  <button\n                    id=\"reset\"\n                    class=\"nav-item btn btn-light\"\n                    data-bs-toggle=\"modal\"\n                    data-bs-target=\"#resetModal\"\n                  >\n                    <i class=\"fas fa-trash text-danger\" aria-hidden=\"true\"></i>\n                    Reset\n                  </button>\n                </li>\n                ${showLogs\n                  ? html`\n                      <li class=\"nav-item ms-2 my-1\">\n                        <a\n                          class=\"nav-item btn btn-light\"\n                          href=\"${urlPrefix}/workspace/${workspace_id}/logs\"\n                          target=\"_blank\"\n                        >\n                          <i class=\"fas fa-bars-staggered\" aria-hidden=\"true\"></i>\n                          Logs\n                        </a>\n                      </li>\n                    `\n                  : null}\n                <li class=\"nav-item ms-2 ml-md-3 my-1\">\n                  <button\n                    type=\"button\"\n                    class=\"nav-item btn btn-light\"\n                    data-bs-toggle=\"popover\"\n                    data-bs-container=\"body\"\n                    data-bs-placement=\"bottom\"\n                    data-bs-html=\"true\"\n                    data-bs-content=\"${escapeHtml(HelpButtonContents())}\"\n                  >\n                    <i class=\"fas fa-question-circle text-secondary\" aria-hidden=\"true\"></i>\n                  </button>\n                </li>\n              </ul>\n            </div>\n          </div>\n        </nav>\n\n        <main id=\"content\" class=\"d-flex flex-column flex-grow h-100\">\n          <div\n            id=\"loading\"\n            class=\"d-flex h-100 flex-grow justify-content-center align-items-center\"\n          >\n            <i class=\"d-block fa fa-10x fa-circle-notch fa-spin text-info\" aria-hidden=\"true\"></i>\n            <span class=\"visually-hidden\">Loading workspace &hellip;</span>\n          </div>\n          <div\n            id=\"stopped\"\n            class=\"d-none h-100 flex-grow flex-column justify-content-center align-items-center p-2 text-center\"\n          >\n            <h2>Workspace stopped due to inactivity</h2>\n            <p>Your data was automatically saved. Reload the page to restart the workspace.</p>\n            <button id=\"reload\" class=\"btn btn-primary\">Reload</button>\n          </div>\n          <div\n            id=\"failed\"\n            class=\"d-none h-100 flex-grow flex-column justify-content-center align-items-center p-2 text-center\"\n          >\n            <i class=\"d-block fa fa-10x fa-xmark text-danger\" aria-hidden=\"true\"></i>\n            <h2>Workspace failed to load</h2>\n            <p id=\"failed-message\"></p>\n          </div>\n          <iframe id=\"workspace\" class=\"d-none flex-grow h-100 border-0\"></iframe>\n        </main>\n      </body>\n    </html>\n  `.toString();\n}\n\nfunction ResetModal({ __csrf_token }: { __csrf_token: string }) {\n  return Modal({\n    id: 'resetModal',\n    title: 'Reset the workspace',\n    body: html`\n      <p>Are you sure you want to reset the virtual machine?</p>\n      <ul class=\"fa-ul\">\n        <li>\n          <span class=\"fa-li\">\n            <i class=\"fas fa-exclamation-triangle text-danger\" aria-hidden=\"true\"></i>\n          </span>\n          <strong class=\"text-danger\">Your file changes will be lost!</strong> The workspace will\n          return to its original state upon reset.\n        </li>\n        <li>\n          <span class=\"fa-li\"><i class=\"fas fa-window-restore\" aria-hidden=\"true\"></i></span>\n          Your workspace will reset into this same tab.\n        </li>\n      </ul>\n    `,\n    footer: html`\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${__csrf_token}\" />\n      <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n      <button name=\"__action\" value=\"reset\" class=\"btn btn-danger\">\n        <i class=\"fas fa-trash\" aria-hidden=\"true\"></i>\n        Reset\n      </button>\n    `,\n  });\n}\n\nfunction RebootModal({ __csrf_token }: { __csrf_token: string }) {\n  return Modal({\n    id: 'rebootModal',\n    title: 'Reboot the workspace',\n    body: html`\n      <p>Are you sure you want to reboot the virtual machine?</p>\n      <ul class=\"fa-ul\">\n        <li>\n          <span class=\"fa-li\"><i class=\"fas fa-save\" aria-hidden=\"true\"></i></span> Your files will\n          remain intact through the reboot.\n        </li>\n        <li>\n          <span class=\"fa-li\"><i class=\"fas fa-window-restore\" aria-hidden=\"true\"></i></span> Your\n          workspace will reboot into this same tab.\n        </li>\n      </ul>\n    `,\n    footer: html`\n      <input type=\"hidden\" name=\"__csrf_token\" value=\"${__csrf_token}\" />\n      <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n      <button name=\"__action\" value=\"reboot\" class=\"btn btn-info\">\n        <i class=\"fas fa-sync\" aria-hidden=\"true\"></i>\n        Reboot\n      </button>\n    `,\n  });\n}\n\nfunction HelpButtonContents() {\n  return html`\n    <ul class=\"list-group list-group-flush\">\n      <li class=\"list-group-item p-2\">\n        <div class=\"row\">\n          <div class=\"col col-3 fw-bold d-flex align-items-center\">Reloading</div>\n          <div class=\"col col-9\">\n            Use your browser reload button on this tab at any time, or close and re-open the tab.\n          </div>\n        </div>\n      </li>\n      <li class=\"list-group-item p-2\">\n        <div class=\"row\">\n          <div class=\"col col-3 fw-bold d-flex align-items-center\">Rebooting</div>\n          <div class=\"col col-9\">\n            The\n            <span class=\"badge badge-outline text-bg-light\">\n              <i class=\"fas fa-sync\" aria-hidden=\"true\"></i> Reboot\n            </span>\n            button will restart the virtual machine. Your files will remain intact.\n          </div>\n        </div>\n      </li>\n      <li class=\"list-group-item p-2\">\n        <div class=\"row\">\n          <div class=\"col col-3 fw-bold d-flex align-items-center\">Resetting</div>\n          <div class=\"col col-9\">\n            The\n            <span class=\"badge badge-outline text-bg-light\">\n              <i class=\"fas fa-trash text-secondary\" aria-hidden=\"true\"></i> Reset\n            </span>\n            button will delete all of your file edits and revert the virtual machine to its original\n            state.\n          </div>\n        </div>\n      </li>\n      <li class=\"list-group-item p-2\">\n        <div class=\"row\">\n          <div class=\"col col-3 fw-bold d-flex align-items-center\">Grading</div>\n          <div class=\"col col-9\">\n            Use the <span class=\"badge badge-outline text-bg-light\">Save &amp; Grade</span> button\n            on the PrairieLearn question page to submit your files for grading.\n          </div>\n        </div>\n      </li>\n    </ul>\n  `;\n}\n"]}