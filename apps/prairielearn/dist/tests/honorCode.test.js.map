{"version":3,"file":"honorCode.test.js","sourceRoot":"","sources":["../../src/tests/honorCode.test.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,MAAM,MAAM,CAAC;AAE9B,OAAO,KAAK,KAAK,MAAM,wBAAwB,CAAC;AAEhD,OAAO,EAAE,MAAM,EAAE,MAAM,kBAAkB,CAAC;AAE1C,OAAO,KAAK,YAAY,MAAM,mBAAmB,CAAC;AAClD,OAAO,KAAK,YAAY,MAAM,mBAAmB,CAAC;AAElD,MAAM,GAAG,GAAG,KAAK,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAEhD,QAAQ,CAAC,gDAAgD,EAAE;IACzD,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;IAEpB,MAAM,OAAO,GAAwB,EAAE,CAAC;IACxC,OAAO,CAAC,OAAO,GAAG,oBAAoB,MAAM,CAAC,UAAU,EAAE,CAAC;IAC1D,OAAO,CAAC,OAAO,GAAG,GAAG,OAAO,CAAC,OAAO,KAAK,CAAC;IAC1C,OAAO,CAAC,qBAAqB,GAAG,GAAG,OAAO,CAAC,OAAO,oBAAoB,CAAC;IAEvE,MAAM,CAAC,uBAAuB,EAAE,YAAY,CAAC,MAAM,EAAE,CAAC,CAAC;IAEvD,KAAK,CAAC,0BAA0B,EAAE,YAAY,CAAC,KAAK,CAAC,CAAC;IAEtD,EAAE,CAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE;QAC7D,MAAM,OAAO,GAAG,MAAM,KAAK,CAAC,gBAAgB,CAAC,GAAG,CAAC,WAAW,EAAE;YAC5D,MAAM,EAAE,GAAG;SACZ,CAAC,CAAC;QACH,MAAM,YAAY,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;QACxC,MAAM,aAAa,GAAG,GAAG,OAAO,CAAC,qBAAqB,eAAe,YAAY,GAAG,CAAC;QAErF,MAAM,QAAQ,GAAG,MAAM,YAAY,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;QAChE,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;QAE3B,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,EAAE,kBAAkB,CAAC,CAAC;QAEhF,8CAA8C;QAC9C,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,2BAA2B,CAAC,EAAE,CAAC,CAAC,CAAC;IAC9D,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,4DAA4D,EAAE,KAAK,IAAI,EAAE;QAC1E,MAAM,OAAO,GAAG,MAAM,KAAK,CAAC,gBAAgB,CAAC,GAAG,CAAC,WAAW,EAAE;YAC5D,MAAM,EAAE,IAAI;SACb,CAAC,CAAC;QACH,MAAM,YAAY,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;QACxC,MAAM,aAAa,GAAG,GAAG,OAAO,CAAC,qBAAqB,eAAe,YAAY,GAAG,CAAC;QAErF,MAAM,QAAQ,GAAG,MAAM,YAAY,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;QAChE,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;QAE3B,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,EAAE,kBAAkB,CAAC,CAAC;QAEhF,+CAA+C;QAC/C,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,2BAA2B,CAAC,EAAE,CAAC,CAAC,CAAC;IAC9D,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["import { assert } from 'chai';\n\nimport * as sqldb from '@prairielearn/postgres';\n\nimport { config } from '../lib/config.js';\n\nimport * as helperClient from './helperClient.js';\nimport * as helperServer from './helperServer.js';\n\nconst sql = sqldb.loadSqlEquiv(import.meta.url);\n\ndescribe('Exam assessment response to `requireHonorCode`', function () {\n  this.timeout(60000);\n\n  const context: Record<string, any> = {};\n  context.siteUrl = `http://localhost:${config.serverPort}`;\n  context.baseUrl = `${context.siteUrl}/pl`;\n  context.courseInstanceBaseUrl = `${context.baseUrl}/course_instance/1`;\n\n  before('set up testing server', helperServer.before());\n\n  after('shut down testing server', helperServer.after);\n\n  it('visits the landing page of default assessment', async () => {\n    const results = await sqldb.queryOneRowAsync(sql.select_exam, {\n      number: '1',\n    });\n    const assessmentId = results.rows[0].id;\n    const assessmentUrl = `${context.courseInstanceBaseUrl}/assessment/${assessmentId}/`;\n\n    const response = await helperClient.fetchCheerio(assessmentUrl);\n    assert.isTrue(response.ok);\n\n    assert.equal(response.$('#start-assessment').text().trim(), 'Start assessment');\n\n    // We should see the honor code div by default\n    assert.lengthOf(response.$('div.test-class-honor-code'), 1);\n  });\n\n  it('visits landing page of assessment with disabled honor code', async () => {\n    const results = await sqldb.queryOneRowAsync(sql.select_exam, {\n      number: '13',\n    });\n    const assessmentId = results.rows[0].id;\n    const assessmentUrl = `${context.courseInstanceBaseUrl}/assessment/${assessmentId}/`;\n\n    const response = await helperClient.fetchCheerio(assessmentUrl);\n    assert.isTrue(response.ok);\n\n    assert.equal(response.$('#start-assessment').text().trim(), 'Start assessment');\n\n    // We should not see the honor code div anymore\n    assert.lengthOf(response.$('div.test-class-honor-code'), 0);\n  });\n});\n"]}