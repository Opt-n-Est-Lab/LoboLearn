"use strict";(()=>{var j=Object.defineProperty;var N=(e,t,r)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var S=(e,t,r)=>N(e,typeof t!="symbol"?t+"":t,r);function T(e){document.readyState==="interactive"||document.readyState==="complete"?e():document.addEventListener("DOMContentLoaded",()=>{e()})}function R(e,t){typeof t!="string"&&(t=t.toString());let r=e.createElement("template");return r.innerHTML=t,e.importNode(r.content,!0)}function l(e,t){let r=R(e,t);if(r.childElementCount!==1)throw new Error("Expected HTML to contain exactly one element");return r.firstElementChild}var v=typeof Buffer=="function",D=typeof TextDecoder=="function"?new TextDecoder:void 0,ae=typeof TextEncoder=="function"?new TextEncoder:void 0,$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",q=Array.prototype.slice.call($),m=(e=>{let t={};return e.forEach((r,n)=>t[r]=n),t})(q),z=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,u=String.fromCharCode.bind(String),C=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0));var E=e=>e.replace(/[^A-Za-z0-9\+\/]/g,"");var V=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Z=e=>{switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=t-65536;return u((r>>>10)+55296)+u((r&1023)+56320);case 3:return u((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return u((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},J=e=>e.replace(V,Z),Q=e=>{if(e=e.replace(/\s+/g,""),!z.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let t,r="",n,a;for(let s=0;s<e.length;)t=m[e.charAt(s++)]<<18|m[e.charAt(s++)]<<12|(n=m[e.charAt(s++)])<<6|(a=m[e.charAt(s++)]),r+=n===64?u(t>>16&255):a===64?u(t>>16&255,t>>8&255):u(t>>16&255,t>>8&255,t&255);return r},F=typeof atob=="function"?e=>atob(E(e)):v?e=>Buffer.from(e,"base64").toString("binary"):Q,W=v?e=>C(Buffer.from(e,"base64")):e=>C(F(e).split("").map(t=>t.charCodeAt(0)));var Y=v?e=>Buffer.from(e,"base64").toString("utf8"):D?e=>D.decode(W(e)):e=>J(F(e)),G=e=>E(e.replace(/[-_]/g,t=>t=="-"?"+":"/")),_=e=>Y(G(e));var K={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},X=/[&<>'"]/g;function ee(e){return K[e]||e}function te(e){return e==null?"":String(e).replace(X,ee)}function B(e){if(e instanceof d)return e.toString();if(Array.isArray(e))return e.map(t=>B(t)).join("");if(typeof e=="string"||typeof e=="number"||typeof e=="bigint"||typeof e=="boolean")return te(String(e));if(e==null)return"";throw typeof e=="object"?new Error(`Cannot interpolate object in template: ${JSON.stringify(e)}`):new Error(`Unexpected type in template: ${typeof e} for value ${JSON.stringify(e)}`)}var d=class{constructor(t,r){S(this,"strings");S(this,"values");this.strings=t,this.values=r}toString(){return this.values.reduce((t,r,n)=>t+B(r)+this.strings[n+1],this.strings[0])}};function f(e,...t){return new d(e,t)}function w(e){var a;let t=(a=document.getElementById(e))==null?void 0:a.textContent;if(t==null)throw new Error(`No data found in element with ID "${e}"`);let r=_(t);return JSON.parse(r)}function re(e){let t=new URLSearchParams(new FormData(e));return t.delete("__csrf_token"),e.querySelectorAll("[data-skip-unload-check]").forEach(r=>{r.name&&t.delete(r.name)}),t.toString()}function H(e){e&&(e.dataset.originalFormData=re(e))}function O(e){let t=document.querySelector(e.displaySelector),r=document.querySelector(e.progressSelector);if(!t||!r)return;let n,a,s=e.initialServerRemainingMS,p,g=!0,x=null;r.classList.add("progress"),r.innerHTML='<div class="progress-bar progress-bar-primary"></div>';let b=r.querySelector("div");M({serverRemainingMS:e.initialServerRemainingMS,serverTimeLimitMS:e.initialServerTimeLimitMS}),e.serverUpdateURL&&window.setInterval(L,6e4);function M(o){var i;n=o.serverRemainingMS,a=o.serverTimeLimitMS,p=Date.now(),console.log("Time remaining: "+n+" ms"),n<=0?((i=e.onTimerOut)==null||i.call(e),g=!1):y()}function L(){e.serverUpdateURL&&fetch(e.serverUpdateURL).then(async o=>{M(await o.json())}).catch(o=>{var c;console.log("Error retrieving remaining time",o);let i=Math.max(0,n-(Date.now()-p));(c=e.onServerUpdateFail)==null||c.call(e,i),i<=0&&(g=!1),y()})}function y(){var A,U;if(!b||!t)return;let o=Math.max(0,n-(Date.now()-p)),i=Math.floor(o/1e3),c=Math.floor(i/60),k=100-Math.max(0,Math.min(100,o/a*100)),I=((A=e.getBackgroundColor)==null?void 0:A.call(e,i))||"bg-info";if(b.style.width=k+"%",b.className="progress-bar "+I,t.innerText=i>=60?c+" min":i+" sec",o>0){if(e.onRemainingTime)for(let h in e.onRemainingTime)o<=+h&&+h<s&&e.onRemainingTime[h]();s=o,x!=null&&clearTimeout(x),x=setTimeout(y,(o-500)%1e3)}else e.serverUpdateURL&&g?L():(U=e.onTimerOut)==null||U.call(e)}}function P(e,t){let r=document.querySelector("#warning-popup");r||(r=l(document,f`<div
        id="warning-popup"
        class="fixed-bottom d-flex flex-column align-items-center mb-5"
      ></div>`),document.body.append(r)),document.querySelector("#popup-"+e)||r.appendChild(l(document,f`<div
          id="popup-${e}"
          class="show align-items-center alert alert-warning alert-dismissible pulse"
          role="alert"
          aria-live="assertive"
          aria-atomic="true"
        >
          <div>${t}</div>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="alert"
            aria-label="Close"
          ></button>
        </div>`))}T(()=>{let e=w("time-limit-data");O({displaySelector:"#countdownDisplay",progressSelector:"#countdownProgress",initialServerRemainingMS:e.serverRemainingMS,initialServerTimeLimitMS:e.serverTimeLimitMS,serverUpdateURL:e.serverUpdateURL,onTimerOut:()=>{let t=document.querySelector("#countdownDisplay");if(t&&(t.innerHTML="expired"),e.canTriggerFinish){H(document.querySelector("form.question-form"));let r=l(document,f`<form method="POST">
            <input type="hidden" name="__action" value="timeLimitFinish" />
            <input type="hidden" name="__csrf_token" value="${e.csrfToken}" />
          </form>`);document.body.append(r),r.submit()}},onRemainingTime:{6e4:()=>{e.showsTimeoutWarning&&P("examTimeout","Your exam is ending soon. Please finish and submit your work.")}},onServerUpdateFail:t=>{e.reloadOnFail?window.location.reload():t>0&&P("updateFail","Failed to refresh exam timer. The displayed remaining time might be inaccurate.")},getBackgroundColor:t=>t>=180?"bg-primary":t>=60?"bg-warning":"bg-danger"})});})();
//# sourceMappingURL=examTimeLimitCountdown-H4FTIHHN.js.map
